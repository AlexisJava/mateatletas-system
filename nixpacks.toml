# ============================================
# nixpacks.toml - Railway Build Configuration
# ============================================
# NOTA: Railway usa Docker, este archivo es para Nixpacks legacy.
# Para deployment actual usar Dockerfile directamente.

[phases.setup]
nixPkgs = ["nodejs"]

[phases.install]
cmds = [
  "corepack enable",
  "corepack prepare yarn@4.10.3 --activate",
  "yarn install --immutable"
]

[phases.build]
cmds = [
  "yarn workspace api prisma generate",
  "yarn workspace @mateatletas/contracts build",
  "yarn workspace api build"
]

[start]
cmd = "yarn workspace api prisma migrate deploy && node apps/api/dist/src/main.js"
