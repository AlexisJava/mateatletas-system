// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Modelo de prueba simple
model TestModel {
  id         String   @id @default(uuid())
  name       String
  created_at DateTime @default(now())

  @@map("test_models")
}

/// Modelo principal para tutores/docentes de la plataforma
/// Representa a los usuarios educadores que crean y gestionan contenido educativo
model Tutor {
  /// Identificador 煤nico del tutor (CUID para mejor distribuci贸n)
  id String @id @default(cuid())

  /// Email 煤nico del tutor - usado para autenticaci贸n
  /// IMPORTANTE: Debe estar indexado para b煤squedas r谩pidas en login
  email String @unique

  /// Hash bcrypt de la contrase帽a - NUNCA se env铆a al frontend
  /// Se maneja solo en backend para seguridad
  password_hash String

  /// Nombre del tutor
  nombre String

  /// Apellido del tutor
  apellido String

  /// Documento Nacional de Identidad (opcional)
  dni String?

  /// Tel茅fono de contacto (opcional)
  telefono String?

  /// Fecha en que el tutor se registr贸 en la plataforma
  fecha_registro DateTime @default(now())

  /// Indica si el tutor complet贸 el proceso de onboarding inicial
  /// Se usa para redirigir a nuevos tutores al flujo de configuraci贸n
  ha_completado_onboarding Boolean @default(false)

  /// Relaci贸n con estudiantes (un tutor puede tener muchos estudiantes)
  estudiantes Estudiante[]

  /// Relaci贸n con membres铆as (un tutor puede tener varias membres铆as a lo largo del tiempo)
  membresias Membresia[]

  /// Relaci贸n con inscripciones a clases (reservas que hizo el tutor para sus estudiantes)
  inscripciones_clase InscripcionClase[]

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("tutores")
}

/// Modelo para estudiantes asociados a un tutor
/// Representa a los alumnos que utilizar谩n la plataforma
model Estudiante {
  /// Identificador 煤nico del estudiante
  id String @id @default(cuid())

  /// Email 煤nico del estudiante - usado para autenticaci贸n propia
  /// IMPORTANTE: Debe estar indexado para b煤squedas r谩pidas en login
  email String? @unique

  /// Hash bcrypt de la contrase帽a - NUNCA se env铆a al frontend
  /// Permite que el estudiante acceda al portal con sus propias credenciales
  password_hash String?

  /// Nombre del estudiante
  nombre String

  /// Apellido del estudiante
  apellido String

  /// Fecha de nacimiento del estudiante (para calcular edad)
  fecha_nacimiento DateTime

  /// Nivel escolar del estudiante: Primaria, Secundaria, Universidad
  nivel_escolar String

  /// URL de la foto de perfil del estudiante (opcional)
  foto_url String?

  /// URL o identificador del avatar personalizable del estudiante
  /// Puede ser una URL de Dicebear API o un identificador de avatar predefinido
  avatar_url String? @default("avataaars")

  /// ID del tutor que gestiona este estudiante
  tutor_id String

  /// Relaci贸n con el tutor (muchos estudiantes pertenecen a un tutor)
  tutor Tutor @relation(fields: [tutor_id], references: [id], onDelete: Cascade)

  /// ID del equipo al que pertenece el estudiante (opcional, para gamificaci贸n)
  equipo_id String?

  /// Relaci贸n con el equipo (muchos estudiantes pueden estar en un equipo)
  equipo Equipo? @relation(fields: [equipo_id], references: [id], onDelete: SetNull)

  /// Puntos totales acumulados por el estudiante (gamificaci贸n)
  puntos_totales Int @default(0)

  /// Nivel actual del estudiante en el sistema de gamificaci贸n
  nivel_actual Int @default(1)

  /// Relaci贸n con inscripciones a cursos (un estudiante puede inscribirse a m煤ltiples cursos)
  inscripciones_curso InscripcionCurso[]

  /// Relaci贸n con inscripciones a clases (reservas a clases en vivo)
  inscripciones_clase InscripcionClase[]

  /// Relaci贸n con registros de asistencia
  asistencias Asistencia[]

  /// Relaci贸n con alertas administrativas
  alertas Alerta[]

  /// Relaci贸n con puntos obtenidos (historial de gamificaci贸n)
  puntosObtenidos PuntoObtenido[]

  /// Relaci贸n con logros desbloqueados
  logrosDesbloqueados LogroDesbloqueado[]

  /// Relaci贸n con progreso de lecciones (cursos asincr贸nicos)
  progresoLecciones ProgresoLeccion[]

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("estudiantes")
}

/// Modelo para equipos de gamificaci贸n
/// Representa los equipos a los que pueden unirse los estudiantes
model Equipo {
  /// Identificador 煤nico del equipo
  id String @id @default(cuid())

  /// Nombre 煤nico del equipo (F茅nix, Drag贸n, Tigre, guila)
  nombre String @unique

  /// Color primario del equipo en formato hexadecimal
  color_primario String

  /// Color secundario del equipo en formato hexadecimal
  color_secundario String

  /// URL del 铆cono del equipo (opcional)
  icono_url String?

  /// Puntos totales acumulados por el equipo
  puntos_totales Int @default(0)

  /// Relaci贸n con estudiantes (un equipo puede tener muchos estudiantes)
  estudiantes Estudiante[]

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("equipos")
}

/// Modelo para docentes (profesores) de la plataforma
/// Representa a los usuarios educadores que dictan clases
model Docente {
  /// Identificador 煤nico del docente
  id String @id @default(cuid())

  /// Email 煤nico del docente - usado para autenticaci贸n
  email String @unique

  /// Hash bcrypt de la contrase帽a
  password_hash String

  /// Nombre del docente
  nombre String

  /// Apellido del docente
  apellido String

  /// T铆tulo profesional (ej: "Profesor de Matem谩tica")
  titulo String?

  /// Biograf铆a o descripci贸n del docente
  bio String?

  /// Relaci贸n con clases (un docente puede dictar muchas clases)
  clases Clase[]

  /// Relaci贸n con puntos otorgados (un docente puede otorgar muchos puntos)
  puntosOtorgados PuntoObtenido[] @relation("PuntosOtorgados")

  /// Relaci贸n con logros desbloqueados (un docente puede aprobar muchos logros)
  logrosAprobados LogroDesbloqueado[] @relation("LogrosAprobados")

  /// Relaci贸n con notificaciones (un docente puede tener muchas notificaciones)
  notificaciones Notificacion[]

  /// Relaci贸n con eventos (un docente puede tener muchos eventos)
  eventos Evento[]

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("docentes")
}

/// Modelo para administradores del sistema
/// Tienen acceso completo al dashboard administrativo
model Admin {
  /// Identificador 煤nico del admin (CUID)
  id String @id @default(cuid())

  /// Email 煤nico del admin - usado para autenticaci贸n
  email String @unique

  /// Hash bcrypt de la contrase帽a - NUNCA se env铆a al frontend
  password_hash String

  /// Nombre del admin
  nombre String

  /// Apellido del admin
  apellido String

  /// Fecha en que el admin fue creado
  fecha_registro DateTime @default(now())

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("admins")
}

/// Enum para tipos de productos disponibles
enum TipoProducto {
  Suscripcion    // Plan de suscripci贸n mensual/anual
  Curso          // Curso individual con fechas espec铆ficas
  RecursoDigital // Materiales digitales (libros, gu铆as, etc.)
}

/// Enum para estados de membres铆a
enum EstadoMembresia {
  Pendiente  // Pago iniciado, esperando confirmaci贸n de webhook
  Activa     // Pago confirmado por webhook
  Atrasada   // Pago vencido
  Cancelada  // Membres铆a cancelada manualmente
}

/// Enum para estados de inscripci贸n a cursos
enum EstadoInscripcionCurso {
  PreInscrito // Inscrito antes del inicio del curso
  Activo      // Curso en progreso
  Finalizado  // Curso completado
}

/// Modelo para productos del cat谩logo
/// Representa los productos que se pueden comprar: suscripciones, cursos, recursos
model Producto {
  /// Identificador 煤nico del producto
  id String @id @default(cuid())

  /// Nombre del producto (ej: "Suscripci贸n Mensual", "Curso de lgebra")
  nombre String

  /// Descripci贸n detallada del producto
  descripcion String?

  /// Precio del producto en pesos (formato decimal para precisi贸n)
  precio Decimal @db.Decimal(10, 2)

  /// Tipo de producto (Suscripcion, Curso, RecursoDigital)
  tipo TipoProducto

  /// Indica si el producto est谩 activo y disponible para compra
  activo Boolean @default(true)

  // --- Campos espec铆ficos para tipo Curso ---

  /// Fecha de inicio del curso (solo para tipo Curso)
  fecha_inicio DateTime?

  /// Fecha de finalizaci贸n del curso (solo para tipo Curso)
  fecha_fin DateTime?

  /// Cupo m谩ximo de estudiantes (solo para tipo Curso)
  cupo_maximo Int?

  // --- Campos espec铆ficos para tipo Suscripcion ---

  /// Duraci贸n en meses de la suscripci贸n (1=mensual, 12=anual, etc.)
  duracion_meses Int? @default(1)

  /// Relaci贸n con membres铆as (muchas membres铆as pueden usar este producto)
  membresias Membresia[]

  /// Relaci贸n con inscripciones a cursos (muchos estudiantes pueden comprar este curso)
  inscripciones_curso InscripcionCurso[]

  /// Relaci贸n con clases (si es un curso, puede tener clases asociadas)
  clases Clase[]

  /// Relaci贸n con m贸dulos (para cursos asincr贸nicos)
  modulos Modulo[]

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("productos")
}

/// Modelo para membres铆as de suscripci贸n
/// Vincula un tutor con un producto de tipo Suscripcion
model Membresia {
  /// Identificador 煤nico de la membres铆a
  id String @id @default(cuid())

  /// ID del tutor propietario de la membres铆a
  tutor_id String

  /// Relaci贸n con el tutor
  tutor Tutor @relation(fields: [tutor_id], references: [id], onDelete: Cascade)

  /// ID del producto de suscripci贸n
  producto_id String

  /// Relaci贸n con el producto
  producto Producto @relation(fields: [producto_id], references: [id])

  /// Estado actual de la membres铆a
  estado EstadoMembresia @default(Pendiente)

  /// Fecha de inicio de la membres铆a (se llena cuando webhook confirma)
  fecha_inicio DateTime?

  /// Fecha del pr贸ximo pago (se calcula cuando webhook confirma)
  fecha_proximo_pago DateTime?

  /// ID de preferencia de MercadoPago (para tracking)
  preferencia_id String?

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("membresias")

  /// ndice para b煤squedas r谩pidas por tutor y estado
  @@index([tutor_id, estado])

  /// ndice para b煤squedas por preferencia de MP
  @@index([preferencia_id])
}

/// Modelo para inscripciones a cursos
/// Vincula un estudiante con un producto de tipo Curso
model InscripcionCurso {
  /// Identificador 煤nico de la inscripci贸n
  id String @id @default(cuid())

  /// ID del estudiante inscrito
  estudiante_id String

  /// Relaci贸n con el estudiante
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  /// ID del producto curso
  producto_id String

  /// Relaci贸n con el producto
  producto Producto @relation(fields: [producto_id], references: [id])

  /// Estado de la inscripci贸n
  estado EstadoInscripcionCurso @default(PreInscrito)

  /// Fecha de inscripci贸n
  fecha_inscripcion DateTime @default(now())

  /// ID de preferencia de MercadoPago (para tracking)
  preferencia_id String?

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("inscripciones_curso")

  /// ndice 煤nico para evitar inscripciones duplicadas
  @@unique([estudiante_id, producto_id])

  /// ndice para b煤squedas r谩pidas
  @@index([estudiante_id, estado])

  /// ndice para b煤squedas por preferencia de MP
  @@index([preferencia_id])
}

// ============================================================================
// SLICE #7: CLASES (ACADMICO)
// ============================================================================

/// Enum para estados de clase
enum EstadoClase {
  Programada // Clase programada y disponible
  Cancelada  // Clase cancelada por admin o docente
}

/// Enum para estados de asistencia
enum EstadoAsistencia {
  Presente  // Estudiante asisti贸
  Ausente   // Estudiante no asisti贸
  Justificado // Ausencia justificada
}

/// Modelo para rutas curriculares (temas/categor铆as de clases)
/// Representa los temas o 谩reas de conocimiento de las clases
model RutaCurricular {
  /// Identificador 煤nico de la ruta
  id String @id @default(cuid())

  /// Nombre de la ruta (ej: "L贸gica", "lgebra", "Geometr铆a")
  nombre String @unique

  /// Color hexadecimal para identificaci贸n visual (opcional)
  color String?

  /// Descripci贸n de la ruta curricular
  descripcion String?

  /// Relaci贸n con clases (muchas clases pueden usar esta ruta)
  clases Clase[]

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("rutas_curriculares")
}

/// Modelo para clases programadas
/// Representa una clase en vivo programada por un admin
model Clase {
  /// Identificador 煤nico de la clase
  id String @id @default(cuid())

  /// ID de la ruta curricular (tema de la clase)
  ruta_curricular_id String

  /// Relaci贸n con la ruta curricular
  rutaCurricular RutaCurricular @relation(fields: [ruta_curricular_id], references: [id])

  /// ID del docente asignado a la clase
  docente_id String

  /// Relaci贸n con el docente
  docente Docente @relation(fields: [docente_id], references: [id])

  /// Fecha y hora de inicio de la clase
  fecha_hora_inicio DateTime

  /// Duraci贸n de la clase en minutos
  duracion_minutos Int

  /// Estado de la clase (Programada, Cancelada)
  estado EstadoClase @default(Programada)

  /// Cupo m谩ximo de estudiantes
  cupos_maximo Int

  /// Cupos ocupados actualmente
  cupos_ocupados Int @default(0)

  /// ID del producto curso (opcional - si null es clase de suscripci贸n general)
  /// Si tiene valor, solo estudiantes con InscripcionCurso activa pueden reservar
  producto_id String?

  /// Relaci贸n con el producto (si es clase de curso espec铆fico)
  producto Producto? @relation(fields: [producto_id], references: [id])

  /// Relaci贸n con inscripciones (reservas de estudiantes)
  inscripciones InscripcionClase[]

  /// Relaci贸n con registros de asistencia
  asistencias Asistencia[]

  /// Relaci贸n con alertas administrativas
  alertas Alerta[]

  /// Relaci贸n con puntos obtenidos en esta clase
  puntosObtenidos PuntoObtenido[]

  /// Relaci贸n con eventos (para reprogramaciones/recuperaciones)
  eventos Evento[]

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("clases")

  /// ndice para b煤squedas por docente
  @@index([docente_id])

  /// ndice para b煤squedas por fecha
  @@index([fecha_hora_inicio])

  /// ndice para b煤squedas por estado
  @@index([estado])

  /// ndice para b煤squedas por producto
  @@index([producto_id])
}

/// Modelo para inscripciones a clases (reservas)
/// Vincula un estudiante con una clase espec铆fica
model InscripcionClase {
  /// Identificador 煤nico de la inscripci贸n
  id String @id @default(cuid())

  /// ID de la clase
  clase_id String

  /// Relaci贸n con la clase
  clase Clase @relation(fields: [clase_id], references: [id], onDelete: Cascade)

  /// ID del estudiante inscrito
  estudiante_id String

  /// Relaci贸n con el estudiante
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  /// ID del tutor que realiz贸 la reserva
  tutor_id String

  /// Relaci贸n con el tutor
  tutor Tutor @relation(fields: [tutor_id], references: [id])

  /// Fecha de la inscripci贸n
  fecha_inscripcion DateTime @default(now())

  /// Observaciones o notas sobre la inscripci贸n
  observaciones String?

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("inscripciones_clase")

  /// Constraint 煤nico para evitar reservas duplicadas
  @@unique([clase_id, estudiante_id])

  /// ndice para b煤squedas por estudiante
  @@index([estudiante_id])

  /// ndice para b煤squedas por tutor
  @@index([tutor_id])
}

/// Modelo para registro de asistencia
/// Registra la asistencia y feedback del docente despu茅s de la clase
model Asistencia {
  /// Identificador 煤nico del registro de asistencia
  id String @id @default(cuid())

  /// ID de la clase
  clase_id String

  /// Relaci贸n con la clase
  clase Clase @relation(fields: [clase_id], references: [id], onDelete: Cascade)

  /// ID del estudiante
  estudiante_id String

  /// Relaci贸n con el estudiante
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  /// Estado de asistencia (Presente, Ausente, Justificado)
  estado EstadoAsistencia

  /// Observaciones del docente sobre el estudiante en esta clase
  observaciones String?

  /// Puntos otorgados al estudiante en esta clase (para gamificaci贸n)
  puntos_otorgados Int @default(0)

  /// Fecha y hora del registro de asistencia
  fecha_registro DateTime @default(now())

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("asistencias")

  /// Constraint 煤nico para evitar registros duplicados
  @@unique([clase_id, estudiante_id])

  /// ndice para b煤squedas por estudiante
  @@index([estudiante_id])

  /// ndice para b煤squedas por estado
  @@index([estado])
}

// ============================================================================
// SLICE #9: ADMIN COPILOT - ALERTAS
// ============================================================================

/// Modelo para alertas administrativas generadas desde observaciones de docentes
/// Permite al admin detectar y resolver situaciones que requieren atenci贸n
model Alerta {
  /// Identificador 煤nico de la alerta
  id String @id @default(cuid())

  /// ID del estudiante relacionado con la alerta
  estudiante_id String

  /// Relaci贸n con el estudiante
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  /// ID de la clase donde se gener贸 la alerta
  clase_id String

  /// Relaci贸n con la clase
  clase Clase @relation(fields: [clase_id], references: [id], onDelete: Cascade)

  /// Descripci贸n de la alerta (observaciones del docente)
  descripcion String

  /// Fecha de creaci贸n de la alerta
  fecha DateTime @default(now())

  /// Indica si la alerta ha sido resuelta
  resuelta Boolean @default(false)

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("alertas")

  /// ndice para b煤squedas por estudiante
  @@index([estudiante_id])

  /// ndice para b煤squedas por estado de resoluci贸n
  @@index([resuelta])

  /// ndice para b煤squedas por fecha
  @@index([fecha])
}

// ============================================================================
// SISTEMA DE GAMIFICACIN COMPLETO
// ============================================================================

/// Modelo para acciones puntuables (configuraci贸n de gamificaci贸n)
/// Define las acciones por las cuales un docente puede otorgar puntos
model AccionPuntuable {
  /// Identificador 煤nico de la acci贸n
  id String @id @default(cuid())

  /// Nombre de la acci贸n (ej: "Razonamiento destacado", "Participaci贸n activa")
  nombre String @unique

  /// Descripci贸n de la acci贸n
  descripcion String

  /// Cantidad de puntos que otorga esta acci贸n
  puntos Int

  /// Indica si la acci贸n est谩 activa
  activo Boolean @default(true)

  /// Relaci贸n con puntos obtenidos (historial de uso)
  puntosObtenidos PuntoObtenido[]

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("acciones_puntuables")
}

/// Modelo para logros/insignias (configuraci贸n de gamificaci贸n)
/// Define los logros que los estudiantes pueden desbloquear
model Logro {
  /// Identificador 煤nico del logro
  id String @id @default(cuid())

  /// Nombre del logro (ej: "Primera Clase", "Asistencia Perfecta")
  nombre String @unique

  /// Descripci贸n del logro
  descripcion String

  /// Icono o emoji del logro
  icono String

  /// Puntos extra que otorga desbloquear este logro
  puntos Int @default(0)

  /// URL de la imagen del badge (opcional)
  imagen_url String?

  /// Requisito o condici贸n para desbloquear (texto descriptivo)
  requisito String?

  /// Indica si el logro est谩 activo
  activo Boolean @default(true)

  /// Relaci贸n con logros desbloqueados por estudiantes
  logrosDesbloqueados LogroDesbloqueado[]

  /// Relaci贸n con lecciones que desbloquean este logro
  leccionesDesbloque Leccion[]

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("logros")
}

/// Modelo para registro de puntos obtenidos (tabla transaccional)
/// Cada registro representa un evento donde un estudiante gan贸 puntos
model PuntoObtenido {
  /// Identificador 煤nico del registro
  id String @id @default(cuid())

  /// ID del estudiante que obtuvo los puntos
  estudiante_id String

  /// Relaci贸n con el estudiante
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  /// ID del docente que otorg贸 los puntos
  docente_id String

  /// Relaci贸n con el docente
  docente Docente @relation("PuntosOtorgados", fields: [docente_id], references: [id])

  /// ID de la acci贸n puntuable
  accion_id String

  /// Relaci贸n con la acci贸n puntuable
  accion AccionPuntuable @relation(fields: [accion_id], references: [id])

  /// ID de la clase donde se ganaron los puntos (opcional)
  clase_id String?

  /// Relaci贸n con la clase (opcional)
  clase Clase? @relation(fields: [clase_id], references: [id], onDelete: SetNull)

  /// Cantidad de puntos otorgados (se guarda para preservar historial)
  puntos Int

  /// Contexto o raz贸n adicional (opcional)
  contexto String?

  /// Fecha y hora en que se otorgaron los puntos
  fecha_otorgado DateTime @default(now())

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("puntos_obtenidos")

  /// ndice para b煤squedas por estudiante
  @@index([estudiante_id])

  /// ndice para b煤squedas por docente
  @@index([docente_id])

  /// ndice para b煤squedas por acci贸n
  @@index([accion_id])

  /// ndice para b煤squedas por fecha
  @@index([fecha_otorgado])
}

/// Modelo para logros desbloqueados (tabla transaccional)
/// Registra cuando un estudiante desbloquea un logro
model LogroDesbloqueado {
  /// Identificador 煤nico del registro
  id String @id @default(cuid())

  /// ID del estudiante que desbloque贸 el logro
  estudiante_id String

  /// Relaci贸n con el estudiante
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  /// ID del logro desbloqueado
  logro_id String

  /// Relaci贸n con el logro
  logro Logro @relation(fields: [logro_id], references: [id])

  /// ID del docente que otorg贸 el logro (opcional, puede ser autom谩tico)
  docente_id String?

  /// Relaci贸n con el docente (opcional)
  docente Docente? @relation("LogrosAprobados", fields: [docente_id], references: [id])

  /// Fecha y hora en que se desbloque贸 el logro
  fecha_obtenido DateTime @default(now())

  /// Contexto o raz贸n del desbloqueo (opcional)
  contexto String?

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("logros_desbloqueados")

  /// Constraint 煤nico: un estudiante solo puede desbloquear un logro una vez
  @@unique([estudiante_id, logro_id])

  /// ndice para b煤squedas por estudiante
  @@index([estudiante_id])

  /// ndice para b煤squedas por logro
  @@index([logro_id])

  /// ndice para b煤squedas por fecha
  @@index([fecha_obtenido])
}

// ============================================================================
// SLICE #16: ESTRUCTURA DE CURSOS Y LECCIONES
// Sistema de contenido educativo asincr贸nico (E-Learning)
// Basado en mejores pr谩cticas de Ed-Tech: Chunking, Progressive Disclosure,
// Microlearning, Multi-modal Learning
// ============================================================================

/// M贸dulo dentro de un curso
/// Agrupa lecciones relacionadas tem谩ticamente
/// Ejemplo: "M贸dulo 1: Variables y Expresiones"
model Modulo {
  /// Identificador 煤nico del m贸dulo
  id String @id @default(cuid())

  /// ID del producto (curso) al que pertenece
  producto_id String

  /// T铆tulo del m贸dulo visible para estudiantes
  /// Ejemplo: "Fundamentos de lgebra"
  titulo String

  /// Descripci贸n breve del m贸dulo (opcional)
  /// Ayuda al estudiante a entender qu茅 aprender谩
  descripcion String? @db.Text

  /// Orden de presentaci贸n del m贸dulo dentro del curso
  /// 1, 2, 3... Permite reordenamiento manual
  orden Int

  /// Duraci贸n estimada total del m贸dulo en minutos
  /// Suma autom谩tica de duraciones de lecciones
  duracion_estimada_minutos Int @default(0)

  /// Cantidad de puntos totales que otorga completar el m贸dulo
  /// Suma de puntos_por_completar de todas las lecciones
  puntos_totales Int @default(0)

  /// Si est谩 publicado y visible para estudiantes
  publicado Boolean @default(false)

  /// Relaci贸n con el producto (curso)
  producto Producto @relation(fields: [producto_id], references: [id], onDelete: Cascade)

  /// Lecciones que pertenecen a este m贸dulo
  lecciones Leccion[]

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("modulos")

  /// ndice compuesto para ordenamiento eficiente
  @@index([producto_id, orden])

  /// ndice para b煤squedas por producto
  @@index([producto_id])
}

/// Tipos de contenido educativo soportados
/// Cada tipo requiere renderizado diferente en frontend
enum TipoContenido {
  Video              // YouTube, Vimeo, URL directa
  Texto              // Markdown con explicaciones, ejemplos
  Quiz               // Preguntas de opci贸n m煤ltiple
  Tarea              // Ejercicios para practicar
  JuegoInteractivo   // Mini-juegos educativos (futuro)
  Lectura            // PDFs, art铆culos externos
  Practica           // Ejercicios interactivos
}

/// Lecci贸n individual dentro de un m贸dulo
/// Unidad m铆nima de aprendizaje (Microlearning)
/// Duraci贸n recomendada: 5-15 minutos
model Leccion {
  /// Identificador 煤nico de la lecci贸n
  id String @id @default(cuid())

  /// ID del m贸dulo al que pertenece
  modulo_id String

  /// T铆tulo de la lecci贸n visible para estudiantes
  /// Debe ser descriptivo y claro
  /// Ejemplo: "C贸mo resolver ecuaciones lineales"
  titulo String

  /// Descripci贸n opcional de la lecci贸n
  /// Resumen de lo que aprender谩 el estudiante
  descripcion String? @db.Text

  /// Tipo de contenido de esta lecci贸n
  tipo_contenido TipoContenido

  /// Contenido de la lecci贸n (formato seg煤n tipo)
  /// - Video: URL del video
  /// - Texto: Markdown con el contenido
  /// - Quiz: JSON con preguntas y opciones
  /// - Tarea: JSON con instrucciones y rubrica
  contenido String @db.Text

  /// Orden de presentaci贸n dentro del m贸dulo
  /// 1, 2, 3... Permite reordenamiento manual
  orden Int

  /// Puntos otorgados al completar esta lecci贸n
  /// Incentiva al estudiante a terminar
  /// Rango recomendado: 5-20 puntos por lecci贸n
  puntos_por_completar Int @default(10)

  /// ID del logro que se desbloquea al completar (opcional)
  /// Ejemplo: "Maestro del lgebra" al terminar m贸dulo completo
  logro_desbloqueable_id String?

  /// Duraci贸n estimada en minutos
  /// Ayuda al estudiante a planificar su tiempo
  /// Rango recomendado: 5-15 minutos (Microlearning)
  duracion_estimada_minutos Int?

  /// Si la lecci贸n est谩 publicada y visible
  activo Boolean @default(true)

  /// Recursos adicionales (opcional)
  /// JSON con links, PDFs, etc.
  /// Ejemplo: {"links": ["https://...", "https://..."], "pdfs": ["url1"]}
  recursos_adicionales String? @db.Text

  /// Prerequisito (opcional)
  /// ID de lecci贸n que debe completarse antes
  /// Implementa Progressive Disclosure
  leccion_prerequisito_id String?

  /// Relaci贸n con el m贸dulo
  modulo Modulo @relation(fields: [modulo_id], references: [id], onDelete: Cascade)

  /// Relaci贸n con logro desbloqueable (opcional)
  logro Logro? @relation(fields: [logro_desbloqueable_id], references: [id])

  /// Relaci贸n con lecci贸n prerequisito (self-referencia)
  leccionPrerequisito Leccion?  @relation("LeccionPrerequisito", fields: [leccion_prerequisito_id], references: [id])
  leccionesDependientes Leccion[] @relation("LeccionPrerequisito")

  /// Progreso de estudiantes en esta lecci贸n
  progresos ProgresoLeccion[]

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("lecciones")

  /// ndice compuesto para ordenamiento eficiente
  @@index([modulo_id, orden])

  /// ndice para b煤squedas por m贸dulo
  @@index([modulo_id])

  /// ndice para b煤squedas por tipo de contenido
  @@index([tipo_contenido])
}

/// Progreso de un estudiante en una lecci贸n espec铆fica
/// Tracking granular del aprendizaje (Learning Analytics)
model ProgresoLeccion {
  /// Identificador 煤nico del progreso
  id String @id @default(cuid())

  /// ID del estudiante
  estudiante_id String

  /// ID de la lecci贸n
  leccion_id String

  /// Si la lecci贸n fue completada
  /// true = estudiante termin贸 y marc贸 como completada
  completada Boolean @default(false)

  /// Porcentaje de progreso (0-100)
  /// til para lecciones largas o videos
  /// 0 = no iniciado, 50 = a la mitad, 100 = completado
  progreso Int @default(0)

  /// Fecha y hora en que inici贸 la lecci贸n
  fecha_inicio DateTime @default(now())

  /// Fecha y hora en que complet贸 la lecci贸n (si aplica)
  fecha_completada DateTime?

  /// Tiempo total invertido en minutos (opcional)
  /// til para analytics y m茅tricas de engagement
  tiempo_invertido_minutos Int?

  /// Calificaci贸n obtenida (para quizzes)
  /// Rango: 0-100 (porcentaje)
  calificacion Int?

  /// N煤mero de intentos (para quizzes/tareas)
  intentos Int @default(0)

  /// Notas del estudiante (opcional)
  /// Permite al estudiante tomar apuntes privados
  notas_estudiante String? @db.Text

  /// ltima respuesta del estudiante (para quizzes/tareas)
  /// JSON con las respuestas dadas
  ultima_respuesta String? @db.Text

  /// Relaci贸n con estudiante
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  /// Relaci贸n con lecci贸n
  leccion Leccion @relation(fields: [leccion_id], references: [id], onDelete: Cascade)

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("progreso_lecciones")

  /// Constraint 煤nico: un estudiante solo puede tener un progreso por lecci贸n
  @@unique([estudiante_id, leccion_id])

  /// ndice para b煤squedas por estudiante
  @@index([estudiante_id])

  /// ndice para b煤squedas por lecci贸n
  @@index([leccion_id])

  /// ndice para b煤squedas de lecciones completadas
  @@index([estudiante_id, completada])
}

// ============================================
// NOTIFICACIONES Y EVENTOS PARA DOCENTES
// ============================================

/// Sistema de notificaciones para docentes
/// Permite notificar eventos importantes como clases pr贸ximas, alertas de estudiantes, etc.
model Notificacion {
  /// Identificador 煤nico de la notificaci贸n
  id String @id @default(cuid())

  /// Tipo de notificaci贸n
  tipo TipoNotificacion

  /// T铆tulo de la notificaci贸n
  titulo String

  /// Mensaje descriptivo de la notificaci贸n
  mensaje String @db.Text

  /// Indica si la notificaci贸n ha sido le铆da
  leida Boolean @default(false)

  /// ID del docente al que pertenece la notificaci贸n
  docente_id String

  /// Relaci贸n con el docente
  docente Docente @relation(fields: [docente_id], references: [id], onDelete: Cascade)

  /// Metadata adicional en formato JSON (clase_id, estudiante_id, etc)
  metadata Json?

  /// Timestamp de creaci贸n de la notificaci贸n
  createdAt DateTime @default(now())

  /// Mapeo al nombre de tabla en la base de datos
  @@map("notificaciones")

  /// ndice para b煤squedas r谩pidas por docente y estado de lectura
  @@index([docente_id, leida])

  /// ndice para ordenamiento por fecha
  @@index([docente_id, createdAt])
}

/// Tipos de notificaciones disponibles
enum TipoNotificacion {
  ClaseProxima        // Clase programada en las pr贸ximas 24h
  AsistenciaPendiente // Asistencia sin registrar 2h despu茅s de la clase
  EstudianteAlerta    // Estudiante con baja asistencia (<70%)
  ClaseCancelada      // Clase cancelada por el sistema o admin
  LogroEstudiante     // Estudiante alcanz贸 un logro importante
  Recordatorio        // Recordatorio personalizado
  General             // Notificaci贸n general del sistema

  @@map("tipo_notificacion")
}

/// Eventos del calendario del docente
/// Modelo base polim贸rfico: puede ser Clase, Tarea, Recordatorio o Nota
model Evento {
  /// Identificador 煤nico del evento
  id String @id @default(cuid())

  /// T铆tulo del evento
  titulo String

  /// Descripci贸n detallada del evento
  descripcion String? @db.Text

  /// Tipo de evento (CLASE, TAREA, RECORDATORIO, NOTA)
  tipo TipoEvento

  /// Fecha y hora de inicio del evento
  fecha_inicio DateTime

  /// Fecha y hora de fin del evento
  fecha_fin DateTime

  /// Indica si el evento dura todo el d铆a
  es_todo_el_dia Boolean @default(false)

  /// ID del docente al que pertenece el evento
  docente_id String

  /// Relaci贸n con el docente
  docente Docente @relation(fields: [docente_id], references: [id], onDelete: Cascade)

  /// ID de la clase relacionada (para reprogramaci贸n/recuperaci贸n)
  clase_id String?

  /// Relaci贸n con la clase del sistema
  clase Clase? @relation(fields: [clase_id], references: [id], onDelete: SetNull)

  /// Timestamp de creaci贸n del evento
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del evento
  updatedAt DateTime @updatedAt

  /// Relaciones polim贸rficas con tipos espec铆ficos
  tarea Tarea?
  recordatorio Recordatorio?
  nota Nota?

  /// Mapeo al nombre de tabla en la base de datos
  @@map("eventos")

  /// ndices para optimizaci贸n de consultas
  @@index([docente_id, fecha_inicio])
  @@index([tipo])
  @@index([docente_id, tipo])
  @@index([clase_id])
}

/// Tipos de eventos disponibles en el calendario
enum TipoEvento {
  CLASE           // Clase del sistema (para reprogramaci贸n/recuperaci贸n)
  TAREA           // Tarea administrativa/pedag贸gica
  RECORDATORIO    // Recordatorio simple
  NOTA            // Nota/apunte de texto largo

  @@map("tipo_evento")
}

/// Estados de una tarea
enum EstadoTarea {
  PENDIENTE       // Tarea pendiente de iniciar
  EN_PROGRESO     // Tarea en proceso
  COMPLETADA      // Tarea finalizada
  CANCELADA       // Tarea cancelada

  @@map("estado_tarea")
}

/// Niveles de prioridad para tareas
enum PrioridadTarea {
  BAJA            // Prioridad baja
  MEDIA           // Prioridad media
  ALTA            // Prioridad alta
  URGENTE         // Prioridad urgente

  @@map("prioridad_tarea")
}

/// Tarea administrativa/pedag贸gica del docente
/// Extensi贸n del modelo Evento para tareas con funcionalidad completa
model Tarea {
  /// Identificador 煤nico de la tarea
  id String @id @default(cuid())

  /// ID del evento base asociado
  evento_id String @unique

  /// Relaci贸n con el evento base
  evento Evento @relation(fields: [evento_id], references: [id], onDelete: Cascade)

  /// Estado actual de la tarea
  estado EstadoTarea @default(PENDIENTE)

  /// Nivel de prioridad de la tarea
  prioridad PrioridadTarea @default(MEDIA)

  /// Porcentaje de completitud (0-100)
  porcentaje_completado Int @default(0)

  /// Categor铆a personalizada de la tarea (ej: "Planificaci贸n", "Evaluaci贸n")
  categoria String?

  /// Etiquetas para organizaci贸n (array de strings)
  etiquetas String[]

  /// Subtareas en formato JSON
  /// Estructura: [{id: string, titulo: string, completada: boolean, orden: number}]
  subtareas Json @default("[]")

  /// Archivos adjuntos en formato JSON
  /// Estructura: [{id: string, nombre: string, url: string, tipo: string, tama帽o: number}]
  archivos Json @default("[]")

  /// ID de clase relacionada (opcional)
  clase_relacionada_id String?

  /// ID de estudiante relacionado (opcional)
  estudiante_relacionado_id String?

  /// Tiempo estimado para completar en minutos
  tiempo_estimado_minutos Int?

  /// Tiempo real invertido en minutos
  tiempo_real_minutos Int?

  /// Configuraci贸n de recurrencia en formato JSON
  /// Estructura: {tipo: 'DIARIA'|'SEMANAL'|'MENSUAL', intervalo: number, dias_semana: number[], fecha_fin: string, excepciones: string[]}
  recurrencia Json?

  /// Recordatorios configurados en formato JSON
  /// Estructura: [{minutos_antes: number, enviado: boolean}]
  recordatorios Json @default("[]")

  /// Fecha de completitud
  completedAt DateTime?

  /// Mapeo al nombre de tabla en la base de datos
  @@map("tareas")

  /// ndices para optimizaci贸n
  @@index([estado])
  @@index([prioridad])
  @@index([categoria])
}

/// Recordatorio simple para el docente
/// Extensi贸n del modelo Evento para recordatorios b谩sicos
model Recordatorio {
  /// Identificador 煤nico del recordatorio
  id String @id @default(cuid())

  /// ID del evento base asociado
  evento_id String @unique

  /// Relaci贸n con el evento base
  evento Evento @relation(fields: [evento_id], references: [id], onDelete: Cascade)

  /// Indica si el recordatorio fue completado/marcado
  completado Boolean @default(false)

  /// Color personalizado del recordatorio (formato hex)
  color String @default("#6366f1")

  /// Mapeo al nombre de tabla en la base de datos
  @@map("recordatorios")
}

/// Nota de texto largo para el docente
/// Extensi贸n del modelo Evento para notas/apuntes
model Nota {
  /// Identificador 煤nico de la nota
  id String @id @default(cuid())

  /// ID del evento base asociado
  evento_id String @unique

  /// Relaci贸n con el evento base
  evento Evento @relation(fields: [evento_id], references: [id], onDelete: Cascade)

  /// Contenido de la nota (texto largo)
  contenido String @db.Text

  /// Categor铆a de la nota (opcional)
  categoria String?

  /// Color personalizado de la nota (formato hex)
  color String @default("#8b5cf6")

  /// Mapeo al nombre de tabla en la base de datos
  @@map("notas")

  /// ndice para b煤squedas por categor铆a
  @@index([categoria])
}

/// Configuraci贸n de niveles del sistema de gamificaci贸n
/// Define los nombres creativos y requisitos para cada nivel
model NivelConfig {
  /// N煤mero del nivel (1, 2, 3, etc.)
  nivel Int @id

  /// Nombre creativo del nivel
  /// Ejemplos: "Explorador Num茅rico", "Maestro del C谩lculo", "Genio Matem谩tico"
  nombre String

  /// Descripci贸n del nivel
  descripcion String

  /// Puntos m铆nimos requeridos para alcanzar este nivel
  puntos_minimos Int

  /// Puntos m谩ximos antes de pasar al siguiente nivel
  puntos_maximos Int

  /// Color hex asociado al nivel para UI
  color String @default("#6366F1")

  /// Icono o emoji asociado al nivel
  icono String @default("")

  /// Timestamp de creaci贸n del registro
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt DateTime @updatedAt

  /// Mapeo al nombre de tabla en la base de datos
  @@map("niveles_config")
}
