generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model TestModel {
  id         String   @id @default(uuid())
  name       String
  created_at DateTime @default(now())

  @@map("test_models")
}

/// Modelo principal para tutores/docentes de la plataforma
/// Representa a los usuarios educadores que crean y gestionan contenido educativo
model Tutor {
  /// Identificador 煤nico del tutor (CUID para mejor distribuci贸n)
  id                        String                  @id @default(cuid())
  /// Username 煤nico del tutor - usado para autenticaci贸n alternativa
  username                  String?                 @unique
  /// Email 煤nico del tutor - usado para autenticaci贸n
  /// IMPORTANTE: Debe estar indexado para b煤squedas r谩pidas en login
  email                     String?                 @unique
  /// Hash bcrypt de la contrase帽a - NUNCA se env铆a al frontend
  /// Se maneja solo en backend para seguridad
  password_hash             String
  /// Password temporal en texto plano - se muestra al admin al crear el tutor
  /// Se borra despu茅s del primer cambio de contrase帽a
  password_temporal         String?
  /// Indica si el tutor debe cambiar su contrase帽a en el pr贸ximo login
  debe_cambiar_password     Boolean                 @default(true)
  /// Indica si el tutor debe completar su perfil (datos personales adicionales)
  debe_completar_perfil     Boolean                 @default(false)
  /// Fecha del 煤ltimo cambio de contrase帽a
  fecha_ultimo_cambio       DateTime?
  /// Nombre del tutor
  nombre                    String
  /// Apellido del tutor
  apellido                  String
  /// Documento Nacional de Identidad (opcional)
  dni                       String?
  /// Tel茅fono de contacto (opcional)
  telefono                  String?
  /// Fecha en que el tutor se registr贸 en la plataforma
  fecha_registro            DateTime                @default(now())
  /// Indica si el tutor complet贸 el proceso de onboarding inicial
  /// Se usa para redirigir a nuevos tutores al flujo de configuraci贸n
  ha_completado_onboarding  Boolean                 @default(false)
  /// Timestamp de creaci贸n del registro
  createdAt                 DateTime                @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt                 DateTime                @updatedAt
  /// Roles asignados al tutor (normalmente solo ["tutor"])
  /// Ejemplo: ["tutor"]
  roles                     Json                    @default("[\"tutor\"]")
  estudiantes               Estudiante[]
  inscripciones_clase       InscripcionClase[]
  inscripciones_clase_grupo InscripcionClaseGrupo[]
  membresias                Membresia[]
  inscripciones_mensuales   InscripcionMensual[]

  @@map("tutores")
}

/// Modelo para estudiantes asociados a un tutor
/// Representa a los alumnos que utilizar谩n la plataforma
model Estudiante {
  /// Identificador 煤nico del estudiante
  id                        String                            @id @default(cuid())
  /// Username 煤nico del estudiante - usado para autenticaci贸n
  username                  String?                           @unique
  /// Nombre del estudiante
  nombre                    String
  /// Apellido del estudiante
  apellido                  String
  /// Nivel escolar del estudiante: Primaria, Secundaria, Universidad
  nivel_escolar             String
  /// URL del avatar 3D de Ready Player Me
  /// Ejemplo: https://models.readyplayer.me/abc123.glb
  avatar_url                String?                           @db.Text
  /// DEPRECADO: URL de la foto de perfil del estudiante (mantener por compatibilidad)
  foto_url                  String?
  /// ID del tutor que gestiona este estudiante
  tutor_id                  String
  /// ID del equipo al que pertenece el estudiante (opcional, para gamificaci贸n)
  equipo_id                 String?
  /// Puntos totales acumulados por el estudiante (gamificaci贸n)
  puntos_totales            Int                               @default(0)
  /// Nivel actual del estudiante en el sistema de gamificaci贸n
  nivel_actual              Int                               @default(1)
  /// Timestamp de creaci贸n del registro
  createdAt                 DateTime                          @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt                 DateTime                          @updatedAt
  /// ID del gradiente del avatar (0-9)
  /// Corresponde a uno de los 10 gradientes predefinidos del sistema
  avatar_gradient           Int                               @default(0)
  /// Edad del estudiante en a帽os
  edad                      Int
  /// Email 煤nico del estudiante - usado para autenticaci贸n propia
  /// IMPORTANTE: Debe estar indexado para b煤squedas r谩pidas en login
  email                     String?                           @unique
  /// Hash bcrypt de la contrase帽a - NUNCA se env铆a al frontend
  /// Permite que el estudiante acceda al portal con sus propias credenciales
  password_hash             String?
  /// PIN temporal en texto plano - se muestra al tutor/admin al crear el estudiante
  /// Se borra despu茅s del primer cambio de contrase帽a
  password_temporal         String?
  /// Indica si el estudiante debe cambiar su PIN en el pr贸ximo login
  debe_cambiar_password     Boolean                           @default(true)
  /// Fecha del 煤ltimo cambio de contrase帽a
  fecha_ultimo_cambio       DateTime?
  /// Roles asignados al estudiante (normalmente solo ["estudiante"])
  /// Ejemplo: ["estudiante"]
  roles                     Json                              @default("[\"estudiante\"]")
  /// DEPRECADO: ID del sector al que pertenece el estudiante (usar sectores[] en su lugar)
  /// Mantener temporalmente para migraci贸n gradual
  sector_id                 String?
  alertas                   Alerta[]
  asistencias               Asistencia[]
  equipo                    Equipo?                           @relation(fields: [equipo_id], references: [id])
  /// DEPRECADO: Relaci贸n uno-a-uno con sector (usar sectores[] en su lugar)
  sector                    Sector?                           @relation("EstudianteSectorLegacy", fields: [sector_id], references: [id])
  /// NUEVO: Relaci贸n muchos-a-muchos con sectores a trav茅s de EstudianteSector
  sectores                  EstudianteSector[]
  tutor                     Tutor                             @relation(fields: [tutor_id], references: [id], onDelete: Cascade)
  inscripciones_clase       InscripcionClase[]
  inscripciones_clase_grupo InscripcionClaseGrupo[]
  asistencias_clase_grupo   AsistenciaClaseGrupo[]
  inscripciones_curso       InscripcionCurso[]
  logrosDesbloqueados       LogroDesbloqueado[]
  progresoLecciones         ProgresoLeccion[]
  puntosObtenidos           PuntoObtenido[]
  inscripciones_mensuales   InscripcionMensual[]
  becas                     Beca[]
  progresosActividades      ProgresoEstudianteActividad[]
  progresosPlanificaciones  ProgresoEstudiantePlanificacion[]
  recursos                  RecursosEstudiante?
  itemsObtenidos            ItemObtenido[]

  @@map("estudiantes")
}

/// Tabla intermedia para relaci贸n muchos-a-muchos entre Estudiante y Sector
/// Un estudiante puede estar inscrito en m煤ltiples sectores (ej: Matem谩tica + Programaci贸n)
/// Un sector puede tener m煤ltiples estudiantes
model EstudianteSector {
  /// ID 煤nico de la relaci贸n
  id            String    @id @default(cuid())
  /// ID del estudiante
  estudiante_id String
  /// ID del sector
  sector_id     String
  /// Indica si es el sector principal del estudiante (para compatibilidad con l贸gica legacy)
  es_principal  Boolean   @default(false)
  /// Fecha de inscripci贸n en el sector
  fecha_inicio  DateTime  @default(now())
  /// Fecha de baja del sector (null si est谩 activo)
  fecha_fin     DateTime?
  /// Timestamp de creaci贸n del registro
  createdAt     DateTime  @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt     DateTime  @updatedAt

  /// Relaciones
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  sector     Sector     @relation(fields: [sector_id], references: [id], onDelete: Cascade)

  /// ndice 煤nico para evitar duplicados (un estudiante no puede estar dos veces en el mismo sector activo)
  @@unique([estudiante_id, sector_id])
  @@index([estudiante_id])
  @@index([sector_id])
  @@map("estudiante_sectores")
}

/// Modelo para equipos de gamificaci贸n
/// Representa los equipos a los que pueden unirse los estudiantes
model Equipo {
  /// Identificador 煤nico del equipo
  id               String       @id @default(cuid())
  /// Nombre 煤nico del equipo (F茅nix, Drag贸n, Tigre, guila)
  nombre           String       @unique
  /// Color primario del equipo en formato hexadecimal
  color_primario   String
  /// Color secundario del equipo en formato hexadecimal
  color_secundario String
  /// URL del 铆cono del equipo (opcional)
  icono_url        String?
  /// Puntos totales acumulados por el equipo
  puntos_totales   Int          @default(0)
  /// Timestamp de creaci贸n del registro
  createdAt        DateTime     @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt        DateTime     @updatedAt
  estudiantes      Estudiante[]

  @@map("equipos")
}

/// Modelo para docentes (profesores) de la plataforma
/// Representa a los usuarios educadores que dictan clases
model Docente {
  /// Identificador 煤nico del docente
  id                                 String                    @id @default(cuid())
  /// Email 煤nico del docente - usado para autenticaci贸n
  email                              String                    @unique
  /// Hash bcrypt de la contrase帽a
  password_hash                      String
  /// Password temporal en texto plano - se muestra al admin al crear el docente
  /// Se borra despu茅s del primer cambio de contrase帽a
  password_temporal                  String?
  /// Nombre del docente
  nombre                             String
  /// Apellido del docente
  apellido                           String
  /// T铆tulo profesional (ej: "Profesor de Matem谩tica", "Licenciado en F铆sica")
  titulo                             String?
  /// Biograf铆a o descripci贸n del docente
  bio                                String?
  /// Timestamp de creaci贸n del registro
  createdAt                          DateTime                  @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt                          DateTime                  @updatedAt
  /// Disponibilidad horaria del docente (ej: {"lunes": ["09:00-12:00", "14:00-18:00"], "martes": ["10:00-13:00"]})
  /// Se almacena como JSON object con d铆as de la semana como keys
  disponibilidad_horaria             Json?
  /// Especialidades del docente (ej: ["lgebra", "Geometr铆a", "Trigonometr铆a"])
  /// Se almacena como JSON array de strings
  especialidades                     Json?
  /// Estado del docente (activo, inactivo, vacaciones)
  estado                             String                    @default("activo")
  /// A帽os de experiencia docente
  experiencia_anos                   Int?
  /// Nivel educativo que el docente puede impartir (ej: ["Primaria", "Secundaria", "Universidad"])
  /// Se almacena como JSON array de strings
  nivel_educativo                    Json?
  /// Roles asignados al docente (puede ser docente y admin simult谩neamente)
  /// Ejemplo: ["docente", "admin"]
  roles                              Json                      @default("[\"docente\"]")
  /// Tel茅fono de contacto (opcional)
  telefono                           String?
  /// Indica si el docente debe cambiar su contrase帽a en el pr贸ximo login
  /// true = contrase帽a temporal (generada por admin)
  /// false = contrase帽a elegida por el docente
  debe_cambiar_password              Boolean                   @default(true)
  /// Fecha del 煤ltimo cambio de contrase帽a
  fecha_ultimo_cambio                DateTime?
  clases                             Clase[]
  claseGrupos                        ClaseGrupo[]
  rutasEspecialidad                  DocenteRuta[]
  eventos                            Evento[]
  logrosAprobados                    LogroDesbloqueado[]       @relation("LogrosAprobados")
  notificaciones                     Notificacion[]
  puntosOtorgados                    PuntoObtenido[]           @relation("PuntosOtorgados")
  asignacionesPlanificaciones        AsignacionDocente[]
  asignacionesPlanificacionesSimples AsignacionPlanificacion[]

  @@map("docentes")
}

/// Modelo para administradores del sistema
/// Tienen acceso completo al dashboard administrativo
model Admin {
  /// Identificador 煤nico del admin (CUID)
  id                    String    @id @default(cuid())
  /// Email 煤nico del admin - usado para autenticaci贸n
  email                 String    @unique
  /// Hash bcrypt de la contrase帽a - NUNCA se env铆a al frontend
  password_hash         String
  /// Password temporal en texto plano - se muestra al crear el admin
  /// Se borra despu茅s del primer cambio de contrase帽a
  password_temporal     String?
  /// Indica si el admin debe cambiar su contrase帽a en el pr贸ximo login
  debe_cambiar_password Boolean   @default(true)
  /// Fecha del 煤ltimo cambio de contrase帽a
  fecha_ultimo_cambio   DateTime?
  /// Nombre del admin
  nombre                String
  /// Apellido del admin
  apellido              String
  /// Fecha en que el admin fue creado
  fecha_registro        DateTime  @default(now())
  /// Timestamp de creaci贸n del registro
  createdAt             DateTime  @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt             DateTime  @updatedAt
  /// DNI del admin (opcional)
  dni                   String?
  /// Roles asignados al admin (puede ser admin y docente simult谩neamente)
  /// Ejemplo: ["admin", "docente"]
  roles                 Json      @default("[\"admin\"]")
  /// Tel茅fono del admin (opcional)
  telefono              String?

  @@map("admins")
}

/// Modelo para productos del cat谩logo
/// Representa los productos que se pueden comprar: suscripciones, cursos, recursos
model Producto {
  /// Identificador 煤nico del producto
  id                      String               @id @default(cuid())
  /// Nombre del producto (ej: "Suscripci贸n Mensual", "Curso de lgebra")
  nombre                  String
  /// Descripci贸n detallada del producto
  descripcion             String?
  /// Precio del producto en pesos (formato decimal para precisi贸n)
  precio                  Decimal              @db.Decimal(10, 2)
  /// Tipo de producto (Suscripcion, Curso, RecursoDigital)
  tipo                    TipoProducto
  /// Indica si el producto est谩 activo y disponible para compra
  activo                  Boolean              @default(true)
  /// Fecha de inicio del curso (solo para tipo Curso)
  fecha_inicio            DateTime?
  /// Fecha de finalizaci贸n del curso (solo para tipo Curso)
  fecha_fin               DateTime?
  /// Cupo m谩ximo de estudiantes (solo para tipo Curso)
  cupo_maximo             Int?
  /// Duraci贸n en meses de la suscripci贸n (1=mensual, 12=anual, etc.)
  duracion_meses          Int?                 @default(1)
  /// Timestamp de creaci贸n del registro
  createdAt               DateTime             @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt               DateTime             @updatedAt
  clases                  Clase[]
  inscripciones_curso     InscripcionCurso[]
  membresias              Membresia[]
  modulos                 Modulo[]
  inscripciones_mensuales InscripcionMensual[]

  @@map("productos")
}

/// Modelo para membres铆as de suscripci贸n
/// Vincula un tutor con un producto de tipo Suscripcion
model Membresia {
  /// Identificador 煤nico de la membres铆a
  id                 String          @id @default(cuid())
  /// ID del tutor propietario de la membres铆a
  tutor_id           String
  /// ID del producto de suscripci贸n
  producto_id        String
  /// Estado actual de la membres铆a
  estado             EstadoMembresia @default(Pendiente)
  /// Fecha de inicio de la membres铆a (se llena cuando webhook confirma)
  fecha_inicio       DateTime?
  /// Fecha del pr贸ximo pago (se calcula cuando webhook confirma)
  fecha_proximo_pago DateTime?
  /// ID de preferencia de MercadoPago (para tracking)
  preferencia_id     String?
  /// Timestamp de creaci贸n del registro
  createdAt          DateTime        @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt          DateTime        @updatedAt
  producto           Producto        @relation(fields: [producto_id], references: [id])
  tutor              Tutor           @relation(fields: [tutor_id], references: [id], onDelete: Cascade)

  @@index([tutor_id, estado])
  @@index([preferencia_id])
  @@map("membresias")
}

/// Modelo para inscripciones a cursos
/// Vincula un estudiante con un producto de tipo Curso
model InscripcionCurso {
  /// Identificador 煤nico de la inscripci贸n
  id                String                 @id @default(cuid())
  /// ID del estudiante inscrito
  estudiante_id     String
  /// ID del producto curso
  producto_id       String
  /// Estado de la inscripci贸n
  estado            EstadoInscripcionCurso @default(PreInscrito)
  /// Fecha de inscripci贸n
  fecha_inscripcion DateTime               @default(now())
  /// ID de preferencia de MercadoPago (para tracking)
  preferencia_id    String?
  /// Timestamp de creaci贸n del registro
  createdAt         DateTime               @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt         DateTime               @updatedAt
  estudiante        Estudiante             @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  producto          Producto               @relation(fields: [producto_id], references: [id])

  @@unique([estudiante_id, producto_id])
  @@index([estudiante_id, estado])
  @@index([preferencia_id])
  @@map("inscripciones_curso")
}

/// Modelo para rutas curriculares (temas/categor铆as de clases)
/// Representa los temas o 谩reas de conocimiento de las clases
model RutaCurricular {
  /// Identificador 煤nico de la ruta
  id          String       @id @default(cuid())
  /// Nombre de la ruta (ej: "L贸gica", "lgebra", "Geometr铆a")
  nombre      String       @unique
  /// Color hexadecimal para identificaci贸n visual (opcional)
  color       String?
  /// Descripci贸n de la ruta curricular
  descripcion String?
  /// Timestamp de creaci贸n del registro
  createdAt   DateTime     @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt   DateTime     @updatedAt
  clases      Clase[]
  claseGrupos ClaseGrupo[]

  @@map("rutas_curriculares")
}

/// Modelo para clases programadas
/// Representa una clase en vivo programada por un admin
model Clase {
  /// Identificador 煤nico de la clase
  id                 String             @id @default(cuid())
  /// ID de la ruta curricular (tema de la clase) - OPCIONAL
  ruta_curricular_id String?
  /// ID del docente asignado a la clase
  docente_id         String
  /// Fecha y hora de inicio de la clase
  fecha_hora_inicio  DateTime
  /// Duraci贸n de la clase en minutos
  duracion_minutos   Int
  /// Estado de la clase (Programada, Cancelada)
  estado             EstadoClase        @default(Programada)
  /// Cupo m谩ximo de estudiantes
  cupos_maximo       Int
  /// Cupos ocupados actualmente
  cupos_ocupados     Int                @default(0)
  /// ID del producto curso (opcional - si null es clase de suscripci贸n general)
  /// Si tiene valor, solo estudiantes con InscripcionCurso activa pueden reservar
  producto_id        String?
  /// Timestamp de creaci贸n del registro
  createdAt          DateTime           @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt          DateTime           @updatedAt
  /// Descripci贸n o grupo de la clase (ej: "Ni帽os 6-7 a帽os", "Grupo A", "Preparaci贸n olimpiadas")
  descripcion        String?
  /// Nombre o tema de la clase (ej: "Godot", "Scratch", "Preparaci贸n Olimpiadas")
  nombre             String
  /// ID del sector (Matem谩tica o Programaci贸n) - OPCIONAL
  sector_id          String?
  alertas            Alerta[]
  asistencias        Asistencia[]
  docente            Docente            @relation(fields: [docente_id], references: [id])
  producto           Producto?          @relation(fields: [producto_id], references: [id])
  rutaCurricular     RutaCurricular?    @relation(fields: [ruta_curricular_id], references: [id])
  sector             Sector?            @relation(fields: [sector_id], references: [id])
  eventos            Evento[]
  inscripciones      InscripcionClase[]
  puntosObtenidos    PuntoObtenido[]

  @@index([docente_id])
  @@index([fecha_hora_inicio])
  @@index([estado])
  @@index([producto_id])
  @@map("clases")
}

/// Modelo para Grupos Pedag贸gicos
/// Representa los niveles educativos o categor铆as pedag贸gicas (B1, B2, B3, A1, etc.)
/// Los grupos son conceptos estables que agrupan contenido pedag贸gico del mismo nivel
model Grupo {
  /// Identificador 煤nico del grupo
  id String @id @default(cuid())

  /// C贸digo del grupo (ej: "B1", "B2", "B3", "A1", "OLIMP")
  codigo String @unique

  /// Nombre descriptivo del grupo
  nombre String // "B谩sico 1", "B谩sico 2", "Avanzado 1"

  /// Descripci贸n del grupo y nivel educativo
  descripcion String?

  /// Rango de edad sugerido
  edad_minima Int?
  edad_maxima Int?

  /// Sector al que pertenece (Matem谩tica o Programaci贸n)
  sector_id String?

  /// Indica si el grupo est谩 activo
  activo Boolean @default(true)

  /// Timestamp de creaci贸n
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n
  updatedAt DateTime @updatedAt

  /// Relaciones
  sector Sector? @relation(fields: [sector_id], references: [id])

  /// Comisiones (instancias operativas) de este grupo
  comisiones ClaseGrupo[]

  /// Planificaciones mensuales dirigidas a este grupo
  planificaciones PlanificacionMensual[]

  @@index([codigo])
  @@index([activo])
  @@map("grupos")
}

/// Modelo para grupos de clases recurrentes (ahora llamado Comision conceptualmente)
/// Representa un grupo estable de estudiantes que se re煤ne semanalmente
/// Ejemplo: "GRUPO B1 - Matem谩tica - Lunes 19:30"
model ClaseGrupo {
  /// Identificador 煤nico del grupo
  id String @id @default(cuid())

  /// C贸digo del grupo pedag贸gico (puede repetirse, ej: "B2" para varios horarios)
  /// Se usa principalmente para identificaci贸n visual, no es unique
  codigo String

  /// Nombre descriptivo del grupo (este s铆 es 煤nico por instancia)
  nombre String @unique

  /// Tipo de clase grupo
  tipo TipoClaseGrupo @default(GRUPO_REGULAR)

  /// D铆a de la semana en que se re煤ne
  dia_semana DiaSemana

  /// Hora de inicio en formato HH:MM (ej: "19:30")
  hora_inicio String

  /// Hora de fin en formato HH:MM (ej: "21:00")
  hora_fin String

  /// Fecha de inicio de vigencia del grupo
  fecha_inicio DateTime

  /// Fecha de fin de vigencia del grupo
  /// Para GRUPO_REGULAR: siempre 15 de diciembre del a帽o
  /// Para CURSO_TEMPORAL: fecha espec铆fica definida por admin
  fecha_fin DateTime

  /// A帽o lectivo al que pertenece (ej: 2025)
  anio_lectivo Int

  /// Cupo m谩ximo de estudiantes
  cupo_maximo Int @default(15)

  /// ID del grupo pedag贸gico al que pertenece (B1, B2, B3, etc.)
  grupo_id String

  /// ID del docente asignado
  docente_id String

  /// ID de la ruta curricular (tema)
  ruta_curricular_id String?

  /// ID del sector (Matem谩tica o Programaci贸n)
  sector_id String?

  /// Nivel o descripci贸n (ej: "6 y 7 a帽os", "Preparaci贸n olimpiadas")
  nivel String?

  /// Indica si el grupo est谩 activo
  activo Boolean @default(true)

  /// Timestamp de creaci贸n
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n
  updatedAt DateTime @updatedAt

  /// Relaciones
  grupo          Grupo           @relation(fields: [grupo_id], references: [id])
  docente        Docente         @relation(fields: [docente_id], references: [id])
  rutaCurricular RutaCurricular? @relation(fields: [ruta_curricular_id], references: [id])
  sector         Sector?         @relation(fields: [sector_id], references: [id])

  /// Estudiantes inscritos en el grupo
  inscripciones InscripcionClaseGrupo[]

  /// Registros de asistencia del grupo
  asistencias AsistenciaClaseGrupo[]

  /// Asignaciones de planificaciones mensuales
  asignacionesPlanificaciones AsignacionDocente[]

  /// Asignaciones de actividades semanales
  asignacionesActividades AsignacionActividadEstudiante[]

  /// Asignaciones de planificaciones simples
  asignacionesPlanificacionesSimples AsignacionPlanificacion[]

  @@index([docente_id])
  @@index([dia_semana])
  @@index([fecha_inicio, fecha_fin])
  @@index([anio_lectivo])
  @@index([activo])
  @@map("clase_grupos")
}

/// Inscripci贸n de un estudiante a un ClaseGrupo
/// Relaci贸n muchos-a-muchos entre Estudiante y ClaseGrupo
model InscripcionClaseGrupo {
  /// Identificador 煤nico
  id String @id @default(cuid())

  /// ID del grupo de clase
  clase_grupo_id String

  /// ID del estudiante inscrito
  estudiante_id String

  /// ID del tutor del estudiante
  tutor_id String

  /// Fecha de inscripci贸n al grupo
  fecha_inscripcion DateTime @default(now())

  /// Fecha de baja del grupo (si se retira antes del fin)
  fecha_baja DateTime?

  /// Observaciones
  observaciones String?

  /// Timestamp de creaci贸n
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n
  updatedAt DateTime @updatedAt

  /// Relaciones
  claseGrupo ClaseGrupo @relation(fields: [clase_grupo_id], references: [id], onDelete: Cascade)
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  tutor      Tutor      @relation(fields: [tutor_id], references: [id])

  @@unique([clase_grupo_id, estudiante_id])
  @@index([estudiante_id])
  @@index([tutor_id])
  @@index([clase_grupo_id])
  @@map("inscripciones_clase_grupo")
}

/// Registro de asistencia a una sesi贸n espec铆fica de un ClaseGrupo
/// Se crea cuando el docente marca asistencia un d铆a espec铆fico
model AsistenciaClaseGrupo {
  /// Identificador 煤nico
  id String @id @default(cuid())

  /// ID del grupo de clase
  clase_grupo_id String

  /// ID del estudiante
  estudiante_id String

  /// Fecha espec铆fica de la clase (ej: "2025-10-21" para el lunes 21/10)
  fecha DateTime

  /// Estado de asistencia
  estado EstadoAsistencia

  /// Observaciones del docente sobre el estudiante en esta clase
  observaciones String?

  /// Calificaci贸n o feedback cualitativo (opcional)
  feedback String?

  /// Timestamp de creaci贸n
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n
  updatedAt DateTime @updatedAt

  /// Relaciones
  claseGrupo ClaseGrupo @relation(fields: [clase_grupo_id], references: [id], onDelete: Cascade)
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  @@unique([clase_grupo_id, estudiante_id, fecha])
  @@index([clase_grupo_id])
  @@index([estudiante_id])
  @@index([fecha])
  @@map("asistencias_clase_grupo")
}

/// Modelo para inscripciones a clases (reservas)
/// Vincula un estudiante con una clase espec铆fica
model InscripcionClase {
  /// Identificador 煤nico de la inscripci贸n
  id                String     @id @default(cuid())
  /// ID de la clase
  clase_id          String
  /// ID del estudiante inscrito
  estudiante_id     String
  /// ID del tutor que realiz贸 la reserva
  tutor_id          String
  /// Fecha de la inscripci贸n
  fecha_inscripcion DateTime   @default(now())
  /// Observaciones o notas sobre la inscripci贸n
  observaciones     String?
  /// Timestamp de creaci贸n del registro
  createdAt         DateTime   @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt         DateTime   @updatedAt
  clase             Clase      @relation(fields: [clase_id], references: [id], onDelete: Cascade)
  estudiante        Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  tutor             Tutor      @relation(fields: [tutor_id], references: [id])

  @@unique([clase_id, estudiante_id])
  @@index([estudiante_id])
  @@index([tutor_id])
  @@map("inscripciones_clase")
}

/// Modelo para registro de asistencia
/// Registra la asistencia y feedback del docente despu茅s de la clase
model Asistencia {
  /// Identificador 煤nico del registro de asistencia
  id               String           @id @default(cuid())
  /// ID de la clase
  clase_id         String
  /// ID del estudiante
  estudiante_id    String
  /// Estado de asistencia (Presente, Ausente, Justificado)
  estado           EstadoAsistencia
  /// Observaciones del docente sobre el estudiante en esta clase
  observaciones    String?
  /// Puntos otorgados al estudiante en esta clase (para gamificaci贸n)
  puntos_otorgados Int              @default(0)
  /// Fecha y hora del registro de asistencia
  fecha_registro   DateTime         @default(now())
  /// Timestamp de creaci贸n del registro
  createdAt        DateTime         @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt        DateTime         @updatedAt
  clase            Clase            @relation(fields: [clase_id], references: [id], onDelete: Cascade)
  estudiante       Estudiante       @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  @@unique([clase_id, estudiante_id])
  @@index([estudiante_id])
  @@index([estado])
  @@index([clase_id, estudiante_id, estado])
  @@map("asistencias")
}

/// Modelo para alertas administrativas generadas desde observaciones de docentes
/// Permite al admin detectar y resolver situaciones que requieren atenci贸n
model Alerta {
  /// Identificador 煤nico de la alerta
  id            String     @id @default(cuid())
  /// ID del estudiante relacionado con la alerta
  estudiante_id String
  /// ID de la clase donde se gener贸 la alerta
  clase_id      String
  /// Descripci贸n de la alerta (observaciones del docente)
  descripcion   String
  /// Fecha de creaci贸n de la alerta
  fecha         DateTime   @default(now())
  /// Indica si la alerta ha sido resuelta
  resuelta      Boolean    @default(false)
  /// Timestamp de creaci贸n del registro
  createdAt     DateTime   @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt     DateTime   @updatedAt
  clase         Clase      @relation(fields: [clase_id], references: [id], onDelete: Cascade)
  estudiante    Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  @@index([estudiante_id])
  @@index([resuelta])
  @@index([fecha])
  @@map("alertas")
}

/// Modelo para acciones puntuables (configuraci贸n de gamificaci贸n)
/// Define las acciones por las cuales un docente puede otorgar puntos
model AccionPuntuable {
  /// Identificador 煤nico de la acci贸n
  id              String          @id @default(cuid())
  /// Nombre de la acci贸n (ej: "Razonamiento destacado", "Participaci贸n activa")
  nombre          String          @unique
  /// Descripci贸n de la acci贸n
  descripcion     String
  /// Cantidad de puntos que otorga esta acci贸n
  puntos          Int
  /// Indica si la acci贸n est谩 activa
  activo          Boolean         @default(true)
  /// Timestamp de creaci贸n del registro
  createdAt       DateTime        @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt       DateTime        @updatedAt
  puntosObtenidos PuntoObtenido[]

  @@map("acciones_puntuables")
}

/// Modelo para logros/insignias (configuraci贸n de gamificaci贸n)
/// Define los logros que los estudiantes pueden desbloquear
model Logro {
  /// Identificador 煤nico del logro
  id                  String              @id @default(cuid())
  /// Nombre del logro (ej: "Primera Clase", "Asistencia Perfecta")
  nombre              String              @unique
  /// Descripci贸n del logro
  descripcion         String
  /// Icono o emoji del logro
  icono               String
  /// Puntos extra que otorga desbloquear este logro
  puntos              Int                 @default(0)
  /// URL de la imagen del badge (opcional)
  imagen_url          String?
  /// Requisito o condici贸n para desbloquear (texto descriptivo)
  requisito           String?
  /// Indica si el logro est谩 activo
  activo              Boolean             @default(true)
  /// Timestamp de creaci贸n del registro
  createdAt           DateTime            @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt           DateTime            @updatedAt
  leccionesDesbloque  Leccion[]
  logrosDesbloqueados LogroDesbloqueado[]

  @@map("logros")
}

/// Modelo para registro de puntos obtenidos (tabla transaccional)
/// Cada registro representa un evento donde un estudiante gan贸 puntos
model PuntoObtenido {
  /// Identificador 煤nico del registro
  id             String          @id @default(cuid())
  /// ID del estudiante que obtuvo los puntos
  estudiante_id  String
  /// ID del docente que otorg贸 los puntos
  docente_id     String
  /// ID de la acci贸n puntuable
  accion_id      String
  /// ID de la clase donde se ganaron los puntos (opcional)
  clase_id       String?
  /// Cantidad de puntos otorgados (se guarda para preservar historial)
  puntos         Int
  /// Contexto o raz贸n adicional (opcional)
  contexto       String?
  /// Fecha y hora en que se otorgaron los puntos
  fecha_otorgado DateTime        @default(now())
  /// Timestamp de creaci贸n del registro
  createdAt      DateTime        @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt      DateTime        @updatedAt
  accion         AccionPuntuable @relation(fields: [accion_id], references: [id])
  clase          Clase?          @relation(fields: [clase_id], references: [id])
  docente        Docente         @relation("PuntosOtorgados", fields: [docente_id], references: [id])
  estudiante     Estudiante      @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  @@index([estudiante_id])
  @@index([docente_id])
  @@index([accion_id])
  @@index([fecha_otorgado])
  @@map("puntos_obtenidos")
}

/// Modelo para logros desbloqueados (tabla transaccional)
/// Registra cuando un estudiante desbloquea un logro
model LogroDesbloqueado {
  /// Identificador 煤nico del registro
  id             String     @id @default(cuid())
  /// ID del estudiante que desbloque贸 el logro
  estudiante_id  String
  /// ID del logro desbloqueado
  logro_id       String
  /// ID del docente que otorg贸 el logro (opcional, puede ser autom谩tico)
  docente_id     String?
  /// Fecha y hora en que se desbloque贸 el logro
  fecha_obtenido DateTime   @default(now())
  /// Contexto o raz贸n del desbloqueo (opcional)
  contexto       String?
  /// Timestamp de creaci贸n del registro
  createdAt      DateTime   @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt      DateTime   @updatedAt
  docente        Docente?   @relation("LogrosAprobados", fields: [docente_id], references: [id])
  estudiante     Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  logro          Logro      @relation(fields: [logro_id], references: [id])

  @@unique([estudiante_id, logro_id])
  @@index([estudiante_id])
  @@index([logro_id])
  @@index([fecha_obtenido])
  @@map("logros_desbloqueados")
}

/// M贸dulo dentro de un curso
/// Agrupa lecciones relacionadas tem谩ticamente
/// Ejemplo: "M贸dulo 1: Variables y Expresiones"
model Modulo {
  /// Identificador 煤nico del m贸dulo
  id                        String    @id @default(cuid())
  /// ID del producto (curso) al que pertenece
  producto_id               String
  /// T铆tulo del m贸dulo visible para estudiantes
  /// Ejemplo: "Fundamentos de lgebra"
  titulo                    String
  /// Descripci贸n breve del m贸dulo (opcional)
  /// Ayuda al estudiante a entender qu茅 aprender谩
  descripcion               String?
  /// Orden de presentaci贸n del m贸dulo dentro del curso
  /// 1, 2, 3... Permite reordenamiento manual
  orden                     Int
  /// Duraci贸n estimada total del m贸dulo en minutos
  /// Suma autom谩tica de duraciones de lecciones
  duracion_estimada_minutos Int       @default(0)
  /// Cantidad de puntos totales que otorga completar el m贸dulo
  /// Suma de puntos_por_completar de todas las lecciones
  puntos_totales            Int       @default(0)
  /// Si est谩 publicado y visible para estudiantes
  publicado                 Boolean   @default(false)
  /// Timestamp de creaci贸n del registro
  createdAt                 DateTime  @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt                 DateTime  @updatedAt
  lecciones                 Leccion[]
  producto                  Producto  @relation(fields: [producto_id], references: [id], onDelete: Cascade)

  @@index([producto_id, orden])
  @@index([producto_id])
  @@map("modulos")
}

/// Lecci贸n individual dentro de un m贸dulo
/// Unidad m铆nima de aprendizaje (Microlearning)
/// Duraci贸n recomendada: 5-15 minutos
model Leccion {
  /// Identificador 煤nico de la lecci贸n
  id                        String            @id @default(cuid())
  /// ID del m贸dulo al que pertenece
  modulo_id                 String
  /// T铆tulo de la lecci贸n visible para estudiantes
  /// Debe ser descriptivo y claro
  /// Ejemplo: "C贸mo resolver ecuaciones lineales"
  titulo                    String
  /// Descripci贸n opcional de la lecci贸n
  /// Resumen de lo que aprender谩 el estudiante
  descripcion               String?
  /// Tipo de contenido de esta lecci贸n
  tipo_contenido            TipoContenido
  /// Contenido de la lecci贸n (formato seg煤n tipo)
  /// - Video: URL del video
  /// - Texto: Markdown con el contenido
  /// - Quiz: JSON con preguntas y opciones
  /// - Tarea: JSON con instrucciones y rubrica
  contenido                 String
  /// Orden de presentaci贸n dentro del m贸dulo
  /// 1, 2, 3... Permite reordenamiento manual
  orden                     Int
  /// Puntos otorgados al completar esta lecci贸n
  /// Incentiva al estudiante a terminar
  /// Rango recomendado: 5-20 puntos por lecci贸n
  puntos_por_completar      Int               @default(10)
  /// ID del logro que se desbloquea al completar (opcional)
  /// Ejemplo: "Maestro del lgebra" al terminar m贸dulo completo
  logro_desbloqueable_id    String?
  /// Duraci贸n estimada en minutos
  /// Ayuda al estudiante a planificar su tiempo
  /// Rango recomendado: 5-15 minutos (Microlearning)
  duracion_estimada_minutos Int?
  /// Si la lecci贸n est谩 publicada y visible
  activo                    Boolean           @default(true)
  /// Recursos adicionales (opcional)
  /// JSON con links, PDFs, etc.
  /// Ejemplo: {"links": ["https://...", "https://..."], "pdfs": ["url1"]}
  recursos_adicionales      String?
  /// Prerequisito (opcional)
  /// ID de lecci贸n que debe completarse antes
  /// Implementa Progressive Disclosure
  leccion_prerequisito_id   String?
  /// Timestamp de creaci贸n del registro
  createdAt                 DateTime          @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt                 DateTime          @updatedAt
  leccionPrerequisito       Leccion?          @relation("LeccionPrerequisito", fields: [leccion_prerequisito_id], references: [id])
  leccionesDependientes     Leccion[]         @relation("LeccionPrerequisito")
  logro                     Logro?            @relation(fields: [logro_desbloqueable_id], references: [id])
  modulo                    Modulo            @relation(fields: [modulo_id], references: [id], onDelete: Cascade)
  progresos                 ProgresoLeccion[]

  @@index([modulo_id, orden])
  @@index([modulo_id])
  @@index([tipo_contenido])
  @@map("lecciones")
}

/// Progreso de un estudiante en una lecci贸n espec铆fica
/// Tracking granular del aprendizaje (Learning Analytics)
model ProgresoLeccion {
  /// Identificador 煤nico del progreso
  id                       String     @id @default(cuid())
  /// ID del estudiante
  estudiante_id            String
  /// ID de la lecci贸n
  leccion_id               String
  /// Si la lecci贸n fue completada
  /// true = estudiante termin贸 y marc贸 como completada
  completada               Boolean    @default(false)
  /// Porcentaje de progreso (0-100)
  /// til para lecciones largas o videos
  /// 0 = no iniciado, 50 = a la mitad, 100 = completado
  progreso                 Int        @default(0)
  /// Fecha y hora en que inici贸 la lecci贸n
  fecha_inicio             DateTime   @default(now())
  /// Fecha y hora en que complet贸 la lecci贸n (si aplica)
  fecha_completada         DateTime?
  /// Tiempo total invertido en minutos (opcional)
  /// til para analytics y m茅tricas de engagement
  tiempo_invertido_minutos Int?
  /// Calificaci贸n obtenida (para quizzes)
  /// Rango: 0-100 (porcentaje)
  calificacion             Int?
  /// N煤mero de intentos (para quizzes/tareas)
  intentos                 Int        @default(0)
  /// Notas del estudiante (opcional)
  /// Permite al estudiante tomar apuntes privados
  notas_estudiante         String?
  /// ltima respuesta del estudiante (para quizzes/tareas)
  /// JSON con las respuestas dadas
  ultima_respuesta         String?
  /// Timestamp de creaci贸n del registro
  createdAt                DateTime   @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt                DateTime   @updatedAt
  estudiante               Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  leccion                  Leccion    @relation(fields: [leccion_id], references: [id], onDelete: Cascade)

  @@unique([estudiante_id, leccion_id])
  @@index([estudiante_id])
  @@index([leccion_id])
  @@index([estudiante_id, completada])
  @@map("progreso_lecciones")
}

/// Sistema de notificaciones para docentes
/// Permite notificar eventos importantes como clases pr贸ximas, alertas de estudiantes, etc.
model Notificacion {
  /// Identificador 煤nico de la notificaci贸n
  id         String           @id @default(cuid())
  /// Tipo de notificaci贸n
  tipo       TipoNotificacion
  /// T铆tulo de la notificaci贸n
  titulo     String
  /// Mensaje descriptivo de la notificaci贸n
  mensaje    String
  /// Indica si la notificaci贸n ha sido le铆da
  leida      Boolean          @default(false)
  /// ID del docente al que pertenece la notificaci贸n
  docente_id String
  /// Metadata adicional en formato JSON (clase_id, estudiante_id, etc)
  metadata   Json?
  /// Timestamp de creaci贸n de la notificaci贸n
  createdAt  DateTime         @default(now())
  docente    Docente          @relation(fields: [docente_id], references: [id], onDelete: Cascade)

  @@index([docente_id, leida])
  @@index([docente_id, createdAt])
  @@map("notificaciones")
}

/// Eventos del calendario del docente
/// Modelo base polim贸rfico: puede ser Clase, Tarea, Recordatorio o Nota
model Evento {
  /// Identificador 煤nico del evento
  id             String        @id @default(cuid())
  /// T铆tulo del evento
  titulo         String
  /// Descripci贸n detallada del evento
  descripcion    String?
  /// Tipo de evento (CLASE, TAREA, RECORDATORIO, NOTA)
  tipo           TipoEvento
  /// Fecha y hora de inicio del evento
  fecha_inicio   DateTime
  /// Fecha y hora de fin del evento
  fecha_fin      DateTime
  /// Indica si el evento dura todo el d铆a
  es_todo_el_dia Boolean       @default(false)
  /// ID del docente al que pertenece el evento
  docente_id     String
  /// ID de la clase relacionada (para reprogramaci贸n/recuperaci贸n)
  clase_id       String?
  /// Timestamp de creaci贸n del evento
  createdAt      DateTime      @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del evento
  updatedAt      DateTime      @updatedAt
  clase          Clase?        @relation(fields: [clase_id], references: [id])
  docente        Docente       @relation(fields: [docente_id], references: [id], onDelete: Cascade)
  nota           Nota?
  recordatorio   Recordatorio?
  tarea          Tarea?

  @@index([docente_id, fecha_inicio])
  @@index([tipo])
  @@index([docente_id, tipo])
  @@index([clase_id])
  @@map("eventos")
}

/// Tarea administrativa/pedag贸gica del docente
/// Extensi贸n del modelo Evento para tareas con funcionalidad completa
model Tarea {
  /// Identificador 煤nico de la tarea
  id                        String         @id @default(cuid())
  /// ID del evento base asociado
  evento_id                 String         @unique
  /// Estado actual de la tarea
  estado                    EstadoTarea    @default(PENDIENTE)
  /// Nivel de prioridad de la tarea
  prioridad                 PrioridadTarea @default(MEDIA)
  /// Porcentaje de completitud (0-100)
  porcentaje_completado     Int            @default(0)
  /// Categor铆a personalizada de la tarea (ej: "Planificaci贸n", "Evaluaci贸n")
  categoria                 String?
  /// Etiquetas para organizaci贸n (array de strings)
  etiquetas                 String[]
  /// Subtareas en formato JSON
  /// Estructura: [{id: string, titulo: string, completada: boolean, orden: number}]
  subtareas                 Json           @default("[]")
  /// Archivos adjuntos en formato JSON
  /// Estructura: [{id: string, nombre: string, url: string, tipo: string, tama帽o: number}]
  archivos                  Json           @default("[]")
  /// ID de clase relacionada (opcional)
  clase_relacionada_id      String?
  /// ID de estudiante relacionado (opcional)
  estudiante_relacionado_id String?
  /// Tiempo estimado para completar en minutos
  tiempo_estimado_minutos   Int?
  /// Tiempo real invertido en minutos
  tiempo_real_minutos       Int?
  /// Configuraci贸n de recurrencia en formato JSON
  /// Estructura: {tipo: 'DIARIA'|'SEMANAL'|'MENSUAL', intervalo: number, dias_semana: number[], fecha_fin: string, excepciones: string[]}
  recurrencia               Json?
  /// Recordatorios configurados en formato JSON
  /// Estructura: [{minutos_antes: number, enviado: boolean}]
  recordatorios             Json           @default("[]")
  /// Fecha de completitud
  completedAt               DateTime?
  evento                    Evento         @relation(fields: [evento_id], references: [id], onDelete: Cascade)

  @@index([estado])
  @@index([prioridad])
  @@index([categoria])
  @@map("tareas")
}

/// Recordatorio simple para el docente
/// Extensi贸n del modelo Evento para recordatorios b谩sicos
model Recordatorio {
  /// Identificador 煤nico del recordatorio
  id         String  @id @default(cuid())
  /// ID del evento base asociado
  evento_id  String  @unique
  /// Indica si el recordatorio fue completado/marcado
  completado Boolean @default(false)
  /// Color personalizado del recordatorio (formato hex)
  color      String  @default("#6366f1")
  evento     Evento  @relation(fields: [evento_id], references: [id], onDelete: Cascade)

  @@map("recordatorios")
}

/// Nota de texto largo para el docente
/// Extensi贸n del modelo Evento para notas/apuntes
model Nota {
  /// Identificador 煤nico de la nota
  id        String  @id @default(cuid())
  /// ID del evento base asociado
  evento_id String  @unique
  /// Contenido de la nota (texto largo)
  contenido String
  /// Categor铆a de la nota (opcional)
  categoria String?
  /// Color personalizado de la nota (formato hex)
  color     String  @default("#8b5cf6")
  evento    Evento  @relation(fields: [evento_id], references: [id], onDelete: Cascade)

  @@index([categoria])
  @@map("notas")
}

/// Configuraci贸n de niveles del sistema de gamificaci贸n
/// Define los nombres creativos y requisitos para cada nivel
model NivelConfig {
  /// N煤mero del nivel (1, 2, 3, etc.)
  nivel          Int      @id
  /// Nombre creativo del nivel
  /// Ejemplos: "Explorador Num茅rico", "Maestro del C谩lculo", "Genio Matem谩tico"
  nombre         String
  /// Descripci贸n del nivel
  descripcion    String
  /// Puntos m铆nimos requeridos para alcanzar este nivel
  puntos_minimos Int
  /// Puntos m谩ximos antes de pasar al siguiente nivel
  puntos_maximos Int
  /// Color hex asociado al nivel para UI
  color          String   @default("#6366F1")
  /// Icono o emoji asociado al nivel
  icono          String   @default("")
  /// Timestamp de creaci贸n del registro
  createdAt      DateTime @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt      DateTime @updatedAt

  @@map("niveles_config")
}

/// Modelo para sectores de trabajo (Matem谩tica, Programaci贸n, etc.)
/// Permite organizar las especialidades en categor铆as principales
model Sector {
  /// Identificador 煤nico del sector
  id                 String             @id @default(cuid())
  /// Nombre del sector (ej: "Matem谩tica", "Programaci贸n")
  nombre             String             @unique
  /// Descripci贸n del sector
  descripcion        String?
  /// Color hex para UI (ej: "#FF5733")
  color              String             @default("#6366F1")
  /// Icono o emoji para UI (ej: "", "")
  icono              String             @default("")
  /// Indica si el sector est谩 activo
  activo             Boolean            @default(true)
  /// Timestamp de creaci贸n del registro
  createdAt          DateTime           @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt          DateTime           @updatedAt
  clases             Clase[]
  claseGrupos        ClaseGrupo[]
  grupos             Grupo[]
  docentes           DocenteRuta[]
  /// DEPRECADO: Relaci贸n uno-a-muchos con estudiantes (usar estudianteSectores[] en su lugar)
  estudiantes        Estudiante[]       @relation("EstudianteSectorLegacy")
  /// NUEVO: Relaci贸n muchos-a-muchos con estudiantes a trav茅s de EstudianteSector
  estudianteSectores EstudianteSector[]
  rutas              RutaEspecialidad[]

  @@map("sectores")
}

/// Modelo para rutas de especialidad personalizadas dentro de cada sector
/// Ejemplos: "Roblox", "Scratch" (Programaci贸n), "Base-Progresivo", "L贸gico-Desafiante" (Matem谩tica)
model RutaEspecialidad {
  /// Identificador 煤nico de la ruta
  id          String        @id @default(cuid())
  /// Nombre de la ruta (ej: "Roblox", "Base-Progresivo")
  nombre      String
  /// Descripci贸n de la ruta
  descripcion String?
  /// ID del sector al que pertenece
  sectorId    String
  /// Indica si la ruta est谩 activa
  activo      Boolean       @default(true)
  /// Timestamp de creaci贸n del registro
  createdAt   DateTime      @default(now())
  /// Timestamp de 煤ltima actualizaci贸n del registro
  updatedAt   DateTime      @updatedAt
  docentes    DocenteRuta[]
  sector      Sector        @relation(fields: [sectorId], references: [id], onDelete: Cascade)

  @@unique([sectorId, nombre])
  @@index([sectorId])
  @@map("rutas_especialidad")
}

/// Modelo de relaci贸n muchos-a-muchos entre Docentes y Rutas de Especialidad
/// Un docente puede trabajar en m煤ltiples rutas y sectores
model DocenteRuta {
  /// Identificador 煤nico de la relaci贸n
  id         String           @id @default(cuid())
  /// ID del docente
  docenteId  String
  /// ID de la ruta de especialidad
  rutaId     String
  /// ID del sector (desnormalizado para queries m谩s r谩pidas)
  sectorId   String
  /// Fecha de asignaci贸n
  asignadoEn DateTime         @default(now())
  docente    Docente          @relation(fields: [docenteId], references: [id], onDelete: Cascade)
  ruta       RutaEspecialidad @relation(fields: [rutaId], references: [id], onDelete: Cascade)
  sector     Sector           @relation(fields: [sectorId], references: [id], onDelete: Cascade)

  @@unique([docenteId, rutaId])
  @@index([docenteId])
  @@index([rutaId])
  @@index([sectorId])
  @@map("docentes_rutas")
}

/// Enum para tipos de productos disponibles
enum TipoProducto {
  Suscripcion
  Curso
  RecursoDigital
}

/// Enum para estados de membres铆a
enum EstadoMembresia {
  Pendiente
  Activa
  Atrasada
  Cancelada
}

/// Enum para estados de inscripci贸n a cursos
enum EstadoInscripcionCurso {
  PreInscrito
  Activo
  Finalizado
}

/// Enum para estados de clase
enum EstadoClase {
  Programada
  Cancelada
}

/// Enum para estados de asistencia
enum EstadoAsistencia {
  Presente
  Ausente
  Justificado
}

/// Tipos de contenido educativo soportados
/// Cada tipo requiere renderizado diferente en frontend
enum TipoContenido {
  Video
  Texto
  Quiz
  Tarea
  JuegoInteractivo
  Lectura
  Practica
}

/// Tipos de notificaciones disponibles
enum TipoNotificacion {
  ClaseProxima
  AsistenciaPendiente
  EstudianteAlerta
  ClaseCancelada
  LogroEstudiante
  Recordatorio
  General

  @@map("tipo_notificacion")
}

/// Tipos de eventos disponibles en el calendario
enum TipoEvento {
  CLASE
  TAREA
  RECORDATORIO
  NOTA

  @@map("tipo_evento")
}

/// Estados de una tarea
enum EstadoTarea {
  PENDIENTE
  EN_PROGRESO
  COMPLETADA
  CANCELADA

  @@map("estado_tarea")
}

/// Niveles de prioridad para tareas
enum PrioridadTarea {
  BAJA
  MEDIA
  ALTA
  URGENTE

  @@map("prioridad_tarea")
}

// ============================================================================
// SISTEMA DE PAGOS Y CONTABILIDAD
// ============================================================================

/// Configuraci贸n global de precios (Tabla singleton)
/// Solo existe UN registro con id="singleton"
model ConfiguracionPrecios {
  /// ID fijo "singleton" para garantizar un solo registro
  id String @id @default("singleton")

  /// Precios base por tipo de producto
  precio_club_matematicas      Decimal @default(50000) @db.Decimal(10, 2)
  precio_cursos_especializados Decimal @default(55000) @db.Decimal(10, 2)

  /// Precios con descuentos configurables
  precio_multiple_actividades Decimal @default(44000) @db.Decimal(10, 2)
  precio_hermanos_basico      Decimal @default(44000) @db.Decimal(10, 2)
  precio_hermanos_multiple    Decimal @default(38000) @db.Decimal(10, 2)

  /// Descuento AACREA (Asociaci贸n Altas Capacidades)
  descuento_aacrea_porcentaje Decimal @default(20) @db.Decimal(5, 2)
  descuento_aacrea_activo     Boolean @default(true)

  /// Configuraci贸n de notificaciones
  dia_vencimiento         Int     @default(15)
  dias_antes_recordatorio Int     @default(5)
  notificaciones_activas  Boolean @default(true)

  /// Metadata
  actualizado_por_admin_id String?
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt

  /// Relaciones
  historial HistorialCambioPrecios[]

  @@map("configuracion_precios")
}

/// Historial de cambios en la configuraci贸n de precios
/// Auditor铆a completa de modificaciones
model HistorialCambioPrecios {
  /// Identificador 煤nico del cambio
  id String @id @default(cuid())

  /// Referencia a la configuraci贸n
  configuracion_id String

  /// Valores antes y despu茅s del cambio (JSON flexible)
  valores_anteriores Json
  valores_nuevos     Json

  /// Metadata del cambio
  motivo_cambio String?
  admin_id      String
  fecha_cambio  DateTime @default(now())

  /// Relaciones
  configuracion ConfiguracionPrecios @relation(fields: [configuracion_id], references: [id])

  @@index([configuracion_id])
  @@index([fecha_cambio])
  @@map("historial_cambio_precios")
}

/// Inscripci贸n mensual de un estudiante a un producto
/// Reemplaza el concepto de "reserva" por facturaci贸n mensual
model InscripcionMensual {
  /// Identificador 煤nico
  id String @id @default(cuid())

  /// Relaciones principales
  estudiante_id String
  producto_id   String
  tutor_id      String

  /// Per铆odo de facturaci贸n
  anio    Int
  mes     Int // 1-12
  periodo String // "2025-01" para facilitar queries

  /// C谩lculo de precios (guardado para historial)
  precio_base        Decimal @db.Decimal(10, 2)
  descuento_aplicado Decimal @default(0) @db.Decimal(10, 2)
  precio_final       Decimal @db.Decimal(10, 2)

  /// Metadata del c谩lculo
  tipo_descuento  TipoDescuento
  detalle_calculo String // Explicaci贸n del c谩lculo aplicado

  /// Estado de pago
  estado_pago       EstadoPago @default(Pendiente)
  fecha_vencimiento DateTime? // Fecha l铆mite de pago
  fecha_pago        DateTime?
  metodo_pago       String? // "Efectivo", "Transferencia", "MercadoPago"
  comprobante_url   String? // URL del comprobante subido
  observaciones     String?

  /// Auditor铆a
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Relaciones
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  producto   Producto   @relation(fields: [producto_id], references: [id])
  tutor      Tutor      @relation(fields: [tutor_id], references: [id])

  @@unique([estudiante_id, producto_id, periodo])
  @@index([tutor_id, periodo])
  @@index([estado_pago])
  @@index([periodo])
  @@map("inscripciones_mensuales")
}

/// Gesti贸n de becas y descuentos especiales
model Beca {
  /// Identificador 煤nico
  id String @id @default(cuid())

  /// Estudiante beneficiado
  estudiante_id String

  /// Tipo y configuraci贸n de la beca
  tipo_beca        String // "M茅rito Acad茅mico", "Social", "Deportiva", etc
  descuento_tipo   DescuentoBecaTipo
  descuento_valor  Decimal           @db.Decimal(10, 2) // Porcentaje o monto fijo
  productos_aplica Json // Array de IDs de productos donde aplica

  /// Vigencia
  fecha_inicio DateTime
  fecha_fin    DateTime
  activa       Boolean  @default(true)

  /// Metadata
  motivo_beca           String?
  aprobada_por_admin_id String?
  observaciones         String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  /// Relaciones
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  @@index([estudiante_id])
  @@index([activa])
  @@map("becas")
}

// ============================================================================
// ENUMS DEL SISTEMA DE PAGOS
// ============================================================================

/// Tipos de descuento aplicables
enum TipoDescuento {
  NINGUNO
  MULTIPLE_ACTIVIDADES
  HERMANOS_BASICO
  HERMANOS_MULTIPLE
  AACREA
  BECA

  @@map("tipo_descuento")
}

/// Estados del pago
enum EstadoPago {
  Pendiente
  Pagado
  Vencido
  Parcial
  Becado

  @@map("estado_pago")
}

/// Tipo de descuento en becas
enum DescuentoBecaTipo {
  PORCENTAJE
  MONTO_FIJO

  @@map("descuento_beca_tipo")
}

/// Tipo de clase grupo
enum TipoClaseGrupo {
  GRUPO_REGULAR // Clase permanente del a帽o lectivo (finaliza 15/dic)
  CURSO_TEMPORAL // Curso con fecha de fin espec铆fica

  @@map("tipo_clase_grupo")
}

/// D铆a de la semana para clases recurrentes
enum DiaSemana {
  LUNES
  MARTES
  MIERCOLES
  JUEVES
  VIERNES
  SABADO
  DOMINGO

  @@map("dia_semana")
}

// ============================================================================
// SISTEMA DE PLANIFICACIONES MENSUALES
// ============================================================================

/// Cat谩logo de planificaciones mensuales creadas por Admin
/// Una planificaci贸n = 1 mes completo para un c贸digo de grupo (B1, B2, B3)
model PlanificacionMensual {
  /// Identificador 煤nico
  id String @id @default(cuid())

  // ===== TARGETING: A QU GRUPO VA DIRIGIDA =====
  /// ID del grupo pedag贸gico al que aplica (B1, B2, B3, A1, etc.)
  grupo_id String

  /// Mes (1-12)
  mes Int

  /// A帽o (2025, 2026, etc.)
  anio Int

  // ===== CONTENIDO =====
  /// T铆tulo de la planificaci贸n
  titulo String // "Multiplicaciones - Marzo 2025"

  /// Descripci贸n general del mes
  descripcion String

  /// Tem谩tica principal del mes
  tematica_principal String // "Multiplicaciones", "Fracciones", "Geometr铆a"

  /// Objetivos de aprendizaje del mes
  objetivos_aprendizaje String[]

  // ===== METADATA =====
  /// Estado de la planificaci贸n
  estado EstadoPlanificacion @default(BORRADOR)

  /// Fecha en que se public贸 (visible para docentes)
  fecha_publicacion DateTime?

  /// Notas para docentes (instrucciones generales)
  notas_docentes String?

  // ===== RELACIONES =====
  /// Grupo pedag贸gico al que pertenece
  grupo Grupo @relation(fields: [grupo_id], references: [id])

  /// Actividades semanales de esta planificaci贸n
  actividades ActividadSemanal[]

  /// Asignaciones que hicieron los docentes
  asignaciones AsignacionDocente[]

  // ===== AUDITORA =====
  created_by_admin_id String
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt

  /// Solo UNA planificaci贸n por grupo por mes
  @@unique([grupo_id, mes, anio])
  @@index([grupo_id, mes, anio])
  @@index([estado])
  @@map("planificaciones_mensuales")
}

/// Estados posibles de una planificaci贸n
enum EstadoPlanificacion {
  BORRADOR // Admin est谩 arm谩ndola, no visible para docentes
  PUBLICADA // Visible para docentes, pueden asignar
  ARCHIVADA // Mes pasado, solo lectura

  @@map("estado_planificacion")
}

/// Nivel de dificultad de una actividad
enum NivelDificultad {
  BASICO
  INTERMEDIO
  AVANZADO
  OLIMPICO

  @@map("nivel_dificultad")
}

/// Actividad semanal dentro de una planificaci贸n mensual
/// Cada semana tiene UNA actividad principal (juego/ejercicio)
model ActividadSemanal {
  /// Identificador 煤nico
  id String @id @default(cuid())

  /// Planificaci贸n a la que pertenece
  planificacion_id String

  // ===== UBICACIN TEMPORAL =====
  /// N煤mero de semana dentro del mes (1, 2, 3, 4)
  semana_numero Int

  /// T铆tulo de la semana
  titulo String // "Semana 1: Tablas del 1 al 3"

  /// Descripci贸n de la actividad
  descripcion String

  // ===== COMPONENTE REACT =====
  /// Nombre del componente React que se va a renderizar
  componente_nombre String // "JuegoTablasMultiplicar"

  /// Props que recibe el componente (JSON flexible)
  componente_props Json // { "tablas": [1,2,3], "nivel": "basico" }

  // ===== CONFIGURACIN PEDAGGICA =====
  /// Nivel de dificultad
  nivel_dificultad NivelDificultad

  /// Tiempo estimado en minutos
  tiempo_estimado_minutos Int

  /// Puntos de gamificaci贸n que se pueden obtener
  puntos_gamificacion Int

  // ===== INSTRUCCIONES =====
  /// Instrucciones para el docente
  instrucciones_docente String

  /// Instrucciones para el estudiante
  instrucciones_estudiante String

  // ===== RECURSOS ADICIONALES =====
  /// URLs de recursos (PDFs, videos, links)
  recursos_url Json? // [{ "tipo": "pdf", "titulo": "Gu铆a", "url": "..." }]

  /// Orden dentro de la planificaci贸n (para futuras expansiones)
  orden Int @default(1)

  // ===== RELACIONES =====
  planificacion PlanificacionMensual @relation(fields: [planificacion_id], references: [id], onDelete: Cascade)

  /// Asignaciones de esta actividad espec铆fica
  asignacionesActividad AsignacionActividadEstudiante[]

  /// Progreso de estudiantes en esta actividad
  progresosEstudiantes ProgresoEstudianteActividad[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@index([planificacion_id, semana_numero])
  @@map("actividades_semanales")
}

/// Asignaci贸n de una planificaci贸n completa por un docente a su grupo
/// El docente "activa" la planificaci贸n del mes para su grupo
model AsignacionDocente {
  /// Identificador 煤nico
  id String @id @default(cuid())

  /// Planificaci贸n que se asigna
  planificacion_id String

  /// Grupo al que se asigna
  clase_grupo_id String

  /// Docente que hace la asignaci贸n
  docente_id String

  // ===== CONTROL DEL DOCENTE =====
  /// Si est谩 activa o pausada
  activo Boolean @default(true)

  /// Fecha en que el docente activ贸 esta planificaci贸n
  fecha_asignacion DateTime @default(now())

  /// Mensaje personalizado del docente (opcional)
  mensaje_docente String?

  /// Fecha de inicio custom (por si el docente quiere empezar antes/despu茅s)
  fecha_inicio_custom DateTime?

  // ===== RELACIONES =====
  planificacion PlanificacionMensual @relation(fields: [planificacion_id], references: [id])
  claseGrupo    ClaseGrupo           @relation(fields: [clase_grupo_id], references: [id])
  docente       Docente              @relation(fields: [docente_id], references: [id])

  /// Asignaciones de actividades individuales
  asignacionesActividades AsignacionActividadEstudiante[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  /// Un docente solo puede asignar una planificaci贸n una vez a su grupo
  @@unique([planificacion_id, clase_grupo_id])
  @@index([clase_grupo_id, docente_id])
  @@map("asignaciones_docente")
}

/// Asignaci贸n de una actividad semanal espec铆fica a estudiantes
/// El docente controla CUNDO y A QUINES asigna cada semana
model AsignacionActividadEstudiante {
  /// Identificador 煤nico
  id String @id @default(cuid())

  /// Asignaci贸n padre (de la planificaci贸n completa)
  asignacion_docente_id String

  /// Actividad semanal espec铆fica
  actividad_id String

  /// Grupo al que se asigna (heredado de asignacion_docente)
  clase_grupo_id String

  // ===== CONTROL TEMPORAL =====
  /// Fecha en que se hace visible para los estudiantes
  fecha_inicio DateTime

  /// Fecha l铆mite para completar (opcional)
  fecha_fin DateTime?

  /// Estado de la asignaci贸n
  estado EstadoAsignacion @default(ACTIVA)

  // ===== PERSONALIZACIN =====
  /// Mensaje personalizado del docente para esta semana
  mensaje_semana String?

  // ===== NOTIFICACIONES =====
  /// Si se notific贸 a estudiantes
  notificado_estudiantes         Boolean   @default(false)
  fecha_notificacion_estudiantes DateTime?

  /// Si se notific贸 a tutores
  notificado_tutores         Boolean   @default(false)
  fecha_notificacion_tutores DateTime?

  // ===== RELACIONES =====
  asignacionDocente AsignacionDocente @relation(fields: [asignacion_docente_id], references: [id], onDelete: Cascade)
  actividad         ActividadSemanal  @relation(fields: [actividad_id], references: [id])
  claseGrupo        ClaseGrupo        @relation(fields: [clase_grupo_id], references: [id])

  /// Progreso de cada estudiante
  progresosEstudiantes ProgresoEstudianteActividad[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@index([clase_grupo_id, fecha_inicio])
  @@index([asignacion_docente_id])
  @@map("asignaciones_actividad_estudiante")
}

/// Estados de una asignaci贸n
enum EstadoAsignacion {
  ACTIVA // Disponible para los estudiantes
  PAUSADA // Docente la paus贸 temporalmente
  FINALIZADA // Ya pas贸 la fecha l铆mite
  CANCELADA // Docente la cancel贸

  @@map("estado_asignacion")
}

/// Progreso individual de cada estudiante en cada actividad
model ProgresoEstudianteActividad {
  /// Identificador 煤nico
  id String @id @default(cuid())

  /// Estudiante
  estudiante_id String

  /// Actividad semanal
  actividad_id String

  /// Asignaci贸n espec铆fica (para saber de qu茅 grupo viene)
  asignacion_id String

  // ===== ESTADO DE PROGRESO =====
  /// Si el estudiante inici贸 la actividad
  iniciado     Boolean   @default(false)
  fecha_inicio DateTime?

  /// Si complet贸 la actividad
  completado       Boolean   @default(false)
  fecha_completado DateTime?

  // ===== MTRICAS =====
  /// Puntos obtenidos
  puntos_obtenidos Int @default(0)

  /// Tiempo total jugando (en minutos)
  tiempo_total_minutos Int @default(0)

  /// Cantidad de intentos
  intentos Int @default(0)

  /// Mejor puntaje obtenido
  mejor_puntaje Int @default(0)

  // ===== ESTADO DEL JUEGO =====
  /// Estado actual del juego (para poder continuar despu茅s)
  /// Estructura flexible seg煤n el juego
  estado_juego Json? // { "nivel": 5, "vidas": 2, "items_desbloqueados": [...] }

  /// Respuestas detalladas (para an谩lisis del docente)
  respuestas_detalle Json? // [{ "pregunta": 1, "correcta": true, "tiempo_segundos": 5 }]

  // ===== RELACIONES =====
  estudiante Estudiante                    @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  actividad  ActividadSemanal              @relation(fields: [actividad_id], references: [id])
  asignacion AsignacionActividadEstudiante @relation(fields: [asignacion_id], references: [id], onDelete: Cascade)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  /// Un estudiante solo tiene un progreso por actividad por asignaci贸n
  @@unique([estudiante_id, actividad_id, asignacion_id])
  @@index([estudiante_id])
  @@index([actividad_id])
  @@index([asignacion_id])
  @@map("progreso_estudiante_actividad")
}

// ============================================================================
// SISTEMA DE PLANIFICACIONES SIMPLIFICADO (Convention over Configuration)
// ============================================================================
//
// FILOSOFA:
// - Una planificaci贸n = UN archivo React con PLANIFICACION_CONFIG exportado
// - El sistema auto-detecta en build time
// - Solo guardamos lo m铆nimo: c贸digo, t铆tulo, grupo, estado
// - Las semanas son solo n煤meros (1-4 o 1-12)
// - La docente controla qu茅 semana est谩 activa
// - El estudiante ve solo las semanas activas
//
// FLUJO:
// 1. Program谩s: /planificaciones/2025-03-multiplicaciones-b1.tsx
// 2. Build detecta el PLANIFICACION_CONFIG
// 3. Se registra autom谩ticamente en BD
// 4. Admin asigna a docente
// 5. Docente activa semanas
// 6. Estudiante accede y juega
// ============================================================================

/// Cat谩logo de planificaciones (auto-detectadas desde c贸digo React)
model PlanificacionSimple {
  /// ID 煤nico
  id String @id @default(cuid())

  /// C贸digo 煤nico (debe coincidir con el nombre del archivo)
  /// Ej: "2025-03-multiplicaciones-b1"
  codigo String @unique

  /// T铆tulo descriptivo
  titulo String

  /// Grupo espec铆fico (B1, B2, B3, A1, etc.)
  grupo_codigo String

  /// Mes (1-12, null para cursos anuales)
  mes Int?

  /// A帽o
  anio Int

  /// Total de semanas (4 para mensuales, 8-12 para cursos)
  semanas_total Int

  /// Ruta del archivo React
  /// Ej: "planificaciones/2025-03-multiplicaciones-b1.tsx"
  archivo_path String

  /// Estado
  estado EstadoPlanificacionSimple @default(DETECTADA)

  /// Auto-detectado en build time
  auto_detectada       Boolean  @default(true)
  fecha_deteccion      DateTime @default(now())
  ultima_actualizacion DateTime @updatedAt

  /// Relaciones
  asignaciones         AsignacionPlanificacion[]
  progresosEstudiantes ProgresoEstudiantePlanificacion[]

  @@index([codigo])
  @@index([grupo_codigo])
  @@index([estado])
  @@map("planificaciones_simples")
}

/// Estados simples de una planificaci贸n
enum EstadoPlanificacionSimple {
  DETECTADA // Auto-detectada, no asignada a煤n
  ASIGNADA // Asignada a al menos una docente
  ARCHIVADA // Desactivada

  @@map("estado_planificacion_simple")
}

/// Asignaci贸n de planificaci贸n a docente y grupo
model AsignacionPlanificacion {
  /// ID 煤nico
  id String @id @default(cuid())

  /// Planificaci贸n asignada
  planificacion_id String

  /// Docente responsable
  docente_id String

  /// Grupo espec铆fico (comisi贸n)
  clase_grupo_id String

  /// Fecha de asignaci贸n
  fecha_asignacion DateTime @default(now())

  /// Activa o no
  activa Boolean @default(true)

  /// Relaciones
  planificacion PlanificacionSimple @relation(fields: [planificacion_id], references: [id], onDelete: Cascade)
  docente       Docente             @relation(fields: [docente_id], references: [id])
  claseGrupo    ClaseGrupo          @relation(fields: [clase_grupo_id], references: [id])

  /// Control de semanas
  semanas_activas SemanaActiva[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@unique([planificacion_id, clase_grupo_id])
  @@index([docente_id])
  @@map("asignaciones_planificacion")
}

/// Control de qu茅 semanas est谩n activas
model SemanaActiva {
  /// ID 煤nico
  id String @id @default(cuid())

  /// Asignaci贸n padre
  asignacion_id String

  /// N煤mero de semana (1-12)
  numero_semana Int

  /// Activa para estudiantes
  activa Boolean @default(false)

  /// Fecha de activaci贸n
  fecha_activacion DateTime?

  /// Relaci贸n
  asignacion AsignacionPlanificacion @relation(fields: [asignacion_id], references: [id], onDelete: Cascade)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@unique([asignacion_id, numero_semana])
  @@index([asignacion_id])
  @@index([activa])
  @@map("semanas_activas")
}

/// Progreso de estudiante en una planificaci贸n (global)
model ProgresoEstudiantePlanificacion {
  /// ID 煤nico
  id String @id @default(cuid())

  /// Estudiante
  estudiante_id String

  /// Planificaci贸n
  planificacion_id String

  /// Semana actual (1-12)
  semana_actual Int @default(1)

  /// ltima actividad
  ultima_actividad DateTime @default(now())

  /// Estado guardado (JSON flexible)
  /// Tu componente React guarda lo que necesite aqu铆
  estado_guardado Json?

  /// M茅tricas globales
  tiempo_total_minutos Int @default(0)
  puntos_totales       Int @default(0)

  /// Relaciones
  estudiante    Estudiante          @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  planificacion PlanificacionSimple @relation(fields: [planificacion_id], references: [id])

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@unique([estudiante_id, planificacion_id])
  @@index([estudiante_id])
  @@map("progreso_estudiante_planificacion")
}

// ============================================================================
// SISTEMA DE TIENDA Y RECURSOS (XP, MONEDAS, GEMAS)
// ============================================================================

/// Recursos del estudiante (XP, Monedas, Gemas)
/// Tabla que centraliza todos los recursos obtenibles por el estudiante
model RecursosEstudiante {
  /// Identificador 煤nico
  id String @id @default(cuid())

  /// ID del estudiante
  estudiante_id String @unique

  /// XP total acumulado (Experience Points)
  /// Se usa para niveles, desaf铆os, progresi贸n
  xp_total Int @default(0)

  /// Monedas totales (moneda principal para compras en tienda)
  /// Se obtienen completando actividades, desaf铆os, asistencias
  monedas_total Int @default(0)

  /// Gemas (moneda premium/especial)
  /// Se obtienen con logros especiales, rachas largas, eventos
  gemas_total Int @default(0)

  /// ltima actualizaci贸n de recursos
  ultima_actualizacion DateTime @updatedAt

  /// Timestamp de creaci贸n
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n
  updatedAt DateTime @updatedAt

  /// Relaciones
  estudiante     Estudiante           @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  transacciones  TransaccionRecurso[]
  compras        CompraItem[]

  @@index([estudiante_id])
  @@map("recursos_estudiante")
}

/// Transacciones de recursos (historial de cambios)
/// Tabla transaccional que registra cada cambio en XP/Monedas/Gemas
model TransaccionRecurso {
  /// Identificador 煤nico
  id String @id @default(cuid())

  /// ID del recurso del estudiante
  recursos_estudiante_id String

  /// Tipo de recurso afectado
  tipo_recurso TipoRecurso

  /// Cantidad (positivo = ganancia, negativo = gasto)
  cantidad Int

  /// Raz贸n de la transacci贸n
  /// Ejemplos: "actividad_completada", "compra_tienda", "logro_desbloqueado", "racha_7_dias"
  razon String

  /// Metadata adicional (JSON flexible)
  /// Puede contener: actividad_id, item_id, logro_id, etc.
  metadata Json?

  /// Fecha de la transacci贸n
  fecha DateTime @default(now())

  /// Timestamp de creaci贸n
  createdAt DateTime @default(now())

  /// Relaciones
  recursosEstudiante RecursosEstudiante @relation(fields: [recursos_estudiante_id], references: [id], onDelete: Cascade)

  @@index([recursos_estudiante_id])
  @@index([tipo_recurso])
  @@index([fecha])
  @@map("transacciones_recurso")
}

/// Categor铆as de items de la tienda
/// Organiza los items en secciones (Avatares, Skins, Power-ups, etc.)
model CategoriaItem {
  /// Identificador 煤nico
  id String @id @default(cuid())

  /// Nombre de la categor铆a
  /// Ejemplos: "Avatares", "Skins", "Power-ups", "Efectos"
  nombre String @unique

  /// Descripci贸n de la categor铆a
  descripcion String?

  /// Icono/emoji de la categor铆a
  icono String

  /// Orden de visualizaci贸n
  orden Int @default(0)

  /// Si est谩 activa y visible en tienda
  activa Boolean @default(true)

  /// Timestamp de creaci贸n
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n
  updatedAt DateTime @updatedAt

  /// Relaciones
  items ItemTienda[]

  @@map("categorias_item")
}

/// Items disponibles en la tienda
/// Define cada item comprable (avatares, skins, power-ups, cosm茅ticos)
model ItemTienda {
  /// Identificador 煤nico
  id String @id @default(cuid())

  /// Nombre del item
  nombre String

  /// Descripci贸n del item
  descripcion String?

  /// ID de la categor铆a
  categoria_id String

  /// Tipo de item (avatar, skin, powerup, cosmetico, etc.)
  tipo_item TipoItem

  /// Precio en monedas (0 si se compra solo con gemas)
  precio_monedas Int @default(0)

  /// Precio en gemas (0 si se compra solo con monedas)
  precio_gemas Int @default(0)

  /// URL de la imagen/preview del item
  imagen_url String?

  /// Rareza del item (com煤n, raro, 茅pico, legendario)
  rareza RarezaItem @default(COMUN)

  /// Si es un item de edici贸n limitada
  edicion_limitada Boolean @default(false)

  /// Fecha de inicio de disponibilidad (null = siempre disponible)
  fecha_inicio DateTime?

  /// Fecha de fin de disponibilidad (null = sin fecha l铆mite)
  fecha_fin DateTime?

  /// Nivel m铆nimo requerido para comprar
  nivel_minimo_requerido Int @default(1)

  /// Si est谩 disponible en la tienda
  disponible Boolean @default(true)

  /// Cantidad de veces que se ha comprado (para estad铆sticas)
  veces_comprado Int @default(0)

  /// Metadata adicional del item (JSON flexible)
  /// Puede contener: stats, efectos, duraci贸n, etc.
  metadata Json?

  /// Timestamp de creaci贸n
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n
  updatedAt DateTime @updatedAt

  /// Relaciones
  categoria CategoriaItem      @relation(fields: [categoria_id], references: [id])
  compras   CompraItem[]
  itemsObtenidos ItemObtenido[]

  @@index([categoria_id])
  @@index([tipo_item])
  @@index([rareza])
  @@index([disponible])
  @@map("items_tienda")
}

/// Items obtenidos por el estudiante (inventario)
/// Registra qu茅 items posee cada estudiante
model ItemObtenido {
  /// Identificador 煤nico
  id String @id @default(cuid())

  /// ID del estudiante
  estudiante_id String

  /// ID del item
  item_id String

  /// Fecha de obtenci贸n
  fecha_obtencion DateTime @default(now())

  /// Si el item est谩 equipado/activo actualmente
  equipado Boolean @default(false)

  /// Cantidad (para items consumibles/stackeables)
  cantidad Int @default(1)

  /// Metadata adicional (JSON flexible)
  /// Puede contener: usos_restantes, fecha_expiracion, etc.
  metadata Json?

  /// Timestamp de creaci贸n
  createdAt DateTime @default(now())

  /// Timestamp de 煤ltima actualizaci贸n
  updatedAt DateTime @updatedAt

  /// Relaciones
  estudiante Estudiante  @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  item       ItemTienda  @relation(fields: [item_id], references: [id])

  @@unique([estudiante_id, item_id])
  @@index([estudiante_id])
  @@index([item_id])
  @@index([equipado])
  @@map("items_obtenidos")
}

/// Compras realizadas en la tienda (historial transaccional)
/// Registra cada compra de item por estudiante
model CompraItem {
  /// Identificador 煤nico
  id String @id @default(cuid())

  /// ID del recurso del estudiante (para tracking de recursos)
  recursos_estudiante_id String

  /// ID del item comprado
  item_id String

  /// Precio pagado en monedas
  monedas_gastadas Int @default(0)

  /// Precio pagado en gemas
  gemas_gastadas Int @default(0)

  /// Fecha de la compra
  fecha_compra DateTime @default(now())

  /// Timestamp de creaci贸n
  createdAt DateTime @default(now())

  /// Relaciones
  recursosEstudiante RecursosEstudiante @relation(fields: [recursos_estudiante_id], references: [id], onDelete: Cascade)
  item               ItemTienda         @relation(fields: [item_id], references: [id])

  @@index([recursos_estudiante_id])
  @@index([item_id])
  @@index([fecha_compra])
  @@map("compras_item")
}

// ============================================================================
// ENUMS PARA TIENDA Y RECURSOS
// ============================================================================

/// Tipos de recursos del estudiante
enum TipoRecurso {
  XP
  MONEDAS
  GEMAS

  @@map("tipo_recurso")
}

/// Tipos de items de la tienda
enum TipoItem {
  AVATAR          // Avatar 3D completo
  SKIN            // Skin/outfit para avatar
  ACCESORIO       // Accesorios (sombreros, gafas, etc.)
  POWERUP         // Power-ups temporales (2x XP, etc.)
  COSMETICO       // Efectos cosm茅ticos (part铆culas, auras, etc.)
  TITULO          // T铆tulos/badges personalizados
  EMOJI           // Emojis/stickers personalizados
  FONDO           // Fondos de perfil
  MARCO           // Marcos de avatar

  @@map("tipo_item")
}

/// Rareza de items
enum RarezaItem {
  COMUN
  RARO
  EPICO
  LEGENDARIO

  @@map("rareza_item")
}
