generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// Modelo principal para tutores/docentes de la plataforma
/// Representa a los usuarios educadores que crean y gestionan contenido educativo
model Tutor {
  /// Identificador único del tutor (CUID para mejor distribución)
  id                        String                  @id @default(cuid())
  /// Username único del tutor - usado para autenticación alternativa
  username                  String?                 @unique
  /// Email único del tutor - usado para autenticación
  /// IMPORTANTE: Debe estar indexado para búsquedas rápidas en login
  email                     String?                 @unique
  /// Hash bcrypt de la contraseña - NUNCA se envía al frontend
  /// Se maneja solo en backend para seguridad
  password_hash             String
  /// Indica si el tutor debe completar su perfil (datos personales adicionales)
  debe_completar_perfil     Boolean                 @default(false)
  /// Fecha del último cambio de contraseña
  fecha_ultimo_cambio       DateTime?
  /// Nombre del tutor
  nombre                    String
  /// Apellido del tutor
  apellido                  String
  /// Documento Nacional de Identidad (opcional)
  dni                       String?
  /// CUIL/CUIT para facturación (REQUERIDO para inscripciones 2026)
  cuil                      String?
  /// Teléfono de contacto (opcional)
  telefono                  String?
  /// Fecha en que el tutor se registró en la plataforma
  fecha_registro            DateTime                @default(now())
  /// Indica si el tutor completó el proceso de onboarding inicial
  /// Se usa para redirigir a nuevos tutores al flujo de configuración
  ha_completado_onboarding  Boolean                 @default(false)
  /// Timestamp de creación del registro
  createdAt                 DateTime                @default(now())
  /// Timestamp de última actualización del registro
  updatedAt                 DateTime                @updatedAt
  /// Roles asignados al tutor (normalmente solo ["tutor"])
  /// Ejemplo: ["tutor"]
  roles                     Json                    @default("[\"tutor\"]")
  estudiantes               Estudiante[]
  inscripciones_clase       InscripcionClase[]
  inscripciones_clase_grupo InscripcionClaseGrupo[]
  membresias                Membresia[]
  inscripciones_mensuales   InscripcionMensual[]

  /// NUEVAS RELACIONES - GAMIFICACIÓN V2 (PUNTOS PADRES)
  puntos            PuntosPadre?
  solicitudes_canje SolicitudCanje[]
  canjes            CanjePadre[]

  /// COLONIA DE VERANO 2026
  inscripciones_colonia ColoniaInscripcion[]
  Inscripcion2026       Inscripcion2026[]

  @@map("tutores")
}

/// Modelo para estudiantes asociados a un tutor
/// Representa a los alumnos que utilizarán la plataforma
model Estudiante {
  /// Identificador único del estudiante
  id                        String                        @id @default(cuid())
  /// Username único del estudiante - usado para autenticación (OBLIGATORIO)
  username                  String                        @unique
  /// Nombre del estudiante
  nombre                    String
  /// Apellido del estudiante
  apellido                  String
  /// Nivel escolar del estudiante: Primaria, Secundaria, Universidad
  nivelEscolar              String                        @map("nivel_escolar")
  /// URL del avatar 3D de Ready Player Me
  /// Ejemplo: https://models.readyplayer.me/abc123.glb
  avatarUrl                 String?                       @map("avatar_url") @db.Text
  /// URL de la animación idle seleccionada por el estudiante
  /// Ejemplo: https://bx0qberriuipqy7z.public.blob.vercel-storage.com/animations/masculine/idle/M_Standing_Idle_001.glb
  animacion_idle_url        String?                       @db.Text
  /// DEPRECADO: URL de la foto de perfil del estudiante (mantener por compatibilidad)
  fotoUrl                   String?                       @map("foto_url")
  /// ID del tutor que gestiona este estudiante
  tutor_id                  String
  /// ID de la casa a la que pertenece el estudiante (sistema 2026)
  casaId                    String?                       @map("casa_id")
  /// Puntos totales acumulados por el estudiante (gamificación)
  puntos_totales            Int                           @default(0)
  /// Nivel actual del estudiante en el sistema de gamificación
  nivel_actual              Int                           @default(1)
  /// Timestamp de creación del registro
  createdAt                 DateTime                      @default(now())
  /// Timestamp de última actualización del registro
  updatedAt                 DateTime                      @updatedAt
  /// ID del gradiente del avatar (0-9)
  /// Corresponde a uno de los 10 gradientes predefinidos del sistema
  avatar_gradient           Int                           @default(0)
  /// Edad del estudiante en años
  edad                      Int
  /// Email único del estudiante - usado para autenticación propia
  /// IMPORTANTE: Debe estar indexado para búsquedas rápidas en login
  email                     String?                       @unique
  /// Hash bcrypt de la contraseña - NUNCA se envía al frontend
  /// Permite que el estudiante acceda al portal con sus propias credenciales
  password_hash             String?
  /// Fecha del último cambio de contraseña
  fecha_ultimo_cambio       DateTime?
  /// Roles asignados al estudiante (normalmente solo ["estudiante"])
  /// Ejemplo: ["estudiante"]
  roles                     Json                          @default("[\"estudiante\"]")
  /// DEPRECADO: ID del sector al que pertenece el estudiante (usar sectores[] en su lugar)
  /// Mantener temporalmente para migración gradual
  sector_id                 String?
  alertas                   Alerta[]
  asistencias               Asistencia[]
  casa                      Casa?                         @relation(fields: [casaId], references: [id])
  /// DEPRECADO: Relación uno-a-uno con sector (usar sectores[] en su lugar)
  sector                    Sector?                       @relation("EstudianteSectorLegacy", fields: [sector_id], references: [id])
  /// NUEVO: Relación muchos-a-muchos con sectores a través de EstudianteSector
  sectores                  EstudianteSector[]
  tutor                     Tutor                         @relation(fields: [tutor_id], references: [id], onDelete: Cascade)
  inscripciones_clase       InscripcionClase[]
  inscripciones_clase_grupo InscripcionClaseGrupo[]
  asistencias_clase_grupo   AsistenciaClaseGrupo[]
  inscripciones_curso       InscripcionCurso[]
  progresoLecciones         ProgresoLeccion[]
  puntosObtenidos           PuntoObtenido[]
  inscripciones_mensuales   InscripcionMensual[]
  becas                     Beca[]
  progresosActividades      ProgresoEstudianteActividad[]
  recursos                  RecursosEstudiante?
  itemsObtenidos            ItemObtenido[]

  /// NUEVAS RELACIONES - GAMIFICACIÓN V2
  logros_desbloqueados LogroEstudiante[]
  racha                RachaEstudiante?
  solicitudes_canje    SolicitudCanje[]
  cursos_canjeados     CursoEstudiante[]

  /// COLONIA DE VERANO 2026
  colonia_inscripciones     ColoniaEstudiante[]
  EstudianteInscripcion2026 EstudianteInscripcion2026[]

  /// ONBOARDING 2026
  niveles_por_mundo    EstudianteMundoNivel[]
  tests_ubicacion      TestUbicacionResultado[]

  // Índices de performance para rankings y listados
  @@index([puntos_totales(sort: Desc)], name: "idx_estudiantes_puntos_ranking")
  @@index([casaId, puntos_totales(sort: Desc)], name: "idx_estudiantes_casa_ranking")
  @@index([tutor_id, apellido], name: "idx_estudiantes_tutor_listado")
  @@map("estudiantes")
}

/// Tabla intermedia para relación muchos-a-muchos entre Estudiante y Sector
/// Un estudiante puede estar inscrito en múltiples sectores (ej: Matemática + Programación)
/// Un sector puede tener múltiples estudiantes
model EstudianteSector {
  /// ID único de la relación
  id            String    @id @default(cuid())
  /// ID del estudiante
  estudiante_id String
  /// ID del sector
  sector_id     String
  /// Indica si es el sector principal del estudiante (para compatibilidad con lógica legacy)
  es_principal  Boolean   @default(false)
  /// Fecha de inscripción en el sector
  fecha_inicio  DateTime  @default(now())
  /// Fecha de baja del sector (null si está activo)
  fecha_fin     DateTime?
  /// Timestamp de creación del registro
  createdAt     DateTime  @default(now())
  /// Timestamp de última actualización del registro
  updatedAt     DateTime  @updatedAt

  /// Relaciones
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  sector     Sector     @relation(fields: [sector_id], references: [id], onDelete: Cascade)

  /// Índice único para evitar duplicados (un estudiante no puede estar dos veces en el mismo sector activo)
  @@unique([estudiante_id, sector_id])
  @@index([estudiante_id])
  @@index([sector_id])
  @@map("estudiante_sectores")
}

/// Modelo para casas del sistema 2026
/// Las casas agrupan estudiantes por rango de edad con colores y gamificación propios
/// Reemplaza el modelo Equipo anterior
model Casa {
  /// Identificador único de la casa
  id     String   @id @default(cuid())
  /// Tipo de casa (QUANTUM, VERTEX, PULSAR) - único
  tipo   CasaTipo @unique
  /// Nombre de la casa para mostrar
  nombre String   @unique
  /// Emoji representativo de la casa
  emoji  String
  /// Slogan o lema de la casa
  slogan String?

  /// Edad mínima para pertenecer a esta casa
  edadMinima Int @map("edad_minima")
  /// Edad máxima para pertenecer a esta casa
  edadMaxima Int @map("edad_maxima")

  /// Color primario en formato hexadecimal (Design System 2026)
  colorPrimary   String @map("color_primary")
  /// Color secundario en formato hexadecimal
  colorSecondary String @map("color_secondary")
  /// Color de acento en formato hexadecimal
  colorAccent    String @map("color_accent")
  /// Color oscuro en formato hexadecimal
  colorDark      String @map("color_dark")
  /// Gradiente CSS para backgrounds
  gradiente      String

  /// Puntos totales acumulados por todos los estudiantes de la casa
  puntosTotales Int @default(0) @map("puntos_totales")

  /// Timestamp de creación del registro
  createdAt DateTime @default(now())
  /// Timestamp de última actualización del registro
  updatedAt DateTime @updatedAt

  /// Estudiantes que pertenecen a esta casa
  estudiantes Estudiante[]

  /// ONBOARDING 2026 - Tests de ubicación
  tests_casa_original TestUbicacionResultado[] @relation("TestCasaOriginal")
  tests_casa_asignada TestUbicacionResultado[] @relation("TestCasaAsignada")

  @@map("casas")
}

/// Modelo para Mundos STEAM (2026)
/// Representa las 3 áreas de conocimiento: Matemática, Programación, Ciencias
model Mundo {
  /// Identificador único del mundo
  id          String    @id @default(cuid())
  /// Tipo de mundo (MATEMATICA, PROGRAMACION, CIENCIAS) - único
  tipo        MundoTipo @unique
  /// Nombre del mundo para mostrar
  nombre      String    @unique
  /// Descripción del mundo
  descripcion String?
  /// Icono del mundo (emoji o nombre de icono)
  icono       String

  /// Color primario en formato hexadecimal
  colorPrimary   String @map("color_primary")
  /// Color secundario en formato hexadecimal
  colorSecondary String @map("color_secondary")
  /// Color de acento en formato hexadecimal
  colorAccent    String @map("color_accent")
  /// Gradiente CSS para backgrounds
  gradiente      String

  /// Indica si el mundo está activo
  activo Boolean @default(true)
  /// Orden de visualización
  orden  Int     @default(0)

  /// Timestamp de creación del registro
  createdAt DateTime @default(now())
  /// Timestamp de última actualización del registro
  updatedAt DateTime @updatedAt

  /// ONBOARDING 2026 - Relaciones
  estudiantes_nivel EstudianteMundoNivel[]
  tests_ubicacion   TestUbicacionResultado[]

  // Nota: Relación con planificaciones se agregará en SLICE 5

  // Índice de performance para filtros de mundos activos
  @@index([activo], name: "idx_mundos_activo")
  @@map("mundos")
}

/// Modelo para Tiers de suscripción - Sistema Mateatletas 2026
///
/// Sistema de 3 tiers:
/// - ARCADE: $30k - 1 mundo async, sin docente (entry-level)
/// - ARCADE_PLUS: $60k - 3 mundos async, sin docente (amplitud)
/// - PRO: $75k - 1 mundo async + 1 mundo sync con docente (profundidad)
///
/// Reglas de negocio:
/// - El tier es por estudiante, no por familia
/// - Los descuentos familiares (12%/20%) aplican al total
/// - PRO requiere que mundo async ≠ mundo sync
model Tier {
  /// Identificador único del tier
  id             String     @id @default(cuid())
  /// Nombre del tier (ARCADE, ARCADE_PLUS, PRO) - único
  nombre         TierNombre @unique
  /// Precio mensual en pesos
  precio_mensual Int
  /// Cantidad de mundos async incluidos
  mundos_async   Int
  /// Cantidad de mundos sync (con docente) incluidos
  mundos_sync    Int
  /// Indica si incluye acceso a docente
  tiene_docente  Boolean    @default(false)
  /// Descripción del tier para UI
  descripcion    String?
  /// Indica si el tier está activo para nuevas inscripciones
  activo         Boolean    @default(true)
  /// Orden de visualización (para pricing page)
  orden          Int        @default(0)

  /// Timestamp de creación del registro
  createdAt DateTime @default(now())
  /// Timestamp de última actualización del registro
  updatedAt DateTime @updatedAt

  /// Relación con estudiantes inscritos en este tier
  estudiantes_inscripcion EstudianteInscripcion2026[]

  /// Relaciones con cambios de tier
  cambios_como_actual CambioTierPendiente[] @relation("CambioTierActual")
  cambios_como_nuevo  CambioTierPendiente[] @relation("CambioTierNuevo")

  @@map("tiers")
}

/// Modelo para cambios de tier pendientes o históricos
/// Registra upgrades (aplicación diferida) y downgrades (aplicación inmediata)
model CambioTierPendiente {
  /// Identificador único del cambio
  id String @id @default(cuid())

  /// ID del estudiante-inscripción afectado
  estudiante_inscripcion_id String

  /// ID del tier actual al momento de solicitar el cambio
  tier_actual_id String

  /// ID del tier nuevo solicitado
  tier_nuevo_id String

  /// Tipo de cambio: upgrade o downgrade
  tipo_cambio String // "upgrade" | "downgrade"

  /// Fecha efectiva del cambio (1ro del próximo mes para upgrades)
  fecha_efectiva DateTime

  /// Estado del cambio: pendiente, aplicado, cancelado
  estado String @default("pendiente") // "pendiente" | "aplicado" | "cancelado"

  /// Si el cambio fue aplicado de forma inmediata
  aplicacion_inmediata Boolean @default(false)

  /// Fecha en que se aplicó el cambio (si estado = aplicado)
  aplicado_en DateTime?

  /// Fecha en que se canceló el cambio (si estado = cancelado)
  cancelado_en DateTime?

  /// Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Relaciones
  estudiante_inscripcion EstudianteInscripcion2026 @relation(fields: [estudiante_inscripcion_id], references: [id], onDelete: Cascade)
  tier_actual            Tier                      @relation("CambioTierActual", fields: [tier_actual_id], references: [id])
  tier_nuevo             Tier                      @relation("CambioTierNuevo", fields: [tier_nuevo_id], references: [id])

  @@index([estudiante_inscripcion_id])
  @@index([estado])
  @@index([fecha_efectiva])
  @@map("cambios_tier_pendientes")
}

/// Nivel del estudiante en cada mundo (2026)
/// Un estudiante puede tener diferentes niveles en cada mundo
/// Ej: "Intermedio en Matemática" y "Básico en Programación"
model EstudianteMundoNivel {
  /// Identificador único del registro
  id String @id @default(cuid())

  /// ID del estudiante
  estudiante_id String

  /// ID del mundo
  mundo_id String

  /// Nivel interno asignado en este mundo
  nivel_interno NivelInterno @default(BASICO)

  /// Fecha de asignación del nivel
  fecha_asignacion DateTime @default(now())

  /// Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Relaciones
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  mundo      Mundo      @relation(fields: [mundo_id], references: [id], onDelete: Cascade)

  /// Un estudiante solo puede tener un nivel por mundo
  @@unique([estudiante_id, mundo_id])
  @@index([estudiante_id])
  @@index([mundo_id])
  @@map("estudiante_mundo_niveles")
}

/// Resultado del test de ubicación (2026)
/// Registra el diagnóstico inicial del estudiante por mundo
/// Determina casa y nivel interno
model TestUbicacionResultado {
  /// Identificador único del resultado
  id String @id @default(cuid())

  /// ID del estudiante que hizo el test
  estudiante_id String

  /// ID del mundo para el cual se hizo el test
  mundo_id String

  /// Total de preguntas en el test
  preguntas_total Int

  /// Cantidad de respuestas correctas
  respuestas_correctas Int

  /// Puntaje final (0-100)
  puntaje Float

  /// Nivel interno asignado basado en el puntaje
  nivel_asignado NivelInterno

  /// ID de la casa original (por edad)
  casa_original_id String?

  /// ID de la casa final asignada (puede ser menor si bajó)
  casa_asignada_id String?

  /// Indica si el estudiante bajó de casa por el test
  bajo_de_casa Boolean @default(false)

  /// Fecha de completado del test
  fecha_completado DateTime @default(now())

  /// Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Relaciones
  estudiante    Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  mundo         Mundo      @relation(fields: [mundo_id], references: [id], onDelete: Cascade)
  casa_original Casa?      @relation("TestCasaOriginal", fields: [casa_original_id], references: [id])
  casa_asignada Casa?      @relation("TestCasaAsignada", fields: [casa_asignada_id], references: [id])

  @@index([estudiante_id])
  @@index([mundo_id])
  @@map("test_ubicacion_resultados")
}

/// Modelo para docentes (profesores) de la plataforma
/// Representa a los usuarios educadores que dictan clases
model Docente {
  /// Identificador único del docente
  id                          String              @id @default(cuid())
  /// Email único del docente - usado para autenticación
  email                       String              @unique
  /// Hash bcrypt de la contraseña
  password_hash               String
  /// Nombre del docente
  nombre                      String
  /// Apellido del docente
  apellido                    String
  /// Título profesional (ej: "Profesor de Matemática", "Licenciado en Física")
  titulo                      String?
  /// Biografía o descripción del docente
  bio                         String?
  /// Timestamp de creación del registro
  createdAt                   DateTime            @default(now())
  /// Timestamp de última actualización del registro
  updatedAt                   DateTime            @updatedAt
  /// Disponibilidad horaria del docente (ej: {"lunes": ["09:00-12:00", "14:00-18:00"], "martes": ["10:00-13:00"]})
  /// Se almacena como JSON object con días de la semana como keys
  disponibilidad_horaria      Json?
  /// Especialidades del docente (ej: ["Álgebra", "Geometría", "Trigonometría"])
  /// Se almacena como JSON array de strings
  especialidades              Json?
  /// Estado del docente (activo, inactivo, vacaciones)
  estado                      String              @default("activo")
  /// Años de experiencia docente
  experiencia_anos            Int?
  /// Nivel educativo que el docente puede impartir (ej: ["Primaria", "Secundaria", "Universidad"])
  /// Se almacena como JSON array de strings
  nivel_educativo             Json?
  /// Roles asignados al docente (puede ser docente y admin simultáneamente)
  /// Ejemplo: ["docente", "admin"]
  roles                       Json                @default("[\"docente\"]")
  /// Teléfono de contacto (opcional)
  telefono                    String?
  /// Fecha del último cambio de contraseña
  fecha_ultimo_cambio         DateTime?
  clases                      Clase[]
  claseGrupos                 ClaseGrupo[]
  rutasEspecialidad           DocenteRuta[]
  eventos                     Evento[]
  notificaciones              Notificacion[]
  puntosOtorgados             PuntoObtenido[]     @relation("PuntosOtorgados")
  asignacionesPlanificaciones AsignacionDocente[]

  @@map("docentes")
}

/// Modelo para administradores del sistema
/// Tienen acceso completo al dashboard administrativo
model Admin {
  /// Identificador único del admin (CUID)
  id                    String    @id @default(cuid())
  /// Email único del admin - usado para autenticación
  email                 String    @unique
  /// Hash bcrypt de la contraseña - NUNCA se envía al frontend
  password_hash         String
  /// Fecha del último cambio de contraseña
  fecha_ultimo_cambio   DateTime?
  /// Nombre del admin
  nombre                String
  /// Apellido del admin
  apellido              String
  /// Fecha en que el admin fue creado
  fecha_registro        DateTime  @default(now())
  /// Timestamp de creación del registro
  createdAt             DateTime  @default(now())
  /// Timestamp de última actualización del registro
  updatedAt             DateTime  @updatedAt
  /// DNI del admin (opcional)
  dni                   String?
  /// Roles asignados al admin (puede ser admin y docente simultáneamente)
  /// Ejemplo: ["admin", "docente"]
  roles                 Json      @default("[\"admin\"]")
  /// Teléfono del admin (opcional)
  telefono              String?
  /// Secret TOTP para MFA (Multi-Factor Authentication)
  /// Guardado encriptado en DB para seguridad
  mfa_secret            String?
  /// Indica si MFA está habilitado para este admin
  mfa_enabled           Boolean   @default(false)
  /// Códigos de backup para MFA (hasheados con bcrypt)
  /// Array de strings - cada código es de un solo uso
  mfa_backup_codes      String[]  @default([])

  @@map("admins")
}

/// Registro de intentos de login para seguridad y rate limiting
/// Almacena tanto intentos exitosos como fallidos para auditoría
model LoginAttempt {
  /// Identificador único del intento
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  /// Email usado en el intento de login
  email     String   @db.VarChar(255)
  /// Dirección IP desde donde se hizo el intento
  ip        String   @db.VarChar(45)
  /// Si el intento fue exitoso o no
  success   Boolean  @default(false)
  /// Timestamp del intento
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@index([email], name: "idx_login_attempts_email")
  @@index([createdAt], name: "idx_login_attempts_created_at")
  @@map("login_attempts")
}

/// Modelo para productos del catálogo
/// Representa los productos que se pueden comprar: suscripciones, cursos, recursos
model Producto {
  /// Identificador único del producto
  id                      String               @id @default(cuid())
  /// Nombre del producto (ej: "Suscripción Mensual", "Curso de Álgebra")
  nombre                  String
  /// Descripción detallada del producto
  descripcion             String?
  /// Precio del producto en pesos (formato decimal para precisión)
  precio                  Decimal              @db.Decimal(10, 2)
  /// Tipo de producto (Suscripcion, Curso, RecursoDigital)
  tipo                    TipoProducto
  /// Indica si el producto está activo y disponible para compra
  activo                  Boolean              @default(true)
  /// Fecha de inicio del curso (solo para tipo Curso)
  fecha_inicio            DateTime?
  /// Fecha de finalización del curso (solo para tipo Curso)
  fecha_fin               DateTime?
  /// Cupo máximo de estudiantes (solo para tipo Curso)
  cupo_maximo             Int?
  /// Duración en meses de la suscripción (1=mensual, 12=anual, etc.)
  duracion_meses          Int?                 @default(1)
  /// Timestamp de creación del registro
  createdAt               DateTime             @default(now())
  /// Timestamp de última actualización del registro
  updatedAt               DateTime             @updatedAt
  clases                  Clase[]
  inscripciones_curso     InscripcionCurso[]
  membresias              Membresia[]
  modulos                 Modulo[]
  inscripciones_mensuales InscripcionMensual[]

  @@map("productos")
}

/// Modelo para membresías de suscripción
/// Vincula un tutor con un producto de tipo Suscripcion
model Membresia {
  /// Identificador único de la membresía
  id                     String          @id @default(cuid())
  /// ID del tutor propietario de la membresía
  tutor_id               String
  /// ID del producto de suscripción
  producto_id            String
  /// Estado actual de la membresía
  estado                 EstadoMembresia @default(Pendiente)
  /// Fecha de inicio de la membresía (se llena cuando webhook confirma)
  fecha_inicio           DateTime?
  /// Fecha del próximo pago (se calcula cuando webhook confirma)
  fecha_proximo_pago     DateTime?
  /// ID de preferencia de MercadoPago (para tracking)
  preferencia_id         String?
  /// ID del pago confirmado de MercadoPago (para auditoría y soporte)
  mercadopago_payment_id String?
  /// Timestamp de creación del registro
  createdAt              DateTime        @default(now())
  /// Timestamp de última actualización del registro
  updatedAt              DateTime        @updatedAt
  producto               Producto        @relation(fields: [producto_id], references: [id])
  tutor                  Tutor           @relation(fields: [tutor_id], references: [id], onDelete: Cascade)

  @@index([tutor_id, estado])
  @@index([preferencia_id])
  @@map("membresias")
}

/// Modelo para inscripciones a cursos
/// Vincula un estudiante con un producto de tipo Curso
model InscripcionCurso {
  /// Identificador único de la inscripción
  id                String                 @id @default(cuid())
  /// ID del estudiante inscrito
  estudiante_id     String
  /// ID del producto curso
  producto_id       String
  /// Estado de la inscripción
  estado            EstadoInscripcionCurso @default(PreInscrito)
  /// Fecha de inscripción
  fecha_inscripcion DateTime               @default(now())
  /// ID de preferencia de MercadoPago (para tracking)
  preferencia_id    String?
  /// Timestamp de creación del registro
  createdAt         DateTime               @default(now())
  /// Timestamp de última actualización del registro
  updatedAt         DateTime               @updatedAt
  estudiante        Estudiante             @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  producto          Producto               @relation(fields: [producto_id], references: [id])

  @@unique([estudiante_id, producto_id])
  @@index([estudiante_id, estado])
  @@index([preferencia_id])
  @@map("inscripciones_curso")
}

/// Modelo para rutas curriculares (temas/categorías de clases)
/// Representa los temas o áreas de conocimiento de las clases
model RutaCurricular {
  /// Identificador único de la ruta
  id          String       @id @default(cuid())
  /// Nombre de la ruta (ej: "Lógica", "Álgebra", "Geometría")
  nombre      String       @unique
  /// Color hexadecimal para identificación visual (opcional)
  color       String?
  /// Descripción de la ruta curricular
  descripcion String?
  /// Timestamp de creación del registro
  createdAt   DateTime     @default(now())
  /// Timestamp de última actualización del registro
  updatedAt   DateTime     @updatedAt
  clases      Clase[]
  claseGrupos ClaseGrupo[]

  @@map("rutas_curriculares")
}

/// Modelo para clases programadas
/// Representa una clase en vivo programada por un admin
model Clase {
  /// Identificador único de la clase
  id                 String             @id @default(cuid())
  /// ID de la ruta curricular (tema de la clase) - OPCIONAL
  ruta_curricular_id String?
  /// ID del docente asignado a la clase
  docente_id         String
  /// Fecha y hora de inicio de la clase
  fecha_hora_inicio  DateTime
  /// Duración de la clase en minutos
  duracion_minutos   Int
  /// Estado de la clase (Programada, Cancelada)
  estado             EstadoClase        @default(Programada)
  /// Cupo máximo de estudiantes
  cupos_maximo       Int
  /// Cupos ocupados actualmente
  cupos_ocupados     Int                @default(0)
  /// ID del producto curso (opcional - si null es clase de suscripción general)
  /// Si tiene valor, solo estudiantes con InscripcionCurso activa pueden reservar
  producto_id        String?
  /// Timestamp de creación del registro
  createdAt          DateTime           @default(now())
  /// Timestamp de última actualización del registro
  updatedAt          DateTime           @updatedAt
  /// Descripción o grupo de la clase (ej: "Niños 6-7 años", "Grupo A", "Preparación olimpiadas")
  descripcion        String?
  /// Nombre o tema de la clase (ej: "Godot", "Scratch", "Preparación Olimpiadas")
  nombre             String
  /// ID del sector (Matemática o Programación) - OPCIONAL
  sector_id          String?
  alertas            Alerta[]
  asistencias        Asistencia[]
  docente            Docente            @relation(fields: [docente_id], references: [id])
  producto           Producto?          @relation(fields: [producto_id], references: [id])
  rutaCurricular     RutaCurricular?    @relation(fields: [ruta_curricular_id], references: [id])
  sector             Sector?            @relation(fields: [sector_id], references: [id])
  eventos            Evento[]
  inscripciones      InscripcionClase[]
  puntosObtenidos    PuntoObtenido[]

  @@index([docente_id])
  @@index([fecha_hora_inicio])
  @@index([estado])
  @@index([producto_id])
  @@map("clases")
}

/// Modelo para Grupos Pedagógicos
/// Representa los niveles educativos o categorías pedagógicas (B1, B2, B3, A1, etc.)
/// Los grupos son conceptos estables que agrupan contenido pedagógico del mismo nivel
model Grupo {
  /// Identificador único del grupo
  id String @id @default(cuid())

  /// Código del grupo (ej: "B1", "B2", "B3", "A1", "OLIMP")
  codigo String @unique

  /// Nombre descriptivo del grupo
  nombre String // "Básico 1", "Básico 2", "Avanzado 1"

  /// Descripción del grupo y nivel educativo
  descripcion String?

  /// Rango de edad sugerido
  edad_minima Int?
  edad_maxima Int?

  /// Sector al que pertenece (Matemática o Programación)
  sector_id String?

  /// Link de Google Meet para las clases de este grupo
  link_meet String?

  /// Indica si el grupo está activo
  activo Boolean @default(true)

  /// Timestamp de creación
  createdAt DateTime @default(now())

  /// Timestamp de última actualización
  updatedAt DateTime @updatedAt

  /// Relaciones
  sector Sector? @relation(fields: [sector_id], references: [id])

  /// Comisiones (instancias operativas) de este grupo
  comisiones ClaseGrupo[]

  /// Planificaciones mensuales dirigidas a este grupo
  planificaciones PlanificacionMensual[]

  @@index([codigo])
  @@index([activo])
  @@map("grupos")
}

/// Modelo para grupos de clases recurrentes (ahora llamado Comision conceptualmente)
/// Representa un grupo estable de estudiantes que se reúne semanalmente
/// Ejemplo: "GRUPO B1 - Matemática - Lunes 19:30"
model ClaseGrupo {
  /// Identificador único del grupo
  id String @id @default(cuid())

  /// Código del grupo pedagógico (puede repetirse, ej: "B2" para varios horarios)
  /// Se usa principalmente para identificación visual, no es unique
  codigo String

  /// Nombre descriptivo del grupo (este sí es único por instancia)
  nombre String @unique

  /// Tipo de clase grupo
  tipo TipoClaseGrupo @default(GRUPO_REGULAR)

  /// Día de la semana en que se reúne
  dia_semana DiaSemana

  /// Hora de inicio en formato HH:MM (ej: "19:30")
  hora_inicio String

  /// Hora de fin en formato HH:MM (ej: "21:00")
  hora_fin String

  /// Fecha de inicio de vigencia del grupo
  fecha_inicio DateTime

  /// Fecha de fin de vigencia del grupo
  /// Para GRUPO_REGULAR: siempre 15 de diciembre del año
  /// Para CURSO_TEMPORAL: fecha específica definida por admin
  fecha_fin DateTime

  /// Año lectivo al que pertenece (ej: 2025)
  anio_lectivo Int

  /// Cupo máximo de estudiantes
  cupo_maximo Int @default(15)

  /// ID del grupo pedagógico al que pertenece (B1, B2, B3, etc.)
  grupo_id String

  /// ID del docente asignado
  docente_id String

  /// ID de la ruta curricular (tema)
  ruta_curricular_id String?

  /// ID del sector (Matemática o Programación)
  sector_id String?

  /// Nivel o descripción (ej: "6 y 7 años", "Preparación olimpiadas")
  nivel String?

  /// Indica si el grupo está activo
  activo Boolean @default(true)

  /// Timestamp de creación
  createdAt DateTime @default(now())

  /// Timestamp de última actualización
  updatedAt DateTime @updatedAt

  /// Relaciones
  grupo          Grupo           @relation(fields: [grupo_id], references: [id])
  docente        Docente         @relation(fields: [docente_id], references: [id])
  rutaCurricular RutaCurricular? @relation(fields: [ruta_curricular_id], references: [id])
  sector         Sector?         @relation(fields: [sector_id], references: [id])

  /// Estudiantes inscritos en el grupo
  inscripciones InscripcionClaseGrupo[]

  /// Registros de asistencia del grupo
  asistencias AsistenciaClaseGrupo[]

  /// Asignaciones de planificaciones mensuales
  asignacionesPlanificaciones AsignacionDocente[]

  /// Asignaciones de actividades semanales
  asignacionesActividades AsignacionActividadEstudiante[]

  @@index([docente_id])
  @@index([dia_semana])
  @@index([fecha_inicio, fecha_fin])
  @@index([anio_lectivo])
  @@index([activo])
  @@map("clase_grupos")
}

/// Inscripción de un estudiante a un ClaseGrupo
/// Relación muchos-a-muchos entre Estudiante y ClaseGrupo
model InscripcionClaseGrupo {
  /// Identificador único
  id String @id @default(cuid())

  /// ID del grupo de clase
  clase_grupo_id String

  /// ID del estudiante inscrito
  estudiante_id String

  /// ID del tutor del estudiante
  tutor_id String

  /// Fecha de inscripción al grupo
  fecha_inscripcion DateTime @default(now())

  /// Fecha de baja del grupo (si se retira antes del fin)
  fecha_baja DateTime?

  /// Observaciones
  observaciones String?

  /// Timestamp de creación
  createdAt DateTime @default(now())

  /// Timestamp de última actualización
  updatedAt DateTime @updatedAt

  /// Relaciones
  claseGrupo ClaseGrupo @relation(fields: [clase_grupo_id], references: [id], onDelete: Cascade)
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  tutor      Tutor      @relation(fields: [tutor_id], references: [id])

  @@unique([clase_grupo_id, estudiante_id])
  @@index([estudiante_id])
  @@index([tutor_id])
  @@index([clase_grupo_id])
  @@map("inscripciones_clase_grupo")
}

/// Registro de asistencia a una sesión específica de un ClaseGrupo
/// Se crea cuando el docente marca asistencia un día específico
model AsistenciaClaseGrupo {
  /// Identificador único
  id String @id @default(cuid())

  /// ID del grupo de clase
  clase_grupo_id String

  /// ID del estudiante
  estudiante_id String

  /// Fecha específica de la clase (ej: "2025-10-21" para el lunes 21/10)
  fecha DateTime

  /// Estado de asistencia
  estado EstadoAsistencia

  /// Observaciones del docente sobre el estudiante en esta clase
  observaciones String?

  /// Calificación o feedback cualitativo (opcional)
  feedback String?

  /// Timestamp de creación
  createdAt DateTime @default(now())

  /// Timestamp de última actualización
  updatedAt DateTime @updatedAt

  /// Relaciones
  claseGrupo ClaseGrupo @relation(fields: [clase_grupo_id], references: [id], onDelete: Cascade)
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  @@unique([clase_grupo_id, estudiante_id, fecha])
  @@index([clase_grupo_id])
  @@index([estudiante_id])
  @@index([fecha])
  // Índice de performance para filtros por estado de asistencia
  @@index([estado], name: "idx_asistencias_estado")
  @@map("asistencias_clase_grupo")
}

/// Modelo para inscripciones a clases (reservas)
/// Vincula un estudiante con una clase específica
model InscripcionClase {
  /// Identificador único de la inscripción
  id                String     @id @default(cuid())
  /// ID de la clase
  clase_id          String
  /// ID del estudiante inscrito
  estudiante_id     String
  /// ID del tutor que realizó la reserva
  tutor_id          String
  /// Fecha de la inscripción
  fecha_inscripcion DateTime   @default(now())
  /// Observaciones o notas sobre la inscripción
  observaciones     String?
  /// Timestamp de creación del registro
  createdAt         DateTime   @default(now())
  /// Timestamp de última actualización del registro
  updatedAt         DateTime   @updatedAt
  clase             Clase      @relation(fields: [clase_id], references: [id], onDelete: Cascade)
  estudiante        Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  tutor             Tutor      @relation(fields: [tutor_id], references: [id])

  @@unique([clase_id, estudiante_id])
  @@index([estudiante_id])
  @@index([tutor_id])
  @@map("inscripciones_clase")
}

/// Modelo para registro de asistencia
/// Registra la asistencia y feedback del docente después de la clase
model Asistencia {
  /// Identificador único del registro de asistencia
  id               String           @id @default(cuid())
  /// ID de la clase
  clase_id         String
  /// ID del estudiante
  estudiante_id    String
  /// Estado de asistencia (Presente, Ausente, Justificado)
  estado           EstadoAsistencia
  /// Observaciones del docente sobre el estudiante en esta clase
  observaciones    String?
  /// Puntos otorgados al estudiante en esta clase (para gamificación)
  puntos_otorgados Int              @default(0)
  /// Fecha y hora del registro de asistencia
  fecha_registro   DateTime         @default(now())
  /// Timestamp de creación del registro
  createdAt        DateTime         @default(now())
  /// Timestamp de última actualización del registro
  updatedAt        DateTime         @updatedAt
  clase            Clase            @relation(fields: [clase_id], references: [id], onDelete: Cascade)
  estudiante       Estudiante       @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  @@unique([clase_id, estudiante_id])
  @@index([estudiante_id])
  @@index([estado])
  @@index([clase_id, estudiante_id, estado])
  @@map("asistencias")
}

/// Modelo para alertas administrativas generadas desde observaciones de docentes
/// Permite al admin detectar y resolver situaciones que requieren atención
model Alerta {
  /// Identificador único de la alerta
  id            String     @id @default(cuid())
  /// ID del estudiante relacionado con la alerta
  estudiante_id String
  /// ID de la clase donde se generó la alerta
  clase_id      String
  /// Descripción de la alerta (observaciones del docente)
  descripcion   String
  /// Fecha de creación de la alerta
  fecha         DateTime   @default(now())
  /// Indica si la alerta ha sido resuelta
  resuelta      Boolean    @default(false)
  /// Timestamp de creación del registro
  createdAt     DateTime   @default(now())
  /// Timestamp de última actualización del registro
  updatedAt     DateTime   @updatedAt
  clase         Clase      @relation(fields: [clase_id], references: [id], onDelete: Cascade)
  estudiante    Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  @@index([estudiante_id])
  @@index([resuelta])
  @@index([fecha])
  @@map("alertas")
}

/// Modelo para acciones puntuables (configuración de gamificación)
/// Define las acciones por las cuales un docente puede otorgar puntos
model AccionPuntuable {
  /// Identificador único de la acción
  id              String          @id @default(cuid())
  /// Nombre de la acción (ej: "Razonamiento destacado", "Participación activa")
  nombre          String          @unique
  /// Descripción de la acción
  descripcion     String
  /// Cantidad de puntos que otorga esta acción
  puntos          Int
  /// Indica si la acción está activa
  activo          Boolean         @default(true)
  /// Timestamp de creación del registro
  createdAt       DateTime        @default(now())
  /// Timestamp de última actualización del registro
  updatedAt       DateTime        @updatedAt
  puntosObtenidos PuntoObtenido[]

  @@map("acciones_puntuables")
}

/// Modelo para registro de puntos obtenidos (tabla transaccional)
/// Cada registro representa un evento donde un estudiante ganó puntos
model PuntoObtenido {
  /// Identificador único del registro
  id             String          @id @default(cuid())
  /// ID del estudiante que obtuvo los puntos
  estudiante_id  String
  /// ID del docente que otorgó los puntos
  docente_id     String
  /// ID de la acción puntuable
  accion_id      String
  /// ID de la clase donde se ganaron los puntos (opcional)
  clase_id       String?
  /// Cantidad de puntos otorgados (se guarda para preservar historial)
  puntos         Int
  /// Contexto o razón adicional (opcional)
  contexto       String?
  /// Fecha y hora en que se otorgaron los puntos
  fecha_otorgado DateTime        @default(now())
  /// Timestamp de creación del registro
  createdAt      DateTime        @default(now())
  /// Timestamp de última actualización del registro
  updatedAt      DateTime        @updatedAt
  accion         AccionPuntuable @relation(fields: [accion_id], references: [id])
  clase          Clase?          @relation(fields: [clase_id], references: [id])
  docente        Docente         @relation("PuntosOtorgados", fields: [docente_id], references: [id])
  estudiante     Estudiante      @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  @@index([estudiante_id])
  @@index([docente_id])
  @@index([accion_id])
  @@index([fecha_otorgado])
  @@map("puntos_obtenidos")
}

/// Módulo dentro de un curso
/// Agrupa lecciones relacionadas temáticamente
/// Ejemplo: "Módulo 1: Variables y Expresiones"
model Modulo {
  /// Identificador único del módulo
  id                        String    @id @default(cuid())
  /// ID del producto (curso) al que pertenece
  producto_id               String
  /// Título del módulo visible para estudiantes
  /// Ejemplo: "Fundamentos de Álgebra"
  titulo                    String
  /// Descripción breve del módulo (opcional)
  /// Ayuda al estudiante a entender qué aprenderá
  descripcion               String?
  /// Orden de presentación del módulo dentro del curso
  /// 1, 2, 3... Permite reordenamiento manual
  orden                     Int
  /// Duración estimada total del módulo en minutos
  /// Suma automática de duraciones de lecciones
  duracion_estimada_minutos Int       @default(0)
  /// Cantidad de puntos totales que otorga completar el módulo
  /// Suma de puntos_por_completar de todas las lecciones
  puntos_totales            Int       @default(0)
  /// Si está publicado y visible para estudiantes
  publicado                 Boolean   @default(false)
  /// Timestamp de creación del registro
  createdAt                 DateTime  @default(now())
  /// Timestamp de última actualización del registro
  updatedAt                 DateTime  @updatedAt
  lecciones                 Leccion[]
  producto                  Producto  @relation(fields: [producto_id], references: [id], onDelete: Cascade)

  @@index([producto_id, orden])
  @@index([producto_id])
  @@map("modulos")
}

/// Lección individual dentro de un módulo
/// Unidad mínima de aprendizaje (Microlearning)
/// Duración recomendada: 5-15 minutos
model Leccion {
  /// Identificador único de la lección
  id                        String            @id @default(cuid())
  /// ID del módulo al que pertenece
  modulo_id                 String
  /// Título de la lección visible para estudiantes
  /// Debe ser descriptivo y claro
  /// Ejemplo: "Cómo resolver ecuaciones lineales"
  titulo                    String
  /// Descripción opcional de la lección
  /// Resumen de lo que aprenderá el estudiante
  descripcion               String?
  /// Tipo de contenido de esta lección
  tipo_contenido            TipoContenido
  /// Contenido de la lección (formato según tipo)
  /// - Video: URL del video
  /// - Texto: Markdown con el contenido
  /// - Quiz: JSON con preguntas y opciones
  /// - Tarea: JSON con instrucciones y rubrica
  contenido                 String
  /// Orden de presentación dentro del módulo
  /// 1, 2, 3... Permite reordenamiento manual
  orden                     Int
  /// Puntos otorgados al completar esta lección
  /// Incentiva al estudiante a terminar
  /// Rango recomendado: 5-20 puntos por lección
  puntos_por_completar      Int               @default(10)
  /// Duración estimada en minutos
  /// Ayuda al estudiante a planificar su tiempo
  /// Rango recomendado: 5-15 minutos (Microlearning)
  duracion_estimada_minutos Int?
  /// Si la lección está publicada y visible
  activo                    Boolean           @default(true)
  /// Recursos adicionales (opcional)
  /// JSON con links, PDFs, etc.
  /// Ejemplo: {"links": ["https://...", "https://..."], "pdfs": ["url1"]}
  recursos_adicionales      String?
  /// Prerequisito (opcional)
  /// ID de lección que debe completarse antes
  /// Implementa Progressive Disclosure
  leccion_prerequisito_id   String?
  /// Timestamp de creación del registro
  createdAt                 DateTime          @default(now())
  /// Timestamp de última actualización del registro
  updatedAt                 DateTime          @updatedAt
  leccionPrerequisito       Leccion?          @relation("LeccionPrerequisito", fields: [leccion_prerequisito_id], references: [id])
  leccionesDependientes     Leccion[]         @relation("LeccionPrerequisito")
  modulo                    Modulo            @relation(fields: [modulo_id], references: [id], onDelete: Cascade)
  progresos                 ProgresoLeccion[]

  @@index([modulo_id, orden])
  @@index([modulo_id])
  @@index([tipo_contenido])
  @@map("lecciones")
}

/// Progreso de un estudiante en una lección específica
/// Tracking granular del aprendizaje (Learning Analytics)
model ProgresoLeccion {
  /// Identificador único del progreso
  id                       String     @id @default(cuid())
  /// ID del estudiante
  estudiante_id            String
  /// ID de la lección
  leccion_id               String
  /// Si la lección fue completada
  /// true = estudiante terminó y marcó como completada
  completada               Boolean    @default(false)
  /// Porcentaje de progreso (0-100)
  /// Útil para lecciones largas o videos
  /// 0 = no iniciado, 50 = a la mitad, 100 = completado
  progreso                 Int        @default(0)
  /// Fecha y hora en que inició la lección
  fecha_inicio             DateTime   @default(now())
  /// Fecha y hora en que completó la lección (si aplica)
  fecha_completada         DateTime?
  /// Tiempo total invertido en minutos (opcional)
  /// Útil para analytics y métricas de engagement
  tiempo_invertido_minutos Int?
  /// Calificación obtenida (para quizzes)
  /// Rango: 0-100 (porcentaje)
  calificacion             Int?
  /// Número de intentos (para quizzes/tareas)
  intentos                 Int        @default(0)
  /// Notas del estudiante (opcional)
  /// Permite al estudiante tomar apuntes privados
  notas_estudiante         String?
  /// Última respuesta del estudiante (para quizzes/tareas)
  /// JSON con las respuestas dadas
  ultima_respuesta         String?
  /// Timestamp de creación del registro
  createdAt                DateTime   @default(now())
  /// Timestamp de última actualización del registro
  updatedAt                DateTime   @updatedAt
  estudiante               Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  leccion                  Leccion    @relation(fields: [leccion_id], references: [id], onDelete: Cascade)

  @@unique([estudiante_id, leccion_id])
  @@index([estudiante_id])
  @@index([leccion_id])
  @@index([estudiante_id, completada])
  @@map("progreso_lecciones")
}

/// Sistema de notificaciones para docentes
/// Permite notificar eventos importantes como clases próximas, alertas de estudiantes, etc.
model Notificacion {
  /// Identificador único de la notificación
  id         String           @id @default(cuid())
  /// Tipo de notificación
  tipo       TipoNotificacion
  /// Título de la notificación
  titulo     String
  /// Mensaje descriptivo de la notificación
  mensaje    String
  /// Indica si la notificación ha sido leída
  leida      Boolean          @default(false)
  /// ID del docente al que pertenece la notificación
  docente_id String
  /// Metadata adicional en formato JSON (clase_id, estudiante_id, etc)
  metadata   Json?
  /// Timestamp de creación de la notificación
  createdAt  DateTime         @default(now())
  docente    Docente          @relation(fields: [docente_id], references: [id], onDelete: Cascade)

  @@index([docente_id, leida])
  @@index([docente_id, createdAt])
  @@map("notificaciones")
}

/// Eventos del calendario del docente
/// Modelo base polimórfico: puede ser Clase, Tarea, Recordatorio o Nota
model Evento {
  /// Identificador único del evento
  id             String        @id @default(cuid())
  /// Título del evento
  titulo         String
  /// Descripción detallada del evento
  descripcion    String?
  /// Tipo de evento (CLASE, TAREA, RECORDATORIO, NOTA)
  tipo           TipoEvento
  /// Fecha y hora de inicio del evento
  fecha_inicio   DateTime
  /// Fecha y hora de fin del evento
  fecha_fin      DateTime
  /// Indica si el evento dura todo el día
  es_todo_el_dia Boolean       @default(false)
  /// ID del docente al que pertenece el evento
  docente_id     String
  /// ID de la clase relacionada (para reprogramación/recuperación)
  clase_id       String?
  /// Timestamp de creación del evento
  createdAt      DateTime      @default(now())
  /// Timestamp de última actualización del evento
  updatedAt      DateTime      @updatedAt
  clase          Clase?        @relation(fields: [clase_id], references: [id])
  docente        Docente       @relation(fields: [docente_id], references: [id], onDelete: Cascade)
  nota           Nota?
  recordatorio   Recordatorio?
  tarea          Tarea?

  @@index([docente_id, fecha_inicio])
  @@index([tipo])
  @@index([docente_id, tipo])
  @@index([clase_id])
  @@map("eventos")
}

/// Tarea administrativa/pedagógica del docente
/// Extensión del modelo Evento para tareas con funcionalidad completa
model Tarea {
  /// Identificador único de la tarea
  id                        String         @id @default(cuid())
  /// ID del evento base asociado
  evento_id                 String         @unique
  /// Estado actual de la tarea
  estado                    EstadoTarea    @default(PENDIENTE)
  /// Nivel de prioridad de la tarea
  prioridad                 PrioridadTarea @default(MEDIA)
  /// Porcentaje de completitud (0-100)
  porcentaje_completado     Int            @default(0)
  /// Categoría personalizada de la tarea (ej: "Planificación", "Evaluación")
  categoria                 String?
  /// Etiquetas para organización (array de strings)
  etiquetas                 String[]
  /// Subtareas en formato JSON
  /// Estructura: [{id: string, titulo: string, completada: boolean, orden: number}]
  subtareas                 Json           @default("[]")
  /// Archivos adjuntos en formato JSON
  /// Estructura: [{id: string, nombre: string, url: string, tipo: string, tamaño: number}]
  archivos                  Json           @default("[]")
  /// ID de clase relacionada (opcional)
  clase_relacionada_id      String?
  /// ID de estudiante relacionado (opcional)
  estudiante_relacionado_id String?
  /// Tiempo estimado para completar en minutos
  tiempo_estimado_minutos   Int?
  /// Tiempo real invertido en minutos
  tiempo_real_minutos       Int?
  /// Configuración de recurrencia en formato JSON
  /// Estructura: {tipo: 'DIARIA'|'SEMANAL'|'MENSUAL', intervalo: number, dias_semana: number[], fecha_fin: string, excepciones: string[]}
  recurrencia               Json?
  /// Recordatorios configurados en formato JSON
  /// Estructura: [{minutos_antes: number, enviado: boolean}]
  recordatorios             Json           @default("[]")
  /// Fecha de completitud
  completedAt               DateTime?
  evento                    Evento         @relation(fields: [evento_id], references: [id], onDelete: Cascade)

  @@index([estado])
  @@index([prioridad])
  @@index([categoria])
  @@map("tareas")
}

/// Recordatorio simple para el docente
/// Extensión del modelo Evento para recordatorios básicos
model Recordatorio {
  /// Identificador único del recordatorio
  id         String  @id @default(cuid())
  /// ID del evento base asociado
  evento_id  String  @unique
  /// Indica si el recordatorio fue completado/marcado
  completado Boolean @default(false)
  /// Color personalizado del recordatorio (formato hex)
  color      String  @default("#6366f1")
  evento     Evento  @relation(fields: [evento_id], references: [id], onDelete: Cascade)

  @@map("recordatorios")
}

/// Nota de texto largo para el docente
/// Extensión del modelo Evento para notas/apuntes
model Nota {
  /// Identificador único de la nota
  id        String  @id @default(cuid())
  /// ID del evento base asociado
  evento_id String  @unique
  /// Contenido de la nota (texto largo)
  contenido String
  /// Categoría de la nota (opcional)
  categoria String?
  /// Color personalizado de la nota (formato hex)
  color     String  @default("#8b5cf6")
  evento    Evento  @relation(fields: [evento_id], references: [id], onDelete: Cascade)

  @@index([categoria])
  @@map("notas")
}

/// Configuración de niveles del sistema de gamificación
/// Define los nombres creativos y requisitos para cada nivel
model NivelConfig {
  /// Número del nivel (1, 2, 3, etc.)
  nivel          Int      @id
  /// Nombre creativo del nivel
  /// Ejemplos: "Explorador Numérico", "Maestro del Cálculo", "Genio Matemático"
  nombre         String
  /// Descripción del nivel
  descripcion    String
  /// Puntos mínimos requeridos para alcanzar este nivel
  puntos_minimos Int
  /// Puntos máximos antes de pasar al siguiente nivel
  puntos_maximos Int
  /// Color hex asociado al nivel para UI
  color          String   @default("#6366F1")
  /// Icono o emoji asociado al nivel
  icono          String   @default("🌟")
  /// Timestamp de creación del registro
  createdAt      DateTime @default(now())
  /// Timestamp de última actualización del registro
  updatedAt      DateTime @updatedAt

  @@map("niveles_config")
}

/// Modelo para sectores de trabajo (Matemática, Programación, etc.)
/// Permite organizar las especialidades en categorías principales
model Sector {
  /// Identificador único del sector
  id                 String             @id @default(cuid())
  /// Nombre del sector (ej: "Matemática", "Programación")
  nombre             String             @unique
  /// Descripción del sector
  descripcion        String?
  /// Color hex para UI (ej: "#FF5733")
  color              String             @default("#6366F1")
  /// Icono o emoji para UI (ej: "📐", "💻")
  icono              String             @default("📚")
  /// Indica si el sector está activo
  activo             Boolean            @default(true)
  /// Timestamp de creación del registro
  createdAt          DateTime           @default(now())
  /// Timestamp de última actualización del registro
  updatedAt          DateTime           @updatedAt
  clases             Clase[]
  claseGrupos        ClaseGrupo[]
  grupos             Grupo[]
  docentes           DocenteRuta[]
  /// DEPRECADO: Relación uno-a-muchos con estudiantes (usar estudianteSectores[] en su lugar)
  estudiantes        Estudiante[]       @relation("EstudianteSectorLegacy")
  /// NUEVO: Relación muchos-a-muchos con estudiantes a través de EstudianteSector
  estudianteSectores EstudianteSector[]
  rutas              RutaEspecialidad[]

  @@map("sectores")
}

/// Modelo para rutas de especialidad personalizadas dentro de cada sector
/// Ejemplos: "Roblox", "Scratch" (Programación), "Base-Progresivo", "Lógico-Desafiante" (Matemática)
model RutaEspecialidad {
  /// Identificador único de la ruta
  id          String        @id @default(cuid())
  /// Nombre de la ruta (ej: "Roblox", "Base-Progresivo")
  nombre      String
  /// Descripción de la ruta
  descripcion String?
  /// ID del sector al que pertenece
  sectorId    String
  /// Indica si la ruta está activa
  activo      Boolean       @default(true)
  /// Timestamp de creación del registro
  createdAt   DateTime      @default(now())
  /// Timestamp de última actualización del registro
  updatedAt   DateTime      @updatedAt
  docentes    DocenteRuta[]
  sector      Sector        @relation(fields: [sectorId], references: [id], onDelete: Cascade)

  @@unique([sectorId, nombre])
  @@index([sectorId])
  @@map("rutas_especialidad")
}

/// Modelo de relación muchos-a-muchos entre Docentes y Rutas de Especialidad
/// Un docente puede trabajar en múltiples rutas y sectores
model DocenteRuta {
  /// Identificador único de la relación
  id         String           @id @default(cuid())
  /// ID del docente
  docenteId  String
  /// ID de la ruta de especialidad
  rutaId     String
  /// ID del sector (desnormalizado para queries más rápidas)
  sectorId   String
  /// Fecha de asignación
  asignadoEn DateTime         @default(now())
  docente    Docente          @relation(fields: [docenteId], references: [id], onDelete: Cascade)
  ruta       RutaEspecialidad @relation(fields: [rutaId], references: [id], onDelete: Cascade)
  sector     Sector           @relation(fields: [sectorId], references: [id], onDelete: Cascade)

  @@unique([docenteId, rutaId])
  @@index([docenteId])
  @@index([rutaId])
  @@index([sectorId])
  @@map("docentes_rutas")
}

/// Enum para tipos de productos disponibles
enum TipoProducto {
  Suscripcion
  Curso
  RecursoDigital
}

/// Enum para tipos de casa (sistema 2026)
/// Las casas agrupan estudiantes por rango de edad
enum CasaTipo {
  QUANTUM // 6-9 años - Exploradores
  VERTEX // 10-12 años - Constructores
  PULSAR // 13-17 años - Dominadores

  @@map("casa_tipo")
}

/// Enum para tipos de mundo STEAM (2026)
/// Los mundos representan las 3 áreas de conocimiento principales
enum MundoTipo {
  MATEMATICA // Mundo de matemáticas - naranja
  PROGRAMACION // Mundo de programación - verde
  CIENCIAS // Mundo de ciencias - azul

  @@map("mundo_tipo")
}

/// Enum para niveles internos por mundo (2026)
/// Define la progresión dentro de cada mundo según la casa
enum NivelInterno {
  BASICO // Nivel inicial
  INTERMEDIO // Nivel medio
  AVANZADO // Nivel avanzado
  OLIMPICO // Nivel olímpico (solo Vertex y Pulsar en Mat/Prog)

  @@map("nivel_interno")
}

/// Enum para estado del onboarding del estudiante (2026)
/// Flujo: PENDIENTE -> SELECCION_MUNDOS -> TEST_UBICACION -> CONFIRMACION_CASA -> CREACION_AVATAR -> COMPLETADO
enum OnboardingEstado {
  PENDIENTE // Recién inscrito, no ha empezado
  SELECCION_MUNDOS // Eligiendo mundos según tier
  TEST_UBICACION // Haciendo test diagnóstico
  CONFIRMACION_CASA // Viendo casa asignada
  CREACION_AVATAR // Personalizando avatar 2D
  COMPLETADO // Listo para usar la plataforma

  @@map("onboarding_estado")
}

/// Enum para tipos de tier de suscripción (2026)
/// Define los niveles de acceso a mundos y docentes
enum TierNombre {
  ARCADE // $30k - 1 mundo async, sin docente
  ARCADE_PLUS // $60k - 3 mundos async, sin docente
  PRO // $75k - 1 mundo async + 1 mundo sync con docente

  @@map("tier_nombre")
}

/// Enum para estados de membresía
enum EstadoMembresia {
  Pendiente
  Activa
  Atrasada
  Cancelada
}

/// Enum para estados de inscripción a cursos
enum EstadoInscripcionCurso {
  PreInscrito
  Activo
  Finalizado
}

/// Enum para estados de clase
enum EstadoClase {
  Programada
  Cancelada
}

/// Enum para estados de asistencia
enum EstadoAsistencia {
  Presente
  Ausente
  Justificado
}

/// Tipos de contenido educativo soportados
/// Cada tipo requiere renderizado diferente en frontend
enum TipoContenido {
  Video
  Texto
  Quiz
  Tarea
  JuegoInteractivo
  Lectura
  Practica
}

/// Tipos de notificaciones disponibles
enum TipoNotificacion {
  ClaseProxima
  AsistenciaPendiente
  EstudianteAlerta
  ClaseCancelada
  LogroEstudiante
  Recordatorio
  General

  @@map("tipo_notificacion")
}

/// Tipos de eventos disponibles en el calendario
enum TipoEvento {
  CLASE
  TAREA
  RECORDATORIO
  NOTA

  @@map("tipo_evento")
}

/// Estados de una tarea
enum EstadoTarea {
  PENDIENTE
  EN_PROGRESO
  COMPLETADA
  CANCELADA

  @@map("estado_tarea")
}

/// Niveles de prioridad para tareas
enum PrioridadTarea {
  BAJA
  MEDIA
  ALTA
  URGENTE

  @@map("prioridad_tarea")
}

// ============================================================================
// SISTEMA DE PAGOS Y CONTABILIDAD
// ============================================================================

/// Configuración global de precios (Tabla singleton)
/// Solo existe UN registro con id="singleton"
/// Sistema de Tiers 2026: Arcade, Arcade+, Pro
model ConfiguracionPrecios {
  /// ID fijo "singleton" para garantizar un solo registro
  id String @id @default("singleton")

  /// Precios por Tier (Sistema 2026)
  precio_arcade      Decimal @default(30000) @db.Decimal(10, 2)
  precio_arcade_plus Decimal @default(60000) @db.Decimal(10, 2)
  precio_pro         Decimal @default(75000) @db.Decimal(10, 2)

  /// Descuentos familiares
  descuento_hermano_2    Decimal @default(12) @db.Decimal(5, 2) // 12% segundo hermano
  descuento_hermano_3_mas Decimal @default(20) @db.Decimal(5, 2) // 20% tercer hermano en adelante

  /// Configuración de notificaciones
  dia_vencimiento         Int     @default(15)
  dias_antes_recordatorio Int     @default(5)
  notificaciones_activas  Boolean @default(true)

  /// Metadata
  actualizado_por_admin_id String?
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt

  /// Relaciones
  historial HistorialCambioPrecios[]

  @@map("configuracion_precios")
}

/// Historial de cambios en la configuración de precios
/// Auditoría completa de modificaciones
model HistorialCambioPrecios {
  /// Identificador único del cambio
  id String @id @default(cuid())

  /// Referencia a la configuración
  configuracion_id String

  /// Valores antes y después del cambio (JSON flexible)
  valores_anteriores Json
  valores_nuevos     Json

  /// Metadata del cambio
  motivo_cambio String?
  admin_id      String
  fecha_cambio  DateTime @default(now())

  /// Relaciones
  configuracion ConfiguracionPrecios @relation(fields: [configuracion_id], references: [id])

  @@index([configuracion_id])
  @@index([fecha_cambio])
  @@map("historial_cambio_precios")
}

/// Inscripción mensual de un estudiante a un producto
/// Reemplaza el concepto de "reserva" por facturación mensual
model InscripcionMensual {
  /// Identificador único
  id String @id @default(cuid())

  /// Relaciones principales
  estudiante_id String
  producto_id   String
  tutor_id      String

  /// Período de facturación
  anio    Int
  mes     Int // 1-12
  periodo String // "2025-01" para facilitar queries

  /// Cálculo de precios (guardado para historial)
  precio_base        Decimal @db.Decimal(10, 2)
  descuento_aplicado Decimal @default(0) @db.Decimal(10, 2)
  precio_final       Decimal @db.Decimal(10, 2)

  /// Metadata del cálculo
  tipo_descuento  TipoDescuento
  detalle_calculo String // Explicación del cálculo aplicado

  /// Estado de pago
  estado_pago       EstadoPago @default(Pendiente)
  fecha_vencimiento DateTime? // Fecha límite de pago
  fecha_pago        DateTime?
  metodo_pago       String? // "Efectivo", "Transferencia", "MercadoPago"
  comprobante_url   String? // URL del comprobante subido
  observaciones     String?

  /// Auditoría
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Relaciones
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  producto   Producto   @relation(fields: [producto_id], references: [id])
  tutor      Tutor      @relation(fields: [tutor_id], references: [id])

  @@unique([estudiante_id, producto_id, periodo])
  @@index([tutor_id, periodo])
  @@index([estado_pago])
  @@index([periodo])
  @@map("inscripciones_mensuales")
}

/// Gestión de becas y descuentos especiales
model Beca {
  /// Identificador único
  id String @id @default(cuid())

  /// Estudiante beneficiado
  estudiante_id String

  /// Tipo y configuración de la beca
  tipo_beca        String // "Mérito Académico", "Social", "Deportiva", etc
  descuento_tipo   DescuentoBecaTipo
  descuento_valor  Decimal           @db.Decimal(10, 2) // Porcentaje o monto fijo
  productos_aplica Json // Array de IDs de productos donde aplica

  /// Vigencia
  fecha_inicio DateTime
  fecha_fin    DateTime
  activa       Boolean  @default(true)

  /// Metadata
  motivo_beca           String?
  aprobada_por_admin_id String?
  observaciones         String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  /// Relaciones
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  @@index([estudiante_id])
  @@index([activa])
  @@map("becas")
}

// ============================================================================
// ENUMS DEL SISTEMA DE PAGOS
// ============================================================================

/// Tipos de descuento aplicables
enum TipoDescuento {
  NINGUNO
  HERMANO_2        // 12% descuento segundo hermano
  HERMANO_3_MAS    // 20% descuento tercer hermano en adelante
  BECA

  @@map("tipo_descuento")
}

/// Estados del pago
enum EstadoPago {
  Pendiente
  Pagado
  Vencido
  Parcial
  Becado

  @@map("estado_pago")
}

/// Tipo de descuento en becas
enum DescuentoBecaTipo {
  PORCENTAJE
  MONTO_FIJO

  @@map("descuento_beca_tipo")
}

/// Tipo de clase grupo
enum TipoClaseGrupo {
  GRUPO_REGULAR // Clase permanente del año lectivo (finaliza 15/dic)
  CURSO_TEMPORAL // Curso con fecha de fin específica

  @@map("tipo_clase_grupo")
}

/// Día de la semana para clases recurrentes
enum DiaSemana {
  LUNES
  MARTES
  MIERCOLES
  JUEVES
  VIERNES
  SABADO
  DOMINGO

  @@map("dia_semana")
}

// ============================================================================
// SISTEMA DE PLANIFICACIONES MENSUALES
// ============================================================================

/// Catálogo de planificaciones mensuales creadas por Admin
/// Una planificación = 1 mes completo para un código de grupo (B1, B2, B3)
model PlanificacionMensual {
  /// Identificador único
  id String @id @default(cuid())

  // ===== TARGETING: A QUÉ GRUPO VA DIRIGIDA =====
  /// ID del grupo pedagógico al que aplica (B1, B2, B3, A1, etc.)
  grupo_id String

  /// Mes (1-12)
  mes Int

  /// Año (2025, 2026, etc.)
  anio Int

  // ===== CONTENIDO =====
  /// Título de la planificación
  titulo String // "Multiplicaciones - Marzo 2025"

  /// Descripción general del mes
  descripcion String

  /// Temática principal del mes
  tematica_principal String // "Multiplicaciones", "Fracciones", "Geometría"

  /// Objetivos de aprendizaje del mes
  objetivos_aprendizaje String[]

  // ===== METADATA =====
  /// Estado de la planificación
  estado EstadoPlanificacion @default(BORRADOR)

  /// Fecha en que se publicó (visible para docentes)
  fecha_publicacion DateTime?

  /// Notas para docentes (instrucciones generales)
  notas_docentes String?

  // ===== RELACIONES =====
  /// Grupo pedagógico al que pertenece
  grupo Grupo @relation(fields: [grupo_id], references: [id])

  /// Actividades semanales de esta planificación
  actividades ActividadSemanal[]

  /// Asignaciones que hicieron los docentes
  asignaciones AsignacionDocente[]

  // ===== AUDITORÍA =====
  created_by_admin_id String
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt

  /// Solo UNA planificación por grupo por mes
  @@unique([grupo_id, mes, anio])
  @@index([grupo_id, mes, anio])
  @@index([estado])
  @@map("planificaciones_mensuales")
}

/// Estados posibles de una planificación
enum EstadoPlanificacion {
  BORRADOR // Admin está armándola, no visible para docentes
  PUBLICADA // Visible para docentes, pueden asignar
  ARCHIVADA // Mes pasado, solo lectura

  @@map("estado_planificacion")
}

/// Nivel de dificultad de una actividad
enum NivelDificultad {
  BASICO
  INTERMEDIO
  AVANZADO
  OLIMPICO

  @@map("nivel_dificultad")
}

/// Actividad semanal dentro de una planificación mensual
/// Cada semana tiene UNA actividad principal (juego/ejercicio)
model ActividadSemanal {
  /// Identificador único
  id String @id @default(cuid())

  /// Planificación a la que pertenece
  planificacion_id String

  // ===== UBICACIÓN TEMPORAL =====
  /// Número de semana dentro del mes (1, 2, 3, 4)
  semana_numero Int

  /// Título de la semana
  titulo String // "Semana 1: Tablas del 1 al 3"

  /// Descripción de la actividad
  descripcion String

  // ===== COMPONENTE REACT =====
  /// Nombre del componente React que se va a renderizar
  componente_nombre String // "JuegoTablasMultiplicar"

  /// Props que recibe el componente (JSON flexible)
  componente_props Json // { "tablas": [1,2,3], "nivel": "basico" }

  // ===== CONFIGURACIÓN PEDAGÓGICA =====
  /// Nivel de dificultad
  nivel_dificultad NivelDificultad

  /// Tiempo estimado en minutos
  tiempo_estimado_minutos Int

  /// Puntos de gamificación que se pueden obtener
  puntos_gamificacion Int

  // ===== INSTRUCCIONES =====
  /// Instrucciones para el docente
  instrucciones_docente String

  /// Instrucciones para el estudiante
  instrucciones_estudiante String

  // ===== RECURSOS ADICIONALES =====
  /// URLs de recursos (PDFs, videos, links)
  recursos_url Json? // [{ "tipo": "pdf", "titulo": "Guía", "url": "..." }]

  /// Orden dentro de la planificación (para futuras expansiones)
  orden Int @default(1)

  // ===== RELACIONES =====
  planificacion PlanificacionMensual @relation(fields: [planificacion_id], references: [id], onDelete: Cascade)

  /// Asignaciones de esta actividad específica
  asignacionesActividad AsignacionActividadEstudiante[]

  /// Progreso de estudiantes en esta actividad
  progresosEstudiantes ProgresoEstudianteActividad[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@index([planificacion_id, semana_numero])
  @@map("actividades_semanales")
}

/// Asignación de una planificación completa por un docente a su grupo
/// El docente "activa" la planificación del mes para su grupo
model AsignacionDocente {
  /// Identificador único
  id String @id @default(cuid())

  /// Planificación que se asigna
  planificacion_id String

  /// Grupo al que se asigna
  clase_grupo_id String

  /// Docente que hace la asignación
  docente_id String

  // ===== CONTROL DEL DOCENTE =====
  /// Si está activa o pausada
  activo Boolean @default(true)

  /// Fecha en que el docente activó esta planificación
  fecha_asignacion DateTime @default(now())

  /// Mensaje personalizado del docente (opcional)
  mensaje_docente String?

  /// Fecha de inicio custom (por si el docente quiere empezar antes/después)
  fecha_inicio_custom DateTime?

  // ===== RELACIONES =====
  planificacion PlanificacionMensual @relation(fields: [planificacion_id], references: [id])
  claseGrupo    ClaseGrupo           @relation(fields: [clase_grupo_id], references: [id])
  docente       Docente              @relation(fields: [docente_id], references: [id])

  /// Asignaciones de actividades individuales
  asignacionesActividades AsignacionActividadEstudiante[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  /// Un docente solo puede asignar una planificación una vez a su grupo
  @@unique([planificacion_id, clase_grupo_id])
  @@index([clase_grupo_id, docente_id])
  @@map("asignaciones_docente")
}

/// Asignación de una actividad semanal específica a estudiantes
/// El docente controla CUÁNDO y A QUIÉNES asigna cada semana
model AsignacionActividadEstudiante {
  /// Identificador único
  id String @id @default(cuid())

  /// Asignación padre (de la planificación completa)
  asignacion_docente_id String

  /// Actividad semanal específica
  actividad_id String

  /// Grupo al que se asigna (heredado de asignacion_docente)
  clase_grupo_id String

  // ===== CONTROL TEMPORAL =====
  /// Fecha en que se hace visible para los estudiantes
  fecha_inicio DateTime

  /// Fecha límite para completar (opcional)
  fecha_fin DateTime?

  /// Estado de la asignación
  estado EstadoAsignacion @default(ACTIVA)

  // ===== PERSONALIZACIÓN =====
  /// Mensaje personalizado del docente para esta semana
  mensaje_semana String?

  // ===== NOTIFICACIONES =====
  /// Si se notificó a estudiantes
  notificado_estudiantes         Boolean   @default(false)
  fecha_notificacion_estudiantes DateTime?

  /// Si se notificó a tutores
  notificado_tutores         Boolean   @default(false)
  fecha_notificacion_tutores DateTime?

  // ===== RELACIONES =====
  asignacionDocente AsignacionDocente @relation(fields: [asignacion_docente_id], references: [id], onDelete: Cascade)
  actividad         ActividadSemanal  @relation(fields: [actividad_id], references: [id])
  claseGrupo        ClaseGrupo        @relation(fields: [clase_grupo_id], references: [id])

  /// Progreso de cada estudiante
  progresosEstudiantes ProgresoEstudianteActividad[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@index([clase_grupo_id, fecha_inicio])
  @@index([asignacion_docente_id])
  @@map("asignaciones_actividad_estudiante")
}

/// Estados de una asignación
enum EstadoAsignacion {
  ACTIVA // Disponible para los estudiantes
  PAUSADA // Docente la pausó temporalmente
  FINALIZADA // Ya pasó la fecha límite
  CANCELADA // Docente la canceló

  @@map("estado_asignacion")
}

/// Progreso individual de cada estudiante en cada actividad
model ProgresoEstudianteActividad {
  /// Identificador único
  id String @id @default(cuid())

  /// Estudiante
  estudiante_id String

  /// Actividad semanal
  actividad_id String

  /// Asignación específica (para saber de qué grupo viene)
  asignacion_id String

  // ===== ESTADO DE PROGRESO =====
  /// Si el estudiante inició la actividad
  iniciado     Boolean   @default(false)
  fecha_inicio DateTime?

  /// Si completó la actividad
  completado       Boolean   @default(false)
  fecha_completado DateTime?

  // ===== MÉTRICAS =====
  /// Puntos obtenidos
  puntos_obtenidos Int @default(0)

  /// Tiempo total jugando (en minutos)
  tiempo_total_minutos Int @default(0)

  /// Cantidad de intentos
  intentos Int @default(0)

  /// Mejor puntaje obtenido
  mejor_puntaje Int @default(0)

  // ===== ESTADO DEL JUEGO =====
  /// Estado actual del juego (para poder continuar después)
  /// Estructura flexible según el juego
  estado_juego Json? // { "nivel": 5, "vidas": 2, "items_desbloqueados": [...] }

  /// Respuestas detalladas (para análisis del docente)
  respuestas_detalle Json? // [{ "pregunta": 1, "correcta": true, "tiempo_segundos": 5 }]

  // ===== RELACIONES =====
  estudiante Estudiante                    @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  actividad  ActividadSemanal              @relation(fields: [actividad_id], references: [id])
  asignacion AsignacionActividadEstudiante @relation(fields: [asignacion_id], references: [id], onDelete: Cascade)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  /// Un estudiante solo tiene un progreso por actividad por asignación
  @@unique([estudiante_id, actividad_id, asignacion_id])
  @@index([estudiante_id])
  @@index([actividad_id])
  @@index([asignacion_id])
  @@map("progreso_estudiante_actividad")
}

// ============================================================================
// SISTEMA DE TIENDA Y RECURSOS (XP, MONEDAS, GEMAS)
// ============================================================================

/// Recursos del estudiante (XP, Monedas, Gemas)
/// Tabla que centraliza todos los recursos obtenibles por el estudiante
model RecursosEstudiante {
  /// Identificador único
  id String @id @default(cuid())

  /// ID del estudiante
  estudiante_id String @unique

  /// XP total acumulado (Experience Points)
  /// Se usa para niveles, desafíos, progresión
  xp_total Int @default(0)

  /// Monedas totales (moneda principal para compras en tienda)
  /// Se obtienen completando actividades, desafíos, asistencias
  monedas_total Int @default(0)

  /// NOTA: gemas_total eliminado - sistema simplificado a 2 monedas (XP + Monedas)

  /// Última actualización de recursos
  ultima_actualizacion DateTime @updatedAt

  /// Timestamp de creación
  createdAt DateTime @default(now())

  /// Timestamp de última actualización
  updatedAt DateTime @updatedAt

  /// Relaciones
  estudiante    Estudiante           @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  transacciones TransaccionRecurso[]
  compras       CompraItem[]

  @@index([estudiante_id])
  @@map("recursos_estudiante")
}

/// Transacciones de recursos (historial de cambios)
/// Tabla transaccional que registra cada cambio en XP/Monedas/Gemas
model TransaccionRecurso {
  /// Identificador único
  id String @id @default(cuid())

  /// ID del recurso del estudiante
  recursos_estudiante_id String

  /// Tipo de recurso afectado
  tipo_recurso TipoRecurso

  /// Cantidad (positivo = ganancia, negativo = gasto)
  cantidad Int

  /// Razón de la transacción
  /// Ejemplos: "actividad_completada", "compra_tienda", "logro_desbloqueado", "racha_7_dias"
  razon String

  /// Metadata adicional (JSON flexible)
  /// Puede contener: actividad_id, item_id, logro_id, etc.
  metadata Json?

  /// Fecha de la transacción
  fecha DateTime @default(now())

  /// Timestamp de creación
  createdAt DateTime @default(now())

  /// Relaciones
  recursosEstudiante RecursosEstudiante @relation(fields: [recursos_estudiante_id], references: [id], onDelete: Cascade)

  @@index([recursos_estudiante_id])
  @@index([tipo_recurso])
  @@index([fecha])
  @@map("transacciones_recurso")
}

/// Categorías de items de la tienda
/// Organiza los items en secciones (Avatares, Skins, Power-ups, etc.)
model CategoriaItem {
  /// Identificador único
  id String @id @default(cuid())

  /// Nombre de la categoría
  /// Ejemplos: "Avatares", "Skins", "Power-ups", "Efectos"
  nombre String @unique

  /// Descripción de la categoría
  descripcion String?

  /// Icono/emoji de la categoría
  icono String

  /// Orden de visualización
  orden Int @default(0)

  /// Si está activa y visible en tienda
  activa Boolean @default(true)

  /// Timestamp de creación
  createdAt DateTime @default(now())

  /// Timestamp de última actualización
  updatedAt DateTime @updatedAt

  /// Relaciones
  items ItemTienda[]

  @@map("categorias_item")
}

/// Items disponibles en la tienda
/// Define cada item comprable (avatares, skins, power-ups, cosméticos)
model ItemTienda {
  /// Identificador único
  id String @id @default(cuid())

  /// Nombre del item
  nombre String

  /// Descripción del item
  descripcion String?

  /// ID de la categoría
  categoria_id String

  /// Tipo de item (avatar, skin, powerup, cosmetico, etc.)
  tipo_item TipoItem

  /// Precio en monedas (0 si se compra solo con gemas)
  precio_monedas Int @default(0)

  /// Precio en gemas (0 si se compra solo con monedas)
  precio_gemas Int @default(0)

  /// URL de la imagen/preview del item
  imagen_url String?

  /// Rareza del item (común, raro, épico, legendario)
  rareza RarezaItem @default(COMUN)

  /// Si es un item de edición limitada
  edicion_limitada Boolean @default(false)

  /// Fecha de inicio de disponibilidad (null = siempre disponible)
  fecha_inicio DateTime?

  /// Fecha de fin de disponibilidad (null = sin fecha límite)
  fecha_fin DateTime?

  /// Nivel mínimo requerido para comprar
  nivel_minimo_requerido Int @default(1)

  /// Si está disponible en la tienda
  disponible Boolean @default(true)

  /// Cantidad de veces que se ha comprado (para estadísticas)
  veces_comprado Int @default(0)

  /// Metadata adicional del item (JSON flexible)
  /// Puede contener: stats, efectos, duración, etc.
  metadata Json?

  /// Timestamp de creación
  createdAt DateTime @default(now())

  /// Timestamp de última actualización
  updatedAt DateTime @updatedAt

  /// Relaciones
  categoria      CategoriaItem  @relation(fields: [categoria_id], references: [id])
  compras        CompraItem[]
  itemsObtenidos ItemObtenido[]

  @@index([categoria_id])
  @@index([tipo_item])
  @@index([rareza])
  @@index([disponible])
  @@map("items_tienda")
}

/// Items obtenidos por el estudiante (inventario)
/// Registra qué items posee cada estudiante
model ItemObtenido {
  /// Identificador único
  id String @id @default(cuid())

  /// ID del estudiante
  estudiante_id String

  /// ID del item
  item_id String

  /// Fecha de obtención
  fecha_obtencion DateTime @default(now())

  /// Si el item está equipado/activo actualmente
  equipado Boolean @default(false)

  /// Cantidad (para items consumibles/stackeables)
  cantidad Int @default(1)

  /// Metadata adicional (JSON flexible)
  /// Puede contener: usos_restantes, fecha_expiracion, etc.
  metadata Json?

  /// Timestamp de creación
  createdAt DateTime @default(now())

  /// Timestamp de última actualización
  updatedAt DateTime @updatedAt

  /// Relaciones
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  item       ItemTienda @relation(fields: [item_id], references: [id])

  @@unique([estudiante_id, item_id])
  @@index([estudiante_id])
  @@index([item_id])
  @@index([equipado])
  @@map("items_obtenidos")
}

/// Compras realizadas en la tienda (historial transaccional)
/// Registra cada compra de item por estudiante
model CompraItem {
  /// Identificador único
  id String @id @default(cuid())

  /// ID del recurso del estudiante (para tracking de recursos)
  recursos_estudiante_id String

  /// ID del item comprado
  item_id String

  /// Precio pagado en monedas
  monedas_gastadas Int @default(0)

  /// Precio pagado en gemas
  gemas_gastadas Int @default(0)

  /// Fecha de la compra
  fecha_compra DateTime @default(now())

  /// Timestamp de creación
  createdAt DateTime @default(now())

  /// Relaciones
  recursosEstudiante RecursosEstudiante @relation(fields: [recursos_estudiante_id], references: [id], onDelete: Cascade)
  item               ItemTienda         @relation(fields: [item_id], references: [id])

  @@index([recursos_estudiante_id])
  @@index([item_id])
  @@index([fecha_compra])
  @@map("compras_item")
}

// ============================================================================
// ENUMS PARA TIENDA Y RECURSOS
// ============================================================================

/// Tipos de recursos del estudiante
enum TipoRecurso {
  XP
  MONEDAS
  // GEMAS eliminado - solo 2 monedas en MVP

  @@map("tipo_recurso")
}

/// Tipos de items de la tienda
enum TipoItem {
  AVATAR // Avatar 3D completo
  SKIN // Skin/outfit para avatar
  ACCESORIO // Accesorios (sombreros, gafas, etc.)
  POWERUP // Power-ups temporales (2x XP, etc.)
  COSMETICO // Efectos cosméticos (partículas, auras, etc.)
  TITULO // Títulos/badges personalizados
  EMOJI // Emojis/stickers personalizados
  FONDO // Fondos de perfil
  MARCO // Marcos de avatar

  @@map("tipo_item")
}

/// Rareza de items
enum RarezaItem {
  COMUN
  RARO
  EPICO
  LEGENDARIO

  @@map("rareza_item")
}

// ============================================================================
// SISTEMA DE GAMIFICACIÓN V2 - COMPLETO
// ============================================================================
// Implementa el sistema optimizado con:
// - 67 logros con criterios automáticos
// - 2 monedas: XP + Monedas
// - Sistema de rachas
// - Catálogo de cursos canjeables
// - Sistema de puntos para padres
// ============================================================================

// ==========================================
// MODELO: Logro (Definiciones)
// ==========================================

model Logro {
  id String @id @default(cuid())

  // Identificación
  codigo      String @unique // "racha_7_dias", "completista", etc
  nombre      String // "Racha de Fuego"
  descripcion String
  categoria   String // "consistencia", "maestria", "social", etc

  // Recompensas
  monedas_recompensa Int
  xp_recompensa      Int

  // Criterios de desbloqueo
  criterio_tipo  String // "racha_dias", "temas_completados", etc
  criterio_valor String // JSON con valor(es) necesarios

  // Metadata
  icono              String
  rareza             String // "comun", "raro", "epico", "legendario"
  secreto            Boolean @default(false)
  animacion          String? // ID de animación desbloqueada
  titulo             String? // Título que otorga
  badge              String? // Badge que otorga
  mensaje_desbloqueo String? // Mensaje especial al desbloquear
  extras             Json? // Array de extras (["texto1", "texto2"])

  // Orden y estado
  orden  Int     @default(0)
  activo Boolean @default(true)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relaciones
  logros_estudiantes LogroEstudiante[]

  // Índices de performance para agrupaciones y filtros
  @@index([categoria], name: "idx_logros_categoria")
  @@index([rareza], name: "idx_logros_rareza")
  @@index([activo], name: "idx_logros_activo")
  @@map("logros_gamificacion")
}

// ==========================================
// MODELO: LogroEstudiante (Desbloqueados)
// ==========================================

model LogroEstudiante {
  id String @id @default(cuid())

  estudiante_id String
  logro_id      String

  fecha_desbloqueo DateTime @default(now())
  visto            Boolean  @default(false) // Para notificaciones

  // Relaciones
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  logro      Logro      @relation(fields: [logro_id], references: [id])

  @@unique([estudiante_id, logro_id])
  @@index([estudiante_id])
  @@index([logro_id])
  @@index([visto])
  @@map("logros_estudiantes_gamificacion")
}

// ==========================================
// MODELO: RachaEstudiante
// ==========================================

model RachaEstudiante {
  id            String @id @default(cuid())
  estudiante_id String @unique

  // Estado actual
  racha_actual Int @default(0)
  racha_maxima Int @default(0)

  // Fechas
  ultima_actividad    DateTime?
  inicio_racha_actual DateTime?

  // Metadata
  total_dias_activos Int @default(0)

  updated_at DateTime @updatedAt

  // Relaciones
  estudiante Estudiante @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)

  @@index([estudiante_id])
  @@index([ultima_actividad])
  @@map("rachas_estudiantes")
}

// ==========================================
// MODELO: CursoCatalogo
// ==========================================

model CursoCatalogo {
  id String @id @default(cuid())

  // Información básica
  codigo       String  @unique // "quimica_explosiva"
  titulo       String
  descripcion  String  @db.Text
  categoria    String // "ciencia", "programacion", "robotica", "diseno"
  subcategoria String?

  // Detalles académicos
  duracion_clases Int
  nivel_requerido Int   @default(1) // Nivel mínimo estudiante
  contenido       Json? // Syllabus, módulos, etc

  // Pricing
  precio_usd     Decimal @db.Decimal(10, 2)
  precio_monedas Int // precio_usd * 20

  // Media
  imagen_url        String?
  video_preview_url String?

  // Metadata
  destacado Boolean @default(false)
  nuevo     Boolean @default(false)
  activo    Boolean @default(true)
  orden     Int     @default(0)

  // Stats
  total_canjes Int     @default(0)
  rating       Decimal @default(0) @db.Decimal(3, 2)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relaciones
  solicitudes_canje  SolicitudCanje[]
  cursos_estudiantes CursoEstudiante[]

  @@index([categoria])
  @@index([destacado])
  @@index([activo])
  @@map("cursos_catalogo")
}

// ==========================================
// MODELO: SolicitudCanje
// ==========================================

model SolicitudCanje {
  id String @id @default(cuid())

  // Partes involucradas
  estudiante_id String
  tutor_id      String
  curso_id      String

  // Detalles del canje
  monedas_usadas Int
  estado         String // "pendiente", "aprobada", "rechazada", "cancelada"

  // Decisión del padre
  fecha_decision DateTime?
  opcion_pago    String? // "padre_paga_todo", "hijo_paga_mitad", "hijo_paga_todo"
  monto_padre    Decimal?  @db.Decimal(10, 2) // Cuánto pagó el padre
  mensaje_padre  String?   @db.Text

  // Metadata
  fecha_solicitud  DateTime  @default(now())
  fecha_expiracion DateTime? // Opcional: expira en 7 días

  // Relaciones
  estudiante Estudiante    @relation(fields: [estudiante_id], references: [id])
  tutor      Tutor         @relation(fields: [tutor_id], references: [id])
  curso      CursoCatalogo @relation(fields: [curso_id], references: [id])

  @@index([estudiante_id])
  @@index([tutor_id])
  @@index([estado])
  @@index([fecha_solicitud])
  @@map("solicitudes_canje")
}

// ==========================================
// MODELO: CursoEstudiante (Habilitados)
// ==========================================

model CursoEstudiante {
  id String @id @default(cuid())

  estudiante_id String
  curso_id      String

  // Progreso
  progreso         Int       @default(0) // 0-100%
  completado       Boolean   @default(false)
  fecha_inicio     DateTime  @default(now())
  fecha_completado DateTime?

  // Relaciones
  estudiante Estudiante    @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  curso      CursoCatalogo @relation(fields: [curso_id], references: [id])

  @@unique([estudiante_id, curso_id])
  @@index([estudiante_id])
  @@index([completado])
  @@map("cursos_estudiantes")
}

// ==========================================
// MODELO: PuntosPadre
// ==========================================

model PuntosPadre {
  id       String @id @default(cuid())
  tutor_id String @unique

  // Recursos
  puntos_total Int @default(0)
  xp_total     Int @default(0)

  // Stats
  pagos_puntuales_consecutivos Int @default(0)
  total_referidos_activos      Int @default(0)

  updated_at DateTime @updatedAt

  // Relaciones
  tutor         Tutor                    @relation(fields: [tutor_id], references: [id], onDelete: Cascade)
  transacciones TransaccionPuntosPadre[]
  canjes        CanjePadre[]

  @@index([tutor_id])
  @@map("puntos_padres")
}

// ==========================================
// MODELO: TransaccionPuntosPadre
// ==========================================

model TransaccionPuntosPadre {
  id              String @id @default(cuid())
  puntos_padre_id String

  tipo_recurso String // "PUNTOS", "XP"
  cantidad     Int
  razon        String // "pago_puntual", "referido", "engagement"

  metadata Json?
  fecha    DateTime @default(now())

  puntos_padre PuntosPadre @relation(fields: [puntos_padre_id], references: [id], onDelete: Cascade)

  @@index([puntos_padre_id])
  @@index([tipo_recurso])
  @@index([fecha])
  @@map("transacciones_puntos_padres")
}

// ==========================================
// MODELO: PremioPadre
// ==========================================

model PremioPadre {
  id String @id @default(cuid())

  // Información
  codigo      String @unique
  titulo      String
  descripcion String @db.Text
  categoria   String // "digital", "acceso", "premium", "epico"

  // Costo
  puntos_requeridos Int
  costo_real_usd    Decimal? @db.Decimal(10, 2)

  // Metadata
  icono  String
  activo Boolean @default(true)
  orden  Int     @default(0)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  canjes CanjePadre[]

  @@index([categoria])
  @@index([activo])
  @@map("premios_padres")
}

// ==========================================
// MODELO: CanjePadre
// ==========================================

model CanjePadre {
  id String @id @default(cuid())

  tutor_id        String
  premio_id       String
  puntos_padre_id String

  puntos_usados Int
  estado        String @default("completado")

  fecha_canje DateTime @default(now())

  tutor        Tutor       @relation(fields: [tutor_id], references: [id])
  premio       PremioPadre @relation(fields: [premio_id], references: [id])
  puntos_padre PuntosPadre @relation(fields: [puntos_padre_id], references: [id])

  @@index([tutor_id])
  @@index([fecha_canje])
  @@map("canjes_padres")
}

// ========================================
// SISTEMA DE CAMPAÑAS NARRATIVAS
// ========================================

// ========================================
// COLONIA DE VERANO 2026
// ========================================

/// Modelo para inscripciones a la Colonia de Verano 2026
model ColoniaInscripcion {
  id String @id @default(cuid())

  tutor_id           String
  estado             String   @default("active") // "active", "blocked", "cancelled"
  descuento_aplicado Int // 0, 12 o 20
  total_mensual      Int // Monto que se cobra cada mes
  fecha_inscripcion  DateTime @default(now())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tutor       Tutor               @relation(fields: [tutor_id], references: [id], onDelete: Cascade)
  estudiantes ColoniaEstudiante[]
  pagos       ColoniaPago[]

  @@index([tutor_id])
  @@index([estado])
  @@map("colonia_inscripciones")
}

/// Modelo para estudiantes inscritos en la colonia
model ColoniaEstudiante {
  id String @id @default(cuid())

  inscripcion_id String
  estudiante_id  String // Referencia a la tabla estudiantes
  nombre         String
  edad           Int
  pin            String @unique // 4 dígitos para acceso

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  inscripcion ColoniaInscripcion       @relation(fields: [inscripcion_id], references: [id], onDelete: Cascade)
  estudiante  Estudiante               @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  cursos      ColoniaEstudianteCurso[]

  @@index([inscripcion_id])
  @@index([estudiante_id])
  @@index([pin])
  @@map("colonia_estudiantes")
}

/// Modelo para cursos seleccionados por cada estudiante
model ColoniaEstudianteCurso {
  id String @id @default(cuid())

  colonia_estudiante_id String
  course_id             String // ID del curso (ej: 'mat-juegos-desafios')
  course_name           String
  course_area           String // "Matemática", "Programación", "Ciencias"
  instructor            String
  day_of_week           String // "Lunes", "Martes", etc
  time_slot             String // "10:30-12:00", "14:30-16:00"
  precio_base           Int // 55000
  precio_con_descuento  Int // Después de aplicar descuento

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  estudiante ColoniaEstudiante @relation(fields: [colonia_estudiante_id], references: [id], onDelete: Cascade)

  @@index([colonia_estudiante_id])
  @@index([course_id])
  @@map("colonia_estudiante_cursos")
}

/// Modelo para pagos mensuales de la colonia
model ColoniaPago {
  id String @id @default(cuid())

  inscripcion_id            String
  mes                       String // "enero", "febrero", "marzo"
  anio                      Int // 2026
  monto                     Int
  estado                    String    @default("pending") // "pending", "paid", "failed", "cancelled"
  mercadopago_preference_id String?
  mercadopago_payment_id    String?
  fecha_vencimiento         DateTime // Día 5 del mes
  fecha_pago                DateTime?
  fecha_creacion            DateTime  @default(now())
  processed_at              DateTime? // Para idempotencia en webhooks

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  inscripcion ColoniaInscripcion @relation(fields: [inscripcion_id], references: [id], onDelete: Cascade)

  @@index([inscripcion_id])
  @@index([estado])
  @@index([fecha_vencimiento])
  @@index([mercadopago_preference_id])
  @@index([processed_at])
  @@map("colonia_pagos")
}

// ============================================================================
// SISTEMA DE INSCRIPCIONES 2026 - UNIFICADO
// ============================================================================
// Este sistema maneja las 3 opciones de inscripción para 2026:
// 1. Colonia de Verano (Enero-Febrero)
// 2. Ciclo 2026 (Marzo-Diciembre)
// 3. Pack Completo (Colonia + Ciclo)
// ============================================================================

/// Modelo principal para inscripciones 2026
/// Una inscripción representa la decisión del tutor de inscribir estudiantes
/// en uno de los 3 tipos disponibles: Colonia, Ciclo 2026 o Pack Completo
model Inscripcion2026 {
  /// Identificador único de la inscripción
  id String @id @default(cuid())

  /// ID del tutor responsable
  tutor_id String

  /// Tipo de inscripción elegida
  /// - "colonia": Solo Colonia de Verano (Enero-Febrero)
  /// - "ciclo2026": Solo Ciclo 2026 (Marzo-Diciembre)
  /// - "pack-completo": Ambos con descuento
  tipo_inscripcion String // "colonia" | "ciclo2026" | "pack-completo"

  /// Estado de la inscripción
  /// - "pending": Creada pero sin pagar inscripción inicial
  /// - "active": Inscripción pagada, estudiante puede acceder
  /// - "blocked": Bloqueada por falta de pago mensual
  /// - "cancelled": Cancelada por el tutor o por falta de pago
  estado String @default("pending") // "pending" | "active" | "blocked" | "cancelled"

  /// Monto de inscripción/matrícula inicial pagado
  /// - Colonia: $25.000
  /// - Ciclo 2026: $50.000 (Early Bird Nov-Dic)
  /// - Pack Completo: $60.000 (ahorro de $15.000)
  inscripcion_pagada Int

  /// Porcentaje de descuento aplicado (0-20%)
  /// Solo aplica para Colonia (por hermanos o múltiples cursos)
  descuento_aplicado Int @default(0)

  /// Monto mensual actual (puede variar según el mes)
  /// Colonia: $55.000/mes (Ene-Feb)
  /// Ciclo 2026: $60.000/mes (Mar+)
  /// Pack: $55.000 (Ene-Feb) → $60.000 (Mar+)
  total_mensual_actual Int

  /// Origen de la inscripción - ¿Cómo nos conociste?
  /// Ejemplos: "Instagram", "Facebook", "Recomendación", "Google", "Otro"
  origen_inscripcion String?

  /// Ciudad/localidad de donde se inscribe
  ciudad String?

  /// Fecha en que se realizó la inscripción
  fecha_inscripcion DateTime @default(now())

  /// Fecha de inicio de las clases
  /// Colonia/Pack: Enero 2026
  /// Ciclo: Marzo 2026
  fecha_inicio DateTime?

  /// Fecha de finalización esperada
  /// Colonia: Febrero 2026
  /// Ciclo/Pack: Diciembre 2026
  fecha_fin DateTime?

  /// Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Relaciones
  tutor                    Tutor                            @relation(fields: [tutor_id], references: [id], onDelete: Cascade)
  estudiantes              EstudianteInscripcion2026[]
  pagos                    PagoInscripcion2026[]
  historial_estado_cambios HistorialEstadoInscripcion2026[]

  @@index([tutor_id])
  @@index([tipo_inscripcion])
  @@index([estado])
  @@index([fecha_inscripcion])
  @@map("inscripciones_2026")
}

/// Modelo para vincular estudiantes con inscripciones 2026
/// Cada registro representa un estudiante inscrito en una opción específica
model EstudianteInscripcion2026 {
  /// Identificador único del registro
  id String @id @default(cuid())

  /// ID de la inscripción padre
  inscripcion_id String

  /// ID del estudiante (puede ser existente o nuevo)
  estudiante_id String

  /// Nombre del estudiante (snapshot al momento de inscripción)
  nombre String

  /// Edad del estudiante al momento de inscripción
  edad Int

  /// DNI del estudiante (opcional)
  dni String?

  /// PIN de 4 dígitos para login del estudiante
  /// Generado automáticamente al crear la inscripción
  pin String

  /// ID del tier de suscripción (ARCADE, ARCADE_PLUS, PRO)
  /// Nullable para inscripciones legacy y migraciones
  tier_id String?

  /// Estado del onboarding (flujo de primera vez)
  /// PENDIENTE -> SELECCION_MUNDOS -> TEST_UBICACION -> CONFIRMACION_CASA -> CREACION_AVATAR -> COMPLETADO
  onboarding_estado OnboardingEstado @default(PENDIENTE)

  /// Fecha en que completó el onboarding
  onboarding_completado_at DateTime?

  /// Configuración del avatar 2D (JSON con opciones de personalización)
  /// TODO: Definir estructura cuando se diseñe el sistema de avatares
  avatar_config Json?

  /// Mundos seleccionados por el estudiante (IDs de mundos)
  /// Se guardan durante el onboarding paso SELECCION_MUNDOS
  mundos_seleccionados String[] @default([])

  /// Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Relaciones
  inscripcion    Inscripcion2026                @relation(fields: [inscripcion_id], references: [id], onDelete: Cascade)
  estudiante     Estudiante                     @relation(fields: [estudiante_id], references: [id], onDelete: Cascade)
  tier           Tier?                          @relation(fields: [tier_id], references: [id])
  cursos_colonia ColoniaCursoSeleccionado2026[]
  mundos_ciclo   CicloMundoSeleccionado2026[]
  cambios_tier   CambioTierPendiente[]

  @@unique([inscripcion_id, estudiante_id])
  @@index([inscripcion_id])
  @@index([estudiante_id])
  @@index([pin])
  @@index([tier_id])
  @@map("estudiantes_inscripciones_2026")
}

/// Modelo para cursos de Colonia seleccionados por estudiante
/// Solo se usa si tipo_inscripcion === "colonia" O "pack-completo"
model ColoniaCursoSeleccionado2026 {
  /// Identificador único del registro
  id String @id @default(cuid())

  /// ID del estudiante-inscripción
  estudiante_inscripcion_id String

  /// ID del curso de colonia (del catálogo de 11 cursos)
  course_id String

  /// Datos del curso (snapshot para histórico)
  course_name String
  course_area String
  instructor  String
  day_of_week String
  time_slot   String

  /// Precios
  precio_base          Int // $55.000
  precio_con_descuento Int // Con descuento aplicado si hay

  /// Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Relaciones
  estudiante_inscripcion EstudianteInscripcion2026 @relation(fields: [estudiante_inscripcion_id], references: [id], onDelete: Cascade)

  @@index([estudiante_inscripcion_id])
  @@index([course_id])
  @@map("colonia_cursos_seleccionados_2026")
}

/// Modelo para mundo STEAM seleccionado en Ciclo 2026
/// Solo se usa si tipo_inscripcion === "ciclo2026" O "pack-completo"
model CicloMundoSeleccionado2026 {
  /// Identificador único del registro
  id String @id @default(cuid())

  /// ID del estudiante-inscripción
  estudiante_inscripcion_id String

  /// Mundo STEAM elegido por el estudiante (enum tipado)
  mundo MundoTipo

  /// Horario asignado (se define después, antes del 20 feb 2026)
  dia_semana String? // "lunes", "martes", etc.
  horario    String? // "16:00-17:30", "18:00-19:30", etc.

  /// Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Relaciones
  estudiante_inscripcion EstudianteInscripcion2026 @relation(fields: [estudiante_inscripcion_id], references: [id], onDelete: Cascade)

  @@index([estudiante_inscripcion_id])
  @@index([mundo])
  @@map("ciclo_mundos_seleccionados_2026")
}

/// Modelo para pagos relacionados con inscripciones 2026
/// Incluye tanto el pago inicial de inscripción como los pagos mensuales
model PagoInscripcion2026 {
  /// Identificador único del pago
  id String @id @default(cuid())

  /// ID de la inscripción asociada
  inscripcion_id String

  /// Tipo de pago
  /// - "inscripcion": Pago único inicial (matrícula)
  /// - "mensualidad": Cuota mensual
  tipo String // "inscripcion" | "mensualidad"

  /// Para mensualidades: mes y año
  mes  String? // "enero", "febrero", "marzo", etc.
  anio Int? // 2026

  /// Monto a pagar
  monto Int

  /// Estado del pago
  /// - "pending": Pendiente de pago
  /// - "paid": Pagado correctamente
  /// - "failed": Pago fallido
  /// - "cancelled": Pago cancelado
  estado String @default("pending") // "pending" | "paid" | "failed" | "cancelled"

  /// IDs de MercadoPago para tracking
  mercadopago_preference_id String? // Preference ID de MP
  mercadopago_payment_id    String? @unique // Payment ID una vez pagado (ÚNICO por transacción)

  /// Fecha límite de pago (día 5 del mes para mensualidades)
  fecha_vencimiento DateTime?

  /// Fecha en que se realizó el pago
  fecha_pago DateTime?

  /// Timestamp de procesamiento del webhook (para idempotencia)
  processed_at DateTime?

  /// IP desde donde se originó el pago (para detección de fraude)
  ip_address String?

  /// Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Relaciones
  inscripcion Inscripcion2026 @relation(fields: [inscripcion_id], references: [id], onDelete: Cascade)

  @@index([inscripcion_id])
  @@index([tipo])
  @@index([estado])
  @@index([fecha_vencimiento])
  @@index([mercadopago_preference_id])
  @@index([mercadopago_payment_id])
  @@index([processed_at])
  @@map("pagos_inscripciones_2026")
}

/// Modelo para historial de cambios de estado de inscripciones
/// Permite auditar y rastrear todos los cambios de estado
model HistorialEstadoInscripcion2026 {
  /// Identificador único del registro
  id String @id @default(cuid())

  /// ID de la inscripción
  inscripcion_id String

  /// Estado anterior
  estado_anterior String // "pending", "active", "blocked", "cancelled"

  /// Estado nuevo
  estado_nuevo String // "pending", "active", "blocked", "cancelled"

  /// Razón del cambio
  /// Ejemplos:
  /// - "Pago de inscripción recibido"
  /// - "Falta de pago mensual"
  /// - "Cancelación solicitada por tutor"
  razon String

  /// Usuario/sistema que realizó el cambio
  /// Puede ser "system" para cambios automáticos o un ID de admin
  realizado_por String @default("system")

  /// Timestamp del cambio
  fecha_cambio DateTime @default(now())

  /// Relaciones
  inscripcion Inscripcion2026 @relation(fields: [inscripcion_id], references: [id], onDelete: Cascade)

  @@index([inscripcion_id])
  @@index([fecha_cambio])
  @@map("historial_estado_inscripciones_2026")
}

/// =============================================================================
/// SECURITY: Sistema de Idempotencia de Webhooks
/// =============================================================================

/// Modelo para tracking de webhooks procesados de MercadoPago
/// Previene doble procesamiento de pagos (idempotencia)
///
/// MercadoPago puede enviar el mismo webhook múltiples veces por:
/// - Reintentos automáticos si no respondemos 200 OK rápido
/// - Timeouts de red
/// - Problemas en infraestructura
///
/// Esta tabla garantiza que cada payment_id se procesa UNA SOLA VEZ
model WebhookProcessed {
  /// Identificador único del registro
  id String @id @default(uuid())

  /// ID del pago de MercadoPago (payment_id)
  /// UNIQUE constraint previene doble procesamiento
  payment_id String @unique

  /// Tipo de webhook procesado
  /// Ejemplos: "inscripcion", "membresia", "inscripcion2026", "colonia"
  webhook_type String

  /// Estado del pago cuando se procesó
  /// Ejemplos: "approved", "rejected", "pending"
  status String

  /// External reference del pago (para debugging)
  /// Formato: "inscripcion-{id}-estudiante-{id}-producto-{id}"
  external_reference String

  /// Timestamp de cuando se procesó el webhook
  processed_at DateTime @default(now())

  /// Timestamp de creación del registro
  created_at DateTime @default(now())

  /// Índices para queries eficientes
  @@index([payment_id])
  @@index([processed_at])
  @@index([webhook_type])
  @@map("webhooks_processed")
}

/// Modelo de Audit Logs para rastrear todas las acciones críticas del sistema
/// PROPÓSITO: Seguridad, compliance y debugging de operaciones sensibles
///
/// CASOS DE USO:
/// - Detectar accesos no autorizados o sospechosos
/// - Auditorías de seguridad y compliance (GDPR, regulaciones)
/// - Debugging de cambios inesperados en datos críticos
/// - Forense digital en caso de incidentes
///
/// QUÉ SE LOGUEA:
/// - Cambios en datos sensibles (precios, pagos, usuarios)
/// - Acciones administrativas críticas (crear/modificar/eliminar usuarios)
/// - Eventos de seguridad (login fallido, MFA, cambio de permisos)
/// - Operaciones de pago (creación, actualización de estados)
/// - Modificaciones de configuración del sistema
///
/// RETENCIÓN:
/// - Logs se mantienen indefinidamente para auditorías
/// - Se pueden archivar logs antiguos (>1 año) a almacenamiento frío
model AuditLog {
  /// ID único del log (CUID)
  id String @id @default(cuid())

  /// Timestamp de cuando ocurrió la acción (indexado para búsquedas por fecha)
  timestamp DateTime @default(now())

  /// ID del usuario que realizó la acción (null para acciones del sistema)
  /// Formato: UUID del usuario (tutor, admin, docente, estudiante)
  user_id String?

  /// Tipo de usuario que realizó la acción
  /// Valores: "tutor", "admin", "docente", "estudiante", "system"
  user_type String?

  /// Email del usuario (para facilitar búsquedas)
  user_email String?

  /// Acción realizada
  /// Ejemplos: "create", "update", "delete", "login", "logout", "payment_created", "mfa_enabled"
  action String

  /// Entidad afectada
  /// Ejemplos: "Tutor", "Admin", "Pago", "Inscripcion", "Membresia", "Auth"
  entity_type String

  /// ID de la entidad afectada (si aplica)
  /// Formato: UUID de la entidad modificada
  entity_id String?

  /// Descripción legible de la acción
  /// Ejemplo: "Creó inscripción mensual para estudiante Juan Pérez ($5000)"
  description String

  /// Cambios realizados (JSON)
  /// Formato: { "before": {...}, "after": {...} }
  /// IMPORTANTE: NO incluir datos sensibles como passwords
  changes Json?

  /// Metadata adicional (JSON)
  /// Puede incluir: IP, user agent, request ID, etc.
  metadata Json?

  /// Severidad del evento
  /// Valores: "info", "warning", "error", "critical"
  severity String @default("info")

  /// Categoría del evento
  /// Valores: "auth", "payment", "user_management", "data_modification", "security"
  category String

  /// IP desde donde se realizó la acción
  ip_address String?

  /// User agent del cliente
  user_agent String?

  /// Request ID (para correlacionar con logs de aplicación)
  request_id String?

  /// Timestamp de creación del registro (siempre NOW)
  created_at DateTime @default(now())

  /// Índices para queries eficientes
  @@index([timestamp])
  @@index([user_id])
  @@index([action])
  @@index([entity_type])
  @@index([category])
  @@index([severity])
  @@index([user_email])
  @@map("audit_logs")
}

/// Modelo de Rotación de Secrets
/// PROPÓSITO: Gestión segura de rotación de secretos críticos del sistema
///
/// PROBLEMA QUE RESUELVE:
/// - Secretos estáticos (JWT_SECRET, WEBHOOK_SECRET) nunca expiran
/// - Si un secret se compromete, afecta toda la seguridad del sistema
/// - No hay forma automática de rotar secrets sin downtime
///
/// SOLUCIÓN:
/// - Rotación automática cada 90 días
/// - Período de gracia de 7 días donde ambos secrets son válidos
/// - Historial de rotaciones para auditoría
/// - Alertas antes de expiración
///
/// SECRETS GESTIONADOS:
/// - JWT_SECRET: Para tokens de autenticación
/// - MERCADOPAGO_WEBHOOK_SECRET: Para validación de webhooks
///
/// FLUJO DE ROTACIÓN:
/// 1. Sistema detecta que secret tiene 83+ días (7 días antes de expirar)
/// 2. Genera nuevo secret y lo marca como "pending"
/// 3. Admin recibe alerta para actualizar variables de entorno
/// 4. Al día 90, el secret viejo expira y solo el nuevo es válido
/// 5. Período de gracia permite transición sin downtime
model SecretRotation {
  /// ID único del registro
  id String @id @default(cuid())

  /// Tipo de secret
  /// Valores: "JWT_SECRET", "WEBHOOK_SECRET"
  secret_type String

  /// Versión del secret (incremental)
  /// Ejemplo: v1, v2, v3...
  version Int

  /// Hash SHA-256 del secret (para verificación sin exponer el secret)
  /// El secret real se almacena en variables de entorno
  secret_hash String

  /// Estado del secret
  /// Valores: "active" (en uso), "pending" (nuevo, en período de gracia), "expired" (ya no válido)
  status String @default("active")

  /// Fecha de creación del secret
  created_at DateTime @default(now())

  /// Fecha de expiración (90 días después de created_at)
  expires_at DateTime

  /// Fecha en que fue rotado (cuando pasó de active a expired)
  rotated_at DateTime?

  /// ID del admin que activó la rotación
  rotated_by String?

  /// Metadata adicional (JSON)
  /// Puede incluir: razón de rotación, IP de quien lo rotó, etc.
  metadata Json?

  @@unique([secret_type, version])
  /// Índices para queries eficientes
  @@index([secret_type])
  @@index([status])
  @@index([expires_at])
  @@index([version])
  @@map("secret_rotations")
}

// ============================================================================
// MATEATLETAS STUDIO - PLANIFICADOR DE CURSOS
// Modelos para el sistema de creación y gestión de cursos
// Documentación: docs/MATEATLETAS_STUDIO.md
// ============================================================================

/// Categoría de curso en Studio
/// Define si es una experiencia temática o contenido curricular
enum CategoriaStudio {
  EXPERIENCIA // Cursos temáticos narrativos (Harry Potter, Minecraft, etc.)
  CURRICULAR // Cursos alineados a currículum escolar

  @@map("categoria_studio")
}

/// Tipo de experiencia temática
/// Solo aplica cuando categoria = EXPERIENCIA
enum TipoExperienciaStudio {
  NARRATIVO // Historia con protagonista y misiones
  EXPEDICION // Exploración de mundos/escenarios
  LABORATORIO // Experimentos guiados
  SIMULACION // Simuladores interactivos
  PROYECTO // Construcción paso a paso
  DESAFIO // Competencias y retos

  @@map("tipo_experiencia_studio")
}

/// Materia curricular
/// Solo aplica cuando categoria = CURRICULAR
enum MateriaStudio {
  MATEMATICA_ESCOLAR // Matemáticas según currículum
  FISICA // Física escolar
  QUIMICA // Química escolar
  PROGRAMACION // Programación estructurada

  @@map("materia_studio")
}

/// Estado del curso en el flujo de trabajo
enum EstadoCursoStudio {
  DRAFT // Recién creado, wizard completado
  EN_PROGRESO // Cargando semanas
  EN_REVISION // Todas las semanas completas, esperando aprobación
  PUBLICADO // Disponible para estudiantes

  @@map("estado_curso_studio")
}

/// Estado de una semana individual
enum EstadoSemanaStudio {
  VACIA // Sin contenido cargado
  COMPLETA // JSON validado y guardado

  @@map("estado_semana_studio")
}

/// Tipo de recurso multimedia en Studio
/// Diferente de TipoRecurso (que es XP/MONEDAS)
enum TipoRecursoStudio {
  IMAGEN // PNG, JPG, WEBP, SVG
  AUDIO // MP3, WAV, OGG
  VIDEO // MP4, WEBM
  DOCUMENTO // PDF

  @@map("tipo_recurso_studio")
}

/// Categoría de componente del catálogo Studio
/// Agrupa los 95 componentes por tipo funcional según MATEATLETAS_STUDIO.md
enum CategoriaComponente {
  INTERACTIVO // DragDrop, MultipleChoice, FillBlanks, etc. (15)
  MOTRICIDAD_FINA // PinchZoom, RotateGesture, TracePath, etc. (10)
  SIMULADOR // MoleculeBuilder3D, GravitySandbox, CellExplorer, etc. (25)
  EDITOR_CODIGO // BlockEditor, PythonEditor, LuaEditor, etc. (10)
  CREATIVO // PixelArtEditor, VectorDrawing, 3DModeler, etc. (10)
  MULTIMEDIA // VideoPlayer, AudioPlayer, InteractivePresentation, etc. (9)
  EVALUACION // Quiz, PracticeMode, ChallengeMode, etc. (8)
  MULTIPLAYER // SharedWhiteboard, TeamChallenge, DebateArena, etc. (8)

  @@map("categoria_componente")
}

/// Curso del Studio (plantilla madre)
/// Representa un curso completo creado en el planificador
model CursoStudio {
  /// Identificador único del curso
  id String @id @default(cuid())

  /// Nombre del curso
  /// Ejemplo: "La Química de Harry Potter"
  nombre String

  /// Descripción del curso
  /// Ejemplo: "Aprende química básica preparando pociones mágicas"
  descripcion String @db.Text

  // ─────────────────────────────────────────────────────────────────────────
  // CLASIFICACIÓN
  // ─────────────────────────────────────────────────────────────────────────

  /// Categoría del curso (Experiencia o Curricular)
  categoria CategoriaStudio

  /// Mundo STEAM al que pertenece
  /// Reutiliza el enum existente MundoTipo
  mundo MundoTipo

  /// Casa objetivo (rango de edad)
  /// Reutiliza el enum existente CasaTipo
  casa CasaTipo

  /// Tier mínimo requerido para acceder
  /// Reutiliza el enum existente TierNombre
  tier_minimo TierNombre

  // ─────────────────────────────────────────────────────────────────────────
  // TIPO ESPECÍFICO (uno u otro según categoría)
  // ─────────────────────────────────────────────────────────────────────────

  /// Tipo de experiencia (solo si categoria = EXPERIENCIA)
  tipo_experiencia TipoExperienciaStudio?

  /// Materia curricular (solo si categoria = CURRICULAR)
  materia MateriaStudio?

  // ─────────────────────────────────────────────────────────────────────────
  // ESTÉTICA
  // ─────────────────────────────────────────────────────────────────────────

  /// Estética base del curso
  /// Ejemplo: "Harry Potter", "Minecraft", "Ciencia Ficción"
  estetica_base String

  /// Variante de la estética (opcional)
  /// Ejemplo: "Hogwarts", "Nether", "Espacial"
  estetica_variante String?

  // ─────────────────────────────────────────────────────────────────────────
  // DURACIÓN
  // ─────────────────────────────────────────────────────────────────────────

  /// Cantidad total de semanas del curso
  /// Rango: 1-12
  cantidad_semanas Int

  /// Actividades por semana
  /// Rango: 1-5
  actividades_por_semana Int

  // ─────────────────────────────────────────────────────────────────────────
  // ESTADO
  // ─────────────────────────────────────────────────────────────────────────

  /// Estado actual del curso en el flujo de trabajo
  estado EstadoCursoStudio @default(DRAFT)

  // ─────────────────────────────────────────────────────────────────────────
  // CONFIGURACIÓN DE PUBLICACIÓN
  // ─────────────────────────────────────────────────────────────────────────

  /// Mostrar en landing del mundo correspondiente
  landing_mundo Boolean @default(false)

  /// Mostrar en landing principal (destacado)
  landing_home Boolean @default(false)

  /// Disponible en catálogo interno para docentes
  catalogo_interno Boolean @default(false)

  /// Notificar a usuarios de tiers inferiores sobre este curso
  notificar_upgrade Boolean @default(false)

  /// Fecha a partir de la cual se puede vender/promocionar
  fecha_venta DateTime?

  /// Fecha a partir de la cual está disponible para estudiantes
  fecha_disponible DateTime?

  // ─────────────────────────────────────────────────────────────────────────
  // RELACIONES
  // ─────────────────────────────────────────────────────────────────────────

  /// Semanas del curso
  semanas SemanaStudio[]

  /// Recursos multimedia asociados
  recursos RecursoStudio[]

  // ─────────────────────────────────────────────────────────────────────────
  // TIMESTAMPS
  // ─────────────────────────────────────────────────────────────────────────

  /// Fecha de creación
  creado_en DateTime @default(now())

  /// Fecha de última actualización
  actualizado_en DateTime @updatedAt

  @@index([categoria])
  @@index([mundo])
  @@index([casa])
  @@index([estado])
  @@map("cursos_studio")
}

/// Semana de un curso Studio
/// Contiene el JSON completo con actividades y bloques
model SemanaStudio {
  /// Identificador único de la semana
  id String @id @default(cuid())

  /// ID del curso al que pertenece
  curso_id String

  /// Relación con el curso
  curso CursoStudio @relation(fields: [curso_id], references: [id], onDelete: Cascade)

  /// Número de semana dentro del curso (1-indexed)
  numero Int

  /// Nombre de la semana (opcional hasta que se cargue contenido)
  /// Ejemplo: "Tu Primera Poción"
  nombre String?

  /// Descripción de la semana (opcional hasta que se cargue contenido)
  descripcion String? @db.Text

  /// Contenido completo de la semana en formato JSON
  /// Sigue el schema definido en docs/MATEATLETAS_STUDIO.md Sección 6
  /// Incluye: actividades, bloques, gamificación, recursos
  contenido Json?

  /// Estado de la semana
  estado EstadoSemanaStudio @default(VACIA)

  /// Fecha de creación
  creado_en DateTime @default(now())

  /// Fecha de última actualización
  actualizado_en DateTime @updatedAt

  /// Restricción: número de semana único por curso
  @@unique([curso_id, numero])
  @@index([curso_id])
  @@index([estado])
  @@map("semanas_studio")
}

/// Recurso multimedia de un curso Studio
/// Imágenes, audios, videos y documentos usados en el contenido
model RecursoStudio {
  /// Identificador único del recurso
  id String @id @default(cuid())

  /// ID del curso al que pertenece
  curso_id String

  /// Relación con el curso
  curso CursoStudio @relation(fields: [curso_id], references: [id], onDelete: Cascade)

  /// Tipo de recurso
  tipo TipoRecursoStudio

  /// Nombre original del archivo
  /// Ejemplo: "aula_pociones.png"
  nombre String

  /// Path del archivo en el servidor
  /// Ejemplo: "/uploads/cursos/abc123/imagenes/aula_pociones.png"
  archivo String

  /// Tamaño del archivo en bytes
  tamanio_bytes Int

  /// Fecha de subida
  creado_en DateTime @default(now())

  @@index([curso_id])
  @@index([tipo])
  @@map("recursos_studio")
}

/// Badge personalizado creado en Studio
/// Los badges predefinidos del sistema están en código, estos son custom
model BadgeCustomStudio {
  /// Identificador único del badge
  id String @id @default(cuid())

  /// ID del curso al que pertenece (null = disponible para todos)
  curso_id String?

  /// Nombre del badge
  /// Ejemplo: "Maestro de Pociones"
  nombre String

  /// Descripción del badge
  /// Ejemplo: "Completaste todas las actividades de pociones sin errores"
  descripcion String @db.Text

  /// Path al archivo de imagen/icono del badge
  /// Ejemplo: "/uploads/badges/maestro_pociones.png"
  icono String

  /// Si está disponible en la biblioteca para reutilizar en otros cursos
  en_biblioteca Boolean @default(false)

  /// Fecha de creación
  creado_en DateTime @default(now())

  @@index([curso_id])
  @@index([en_biblioteca])
  @@map("badges_custom_studio")
}

/// Catálogo de componentes disponibles en Studio
/// Almacena los 95+ tipos de componentes que pueden usarse en bloques de actividades
model ComponenteCatalogo {
  /// Identificador único del componente
  id String @id @default(cuid())

  /// Tipo único del componente (clave para renderizado)
  /// Ejemplo: "MultipleChoice", "DragDrop", "VideoPlayer"
  tipo String @unique

  /// Nombre legible para mostrar en UI
  /// Ejemplo: "Opción Múltiple", "Arrastrar y Soltar"
  nombre String

  /// Descripción del componente para el editor
  descripcion String

  /// Categoría funcional del componente
  categoria CategoriaComponente

  /// Icono del componente (nombre de Lucide icon o path a SVG)
  /// Ejemplo: "list-checks", "move", "play-circle"
  icono String

  /// JSON Schema de configuración del componente
  /// Define qué props acepta el componente y sus tipos
  configSchema Json

  /// Ejemplo de configuración válida
  /// Sirve como plantilla para nuevos bloques
  ejemploConfig Json

  /// Propiedades adicionales del componente (metadata, tags, etc.)
  propiedades Json?

  /// Si el componente está implementado en el frontend
  implementado Boolean @default(false)

  /// Si el componente está habilitado para uso en producción
  habilitado Boolean @default(false)

  /// Orden de aparición en el selector de componentes
  orden Int @default(0)

  /// Fecha de creación
  createdAt DateTime @default(now())

  /// Fecha de última actualización
  updatedAt DateTime @updatedAt

  @@map("componentes_catalogo")
}
