#!/bin/sh

echo ""
echo "üöî ROBOCOP: Verificando calidad de c√≥digo..."
echo "=============================================="
echo ""

# ============================================================================
# TypeScript - 0 errores (API)
# ============================================================================
echo "‚Üí [1/3] TypeScript API..."
cd apps/api
if ! npx tsc --noEmit 2>&1 | head -20; then
  echo ""
  echo "‚ùå BLOQUEADO: Errores de TypeScript en API."
  echo "   Ejecuta: cd apps/api && npx tsc --noEmit"
  echo ""
  exit 1
fi
cd ../..

# ============================================================================
# TypeScript - 0 errores (Web) - Solo si hay cambios en web
# ============================================================================
# Skip Web TypeScript check - Next.js genera archivos .next/types que dan falsos positivos
# El build de Next.js ya verifica TypeScript
echo "‚Üí [2/3] TypeScript Web... (verificado en build)"

# ============================================================================
# lint-staged (ESLint + Prettier en archivos staged)
# ============================================================================
echo "‚Üí [3/3] ESLint + Prettier..."
if ! npx lint-staged; then
  echo ""
  echo "‚ùå BLOQUEADO: Errores de ESLint o formato."
  echo ""
  echo "   Reglas estrictas activas:"
  echo "   - NO any (usa tipos espec√≠ficos)"
  echo "   - NO @ts-ignore (arregla el problema)"
  echo "   - NO console.* (usa Logger)"
  echo ""
  exit 1
fi

echo ""
echo "‚úÖ ROBOCOP: Todo OK. Commit permitido."
echo ""